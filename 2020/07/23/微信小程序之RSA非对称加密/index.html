<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>微信小程序 之 RSA非对称加密 | BinGCU  のBlog</title><meta name="description" content="1、什么是RSA 在介绍具体的内容之前，先来介绍一下什么是RSA非对称加密： RSA是指RSA加密算法，是1977年由罗纳德·李维斯特（Ron Rivest）、阿迪·萨莫尔（Adi Shamir）和伦纳德·阿德曼（Leonard Adleman）一起提出的。当时他们三人都在麻省理工学院工作。RSA就是他们三人姓氏开头字母拼在一起组成的。 RSA公开密钥（yuè）密码体制是一种使用不同的加密密钥（y"><meta name="keywords" content="微信小程序,加密与解密,网络安全"><meta name="author" content="BinGCU"><meta name="copyright" content="BinGCU"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/avatar.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="微信小程序 之 RSA非对称加密"><meta name="twitter:description" content="1、什么是RSA 在介绍具体的内容之前，先来介绍一下什么是RSA非对称加密： RSA是指RSA加密算法，是1977年由罗纳德·李维斯特（Ron Rivest）、阿迪·萨莫尔（Adi Shamir）和伦纳德·阿德曼（Leonard Adleman）一起提出的。当时他们三人都在麻省理工学院工作。RSA就是他们三人姓氏开头字母拼在一起组成的。 RSA公开密钥（yuè）密码体制是一种使用不同的加密密钥（y"><meta name="twitter:image" content="http://bingcu.com/img/article_covers/1.jpg"><meta property="og:type" content="article"><meta property="og:title" content="微信小程序 之 RSA非对称加密"><meta property="og:url" content="http://bingcu.com/2020/07/23/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%B9%8BRSA%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86/"><meta property="og:site_name" content="BinGCU  のBlog"><meta property="og:description" content="1、什么是RSA 在介绍具体的内容之前，先来介绍一下什么是RSA非对称加密： RSA是指RSA加密算法，是1977年由罗纳德·李维斯特（Ron Rivest）、阿迪·萨莫尔（Adi Shamir）和伦纳德·阿德曼（Leonard Adleman）一起提出的。当时他们三人都在麻省理工学院工作。RSA就是他们三人姓氏开头字母拼在一起组成的。 RSA公开密钥（yuè）密码体制是一种使用不同的加密密钥（y"><meta property="og:image" content="http://bingcu.com/img/article_covers/1.jpg"><meta property="article:published_time" content="2020-07-23T12:00:00.000Z"><meta property="article:modified_time" content="2022-05-05T14:13:54.814Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '2'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://bingcu.com/2020/07/23/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%B9%8BRSA%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86/"><link rel="prev" title="微信小程序 之 RSA长文本分段加解密" href="http://bingcu.com/2020/07/24/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%B9%8BRSA%E9%95%BF%E6%96%87%E6%9C%AC%E5%88%86%E6%AE%B5%E5%8A%A0%E8%A7%A3%E5%AF%86/"><link rel="next" title="完美解决Hexo+Typora图片无法显示问题" href="http://bingcu.com/2020/07/19/%E5%AE%8C%E7%BE%8E%E8%A7%A3%E5%86%B3Hexo+Typora%E5%9B%BE%E7%89%87%E6%97%A0%E6%B3%95%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5/js/md5.min.js"></script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime_unit: 'days',
  runtime: true,
  copyright: {"languages":{"author":"Author: BinGCU","link":"Link: ","source":"Source: BinGCU  のBlog","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source."}},
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'true',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: true
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.1"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">34</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">45</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">Categories</div><div class="length_num">4</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1、什么是RSA"><span class="toc-text">1、什么是RSA</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2、为什么使用RSA算法"><span class="toc-text">2、为什么使用RSA算法</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3、JS前端使用RSA"><span class="toc-text">3、JS前端使用RSA</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4、Java后端使用RSA"><span class="toc-text">4、Java后端使用RSA</span></a></li></ol></div></div></div><div id="body-wrap"><div id="web_bg" data-type="photo"></div><div class="post-bg" id="nav" style="background-image: url(/img/article_covers/1.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">BinGCU  のBlog</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">微信小程序 之 RSA非对称加密</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="Created 2020-07-23 20:00:00"><i class="fa fa-calendar" aria-hidden="true"></i> Created 2020-07-23</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="Updated 2022-05-05 22:13:54"><i class="fa fa-history" aria-hidden="true"></i> Updated 2022-05-05</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2/">技术博客</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>Word count:</span><span class="word-count">18k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>Reading time: 106 min</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>Post View:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-comment-o" aria-hidden="true"></i><span>Comments:</span><a href="/2020/07/23/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%B9%8BRSA%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86/#post-comment"><span class="gitalk-comment-count comment-count"></span></a></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="1、什么是RSA"><a href="#1、什么是RSA" class="headerlink" title="1、什么是RSA"></a>1、什么是RSA</h1><ul>
<li>在介绍具体的内容之前，先来介绍一下什么是RSA非对称加密：<ul>
<li>RSA是指RSA加密算法，是1977年由罗纳德·李维斯特（Ron Rivest）、阿迪·萨莫尔（Adi Shamir）和伦纳德·阿德曼（Leonard Adleman）一起提出的。当时他们三人都在麻省理工学院工作。RSA就是他们三人姓氏开头字母拼在一起组成的。</li>
<li>RSA公开密钥（yuè）密码体制是一种使用不同的加密密钥（yuè）与解密密钥（yuè），“由已知加密密钥（yuè）推导出解密密钥（yuè）在计算上是不可行的”密码体制。</li>
<li>在公开密钥（yuè）密码体制中，加密密钥（yuè）（即公开密钥（yuè））PK是公开信息，而解密密钥（yuè）（即秘密密钥（yuè））SK是需要保密的。加密算法E和解密算法D也都是公开的。虽然解密密钥（yuè）SK是由公开密钥（yuè）PK决定的，但却不能根据PK计算出SK。</li>
<li>说人话就是每个人都可以用钥匙P进行加密，但用P却解密不了，所以钥匙P可以暴露给每个人；相对的，钥匙S却是可以进行解密而无法进行加密的，所以钥匙S是绝对不能暴露的，必须自己藏着掖着。一般来说，拥有钥匙S的人都拥有钥匙P，因为钥匙P可以暴露给每个人，包括自己。也就是说自己随时都可以对文本进行加密和解密，而别人只能进行加密，而无法进行解密操作。所以，只要钥匙S不丢失，一般都能保障数据的绝密性。</li>
</ul>
</li>
</ul>
<h1 id="2、为什么使用RSA算法"><a href="#2、为什么使用RSA算法" class="headerlink" title="2、为什么使用RSA算法"></a>2、为什么使用RSA算法</h1><ul>
<li>最近在用微信写一个小程序，其中的一个需求就是在网路数据传输的过程中，要保证数据的安全性。于是作者便想到了3种加密策略：对称加密、非对称加密、摘要算法（散列算法、Hash算法）。</li>
<li>对称加密：其中对称加密算法过于简单，容易被破解，所以没法选择。</li>
<li>摘要算法：摘要算法很不错，如MD5摘要算法、SHA1摘要算法、SHA256摘要算法，之前听说SHA1算法被破解了，已经不安全了，故不再选择SHA1摘要算法了。最后的决定是落在了SHA256摘要算法上，由于SHA256算法所产生的<code>Hash Code</code>长度达<code>256 bit</code>，因此Hash碰撞的可能性大幅度的减少，其安全程度可以保障，因此是一个很好的选择。<ul>
<li>但是有一个问题，摘要算法算不上是真正的加解密算法，因为它只能用于加密，而无法进行解密，它所产生的<code>哈希值</code>是从原文本中摘取其中的一些文本片段，通过一定的算法所生成的，<code>文本片段本身就无法还原全文本！</code>故放弃摘要算法。</li>
</ul>
</li>
<li>非对称算法：最后作者命中的是非对称加密，非对称加密算法有很多种，如：<ol>
<li>RSA加密算法</li>
<li>DSA（Digital Signature Algorithm，数字签名算法）</li>
<li>ECDSA（Elliptic Curve Digital Signature Algorithm，椭圆曲线签名算法）</li>
<li>等等…有兴趣的可以再去找找看其他的算法~</li>
</ol>
</li>
</ul>
<p><strong>由于作者本身也是因为最近在做微信小程序，而想到写这篇博客的，因此本博客就决定围绕着这方面展开了。</strong></p>
<p>既然说到了微信小程序，由于微信所采用的面向对象的编程语言主要包括JavaScript，那么就介绍一下如何在<code>JS</code>中编写加密的代码吧！</p>
<h1 id="3、JS前端使用RSA"><a href="#3、JS前端使用RSA" class="headerlink" title="3、JS前端使用RSA"></a>3、JS前端使用RSA</h1><p><strong>首先，算法本身不会让我们自己来写啦，当然有兴趣的话是可以去了解算法本身是如何实现的。</strong></p>
<ul>
<li><p>我们需要去引进一个js文件作为我们加解密的工具：<code>jsencrypt.js</code></p>
</li>
<li><p>jsencrypt的github网址：<code>https://github.com/travist/jsencrypt</code></p>
</li>
<li><p>但由于微信小程序不支持window对象等内容，所以不能直接在微信小程序中使用官方的<code>jsencrypt.js</code>文件，我们需要对源码进行一些简单的增删改，以达到兼容。</p>
</li>
<li><p>网上很多教程，这里就不多赘述了：<code>https://developers.weixin.qq.com/community/develop/doc/000068b497cfc00619b7bcfdc51004</code></p>
</li>
<li><p>这里直接附带修改后兼容的js文件（经过压缩），以方便日后直接使用：</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">global, factory</span>) </span>&#123; <span class="keyword">typeof</span> exports === <span class="string">'object'</span> &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">module</span> !== <span class="string">'undefined'</span> ? factory(exports) : <span class="keyword">typeof</span> define === <span class="string">'function'</span> &amp;&amp; define.amd ? define([<span class="string">'exports'</span>], factory) : (factory((global.JSEncrypt = &#123;&#125;))) &#125;(<span class="keyword">this</span>, (<span class="function"><span class="keyword">function</span> (<span class="params">exports</span>) </span>&#123; <span class="string">'use strict'</span>; <span class="keyword">var</span> navigator2 = &#123; <span class="attr">appName</span>: <span class="string">'Netscape'</span>, <span class="attr">userAgent</span>: <span class="string">'Mozilla/5.0 (iPhone; CPU iPhone OS 9_1 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1'</span> &#125;; <span class="keyword">var</span> window2 = &#123; <span class="attr">ASN1</span>: <span class="literal">null</span>, <span class="attr">Base64</span>: <span class="literal">null</span>, <span class="attr">Hex</span>: <span class="literal">null</span>, <span class="attr">crypto</span>: <span class="literal">null</span>, <span class="attr">href</span>: <span class="literal">null</span> &#125;; <span class="keyword">var</span> BI_RM = <span class="string">"0123456789abcdefghijklmnopqrstuvwxyz"</span>; <span class="function"><span class="keyword">function</span> <span class="title">int2char</span>(<span class="params">n</span>) </span>&#123; <span class="keyword">return</span> BI_RM.charAt(n) &#125; <span class="function"><span class="keyword">function</span> <span class="title">op_and</span>(<span class="params">x, y</span>) </span>&#123; <span class="keyword">return</span> x &amp; y &#125; <span class="function"><span class="keyword">function</span> <span class="title">op_or</span>(<span class="params">x, y</span>) </span>&#123; <span class="keyword">return</span> x | y &#125; <span class="function"><span class="keyword">function</span> <span class="title">op_xor</span>(<span class="params">x, y</span>) </span>&#123; <span class="keyword">return</span> x ^ y &#125; <span class="function"><span class="keyword">function</span> <span class="title">op_andnot</span>(<span class="params">x, y</span>) </span>&#123; <span class="keyword">return</span> x &amp; ~y &#125; <span class="function"><span class="keyword">function</span> <span class="title">lbit</span>(<span class="params">x</span>) </span>&#123; <span class="keyword">if</span> (x == <span class="number">0</span>) &#123; <span class="keyword">return</span> <span class="number">-1</span> &#125; <span class="keyword">var</span> r = <span class="number">0</span>; <span class="keyword">if</span> ((x &amp; <span class="number">0xffff</span>) == <span class="number">0</span>) &#123; x &gt;&gt;= <span class="number">16</span>; r += <span class="number">16</span> &#125; <span class="keyword">if</span> ((x &amp; <span class="number">0xff</span>) == <span class="number">0</span>) &#123; x &gt;&gt;= <span class="number">8</span>; r += <span class="number">8</span> &#125; <span class="keyword">if</span> ((x &amp; <span class="number">0xf</span>) == <span class="number">0</span>) &#123; x &gt;&gt;= <span class="number">4</span>; r += <span class="number">4</span> &#125; <span class="keyword">if</span> ((x &amp; <span class="number">3</span>) == <span class="number">0</span>) &#123; x &gt;&gt;= <span class="number">2</span>; r += <span class="number">2</span> &#125; <span class="keyword">if</span> ((x &amp; <span class="number">1</span>) == <span class="number">0</span>) &#123; ++r &#125; <span class="keyword">return</span> r &#125; <span class="function"><span class="keyword">function</span> <span class="title">cbit</span>(<span class="params">x</span>) </span>&#123; <span class="keyword">var</span> r = <span class="number">0</span>; <span class="keyword">while</span> (x != <span class="number">0</span>) &#123; x &amp;= x - <span class="number">1</span>; ++r &#125; <span class="keyword">return</span> r &#125; <span class="keyword">var</span> b64map = <span class="string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"</span>; <span class="keyword">var</span> b64pad = <span class="string">"="</span>; <span class="function"><span class="keyword">function</span> <span class="title">hex2b64</span>(<span class="params">h</span>) </span>&#123; <span class="keyword">var</span> i; <span class="keyword">var</span> c; <span class="keyword">var</span> ret = <span class="string">""</span>; <span class="keyword">for</span> (i = <span class="number">0</span>; i + <span class="number">3</span> &lt;= h.length; i += <span class="number">3</span>) &#123; c = <span class="built_in">parseInt</span>(h.substring(i, i + <span class="number">3</span>), <span class="number">16</span>); ret += b64map.charAt(c &gt;&gt; <span class="number">6</span>) + b64map.charAt(c &amp; <span class="number">63</span>) &#125; <span class="keyword">if</span> (i + <span class="number">1</span> == h.length) &#123; c = <span class="built_in">parseInt</span>(h.substring(i, i + <span class="number">1</span>), <span class="number">16</span>); ret += b64map.charAt(c &lt;&lt; <span class="number">2</span>) &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i + <span class="number">2</span> == h.length) &#123; c = <span class="built_in">parseInt</span>(h.substring(i, i + <span class="number">2</span>), <span class="number">16</span>); ret += b64map.charAt(c &gt;&gt; <span class="number">2</span>) + b64map.charAt((c &amp; <span class="number">3</span>) &lt;&lt; <span class="number">4</span>) &#125; <span class="keyword">while</span> ((ret.length &amp; <span class="number">3</span>) &gt; <span class="number">0</span>) &#123; ret += b64pad &#125; <span class="keyword">return</span> ret &#125; <span class="function"><span class="keyword">function</span> <span class="title">b64tohex</span>(<span class="params">s</span>) </span>&#123; <span class="keyword">var</span> ret = <span class="string">""</span>; <span class="keyword">var</span> i; <span class="keyword">var</span> k = <span class="number">0</span>; <span class="keyword">var</span> slop = <span class="number">0</span>; <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; s.length; ++i) &#123; <span class="keyword">if</span> (s.charAt(i) == b64pad) &#123; <span class="keyword">break</span> &#125; <span class="keyword">var</span> v = b64map.indexOf(s.charAt(i)); <span class="keyword">if</span> (v &lt; <span class="number">0</span>) &#123; <span class="keyword">continue</span> &#125; <span class="keyword">if</span> (k == <span class="number">0</span>) &#123; ret += int2char(v &gt;&gt; <span class="number">2</span>); slop = v &amp; <span class="number">3</span>; k = <span class="number">1</span> &#125; <span class="keyword">else</span> <span class="keyword">if</span> (k == <span class="number">1</span>) &#123; ret += int2char((slop &lt;&lt; <span class="number">2</span>) | (v &gt;&gt; <span class="number">4</span>)); slop = v &amp; <span class="number">0xf</span>; k = <span class="number">2</span> &#125; <span class="keyword">else</span> <span class="keyword">if</span> (k == <span class="number">2</span>) &#123; ret += int2char(slop); ret += int2char(v &gt;&gt; <span class="number">2</span>); slop = v &amp; <span class="number">3</span>; k = <span class="number">3</span> &#125; <span class="keyword">else</span> &#123; ret += int2char((slop &lt;&lt; <span class="number">2</span>) | (v &gt;&gt; <span class="number">4</span>)); ret += int2char(v &amp; <span class="number">0xf</span>); k = <span class="number">0</span> &#125; &#125; <span class="keyword">if</span> (k == <span class="number">1</span>) &#123; ret += int2char(slop &lt;&lt; <span class="number">2</span>) &#125; <span class="keyword">return</span> ret &#125; <span class="keyword">var</span> extendStatics = <span class="function"><span class="keyword">function</span> (<span class="params">d, b</span>) </span>&#123; extendStatics = <span class="built_in">Object</span>.setPrototypeOf || (&#123; <span class="attr">__proto__</span>: [] &#125; <span class="keyword">instanceof</span> <span class="built_in">Array</span> &amp;&amp; <span class="function"><span class="keyword">function</span> (<span class="params">d, b</span>) </span>&#123; d.__proto__ = b &#125;) || <span class="function"><span class="keyword">function</span> (<span class="params">d, b</span>) </span>&#123; <span class="keyword">for</span> (<span class="keyword">var</span> p <span class="keyword">in</span> b) <span class="keyword">if</span> (b.hasOwnProperty(p)) d[p] = b[p] &#125;; <span class="keyword">return</span> extendStatics(d, b) &#125;; <span class="function"><span class="keyword">function</span> <span class="title">__extends</span>(<span class="params">d, b</span>) </span>&#123; extendStatics(d, b); <span class="function"><span class="keyword">function</span> <span class="title">__</span>(<span class="params"></span>) </span>&#123; <span class="keyword">this</span>.constructor = d &#125; d.prototype = b === <span class="literal">null</span> ? <span class="built_in">Object</span>.create(b) : (__.prototype = b.prototype, <span class="keyword">new</span> __()) &#125; <span class="keyword">var</span> decoder; <span class="keyword">var</span> Hex = &#123; <span class="attr">decode</span>: <span class="function"><span class="keyword">function</span> (<span class="params">a</span>) </span>&#123; <span class="keyword">var</span> i; <span class="keyword">if</span> (decoder === <span class="literal">undefined</span>) &#123; <span class="keyword">var</span> hex = <span class="string">"0123456789ABCDEF"</span>; <span class="keyword">var</span> ignore = <span class="string">" \f\n\r\t\u00A0\u2028\u2029"</span>; decoder = &#123;&#125;; <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; ++i) &#123; decoder[hex.charAt(i)] = i &#125; hex = hex.toLowerCase(); <span class="keyword">for</span> (i = <span class="number">10</span>; i &lt; <span class="number">16</span>; ++i) &#123; decoder[hex.charAt(i)] = i &#125; <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; ignore.length; ++i) &#123; decoder[ignore.charAt(i)] = <span class="number">-1</span> &#125; &#125; <span class="keyword">var</span> out = []; <span class="keyword">var</span> bits = <span class="number">0</span>; <span class="keyword">var</span> char_count = <span class="number">0</span>; <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; a.length; ++i) &#123; <span class="keyword">var</span> c = a.charAt(i); <span class="keyword">if</span> (c == <span class="string">"="</span>) &#123; <span class="keyword">break</span> &#125; c = decoder[c]; <span class="keyword">if</span> (c == <span class="number">-1</span>) &#123; <span class="keyword">continue</span> &#125; <span class="keyword">if</span> (c === <span class="literal">undefined</span>) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Illegal character at offset "</span> + i); &#125; bits |= c; <span class="keyword">if</span> (++char_count &gt;= <span class="number">2</span>) &#123; out[out.length] = bits; bits = <span class="number">0</span>; char_count = <span class="number">0</span> &#125; <span class="keyword">else</span> &#123; bits &lt;&lt;= <span class="number">4</span> &#125; &#125; <span class="keyword">if</span> (char_count) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Hex encoding incomplete: 4 bits missing"</span>); &#125; <span class="keyword">return</span> out &#125; &#125;; <span class="keyword">var</span> decoder$<span class="number">1</span>; <span class="keyword">var</span> Base64 = &#123; <span class="attr">decode</span>: <span class="function"><span class="keyword">function</span> (<span class="params">a</span>) </span>&#123; <span class="keyword">var</span> i; <span class="keyword">if</span> (decoder$<span class="number">1</span> === <span class="literal">undefined</span>) &#123; <span class="keyword">var</span> b64 = <span class="string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"</span>; <span class="keyword">var</span> ignore = <span class="string">"= \f\n\r\t\u00A0\u2028\u2029"</span>; decoder$<span class="number">1</span> = <span class="built_in">Object</span>.create(<span class="literal">null</span>); <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">64</span>; ++i) &#123; decoder$<span class="number">1</span>[b64.charAt(i)] = i &#125; <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; ignore.length; ++i) &#123; decoder$<span class="number">1</span>[ignore.charAt(i)] = <span class="number">-1</span> &#125; &#125; <span class="keyword">var</span> out = []; <span class="keyword">var</span> bits = <span class="number">0</span>; <span class="keyword">var</span> char_count = <span class="number">0</span>; <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; a.length; ++i) &#123; <span class="keyword">var</span> c = a.charAt(i); <span class="keyword">if</span> (c == <span class="string">"="</span>) &#123; <span class="keyword">break</span> &#125; c = decoder$<span class="number">1</span>[c]; <span class="keyword">if</span> (c == <span class="number">-1</span>) &#123; <span class="keyword">continue</span> &#125; <span class="keyword">if</span> (c === <span class="literal">undefined</span>) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Illegal character at offset "</span> + i); &#125; bits |= c; <span class="keyword">if</span> (++char_count &gt;= <span class="number">4</span>) &#123; out[out.length] = (bits &gt;&gt; <span class="number">16</span>); out[out.length] = (bits &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>; out[out.length] = bits &amp; <span class="number">0xFF</span>; bits = <span class="number">0</span>; char_count = <span class="number">0</span> &#125; <span class="keyword">else</span> &#123; bits &lt;&lt;= <span class="number">6</span> &#125; &#125; <span class="keyword">switch</span> (char_count) &#123; <span class="keyword">case</span> <span class="number">1</span>: <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Base64 encoding incomplete: at least 2 bits missing"</span>); <span class="keyword">case</span> <span class="number">2</span>: out[out.length] = (bits &gt;&gt; <span class="number">10</span>); <span class="keyword">break</span>; <span class="keyword">case</span> <span class="number">3</span>: out[out.length] = (bits &gt;&gt; <span class="number">16</span>); out[out.length] = (bits &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>; <span class="keyword">break</span> &#125;<span class="keyword">return</span> out &#125;, <span class="attr">re</span>: <span class="regexp">/-----BEGIN [^-]+-----([A-Za-z0-9+\/=\s]+)-----END [^-]+-----|begin-base64[^\n]+\n([A-Za-z0-9+\/=\s]+)====/</span>, <span class="attr">unarmor</span>: <span class="function"><span class="keyword">function</span> (<span class="params">a</span>) </span>&#123; <span class="keyword">var</span> m = Base64.re.exec(a); <span class="keyword">if</span> (m) &#123; <span class="keyword">if</span> (m[<span class="number">1</span>]) &#123; a = m[<span class="number">1</span>] &#125; <span class="keyword">else</span> <span class="keyword">if</span> (m[<span class="number">2</span>]) &#123; a = m[<span class="number">2</span>] &#125; <span class="keyword">else</span> &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"RegExp out of sync"</span>); &#125; &#125; <span class="keyword">return</span> Base64.decode(a) &#125; &#125;; <span class="keyword">var</span> max = <span class="number">10000000000000</span>; <span class="keyword">var</span> Int10 = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="function"><span class="keyword">function</span> <span class="title">Int10</span>(<span class="params">value</span>) </span>&#123; <span class="keyword">this</span>.buf = [+value || <span class="number">0</span>] &#125; Int10.prototype.mulAdd = <span class="function"><span class="keyword">function</span> (<span class="params">m, c</span>) </span>&#123; <span class="keyword">var</span> b = <span class="keyword">this</span>.buf; <span class="keyword">var</span> l = b.length; <span class="keyword">var</span> i; <span class="keyword">var</span> t; <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; l; ++i) &#123; t = b[i] * m + c; <span class="keyword">if</span> (t &lt; max) &#123; c = <span class="number">0</span> &#125; <span class="keyword">else</span> &#123; c = <span class="number">0</span> | (t / max); t -= c * max &#125; b[i] = t &#125; <span class="keyword">if</span> (c &gt; <span class="number">0</span>) &#123; b[i] = c &#125; &#125;; Int10.prototype.sub = <span class="function"><span class="keyword">function</span> (<span class="params">c</span>) </span>&#123; <span class="keyword">var</span> b = <span class="keyword">this</span>.buf; <span class="keyword">var</span> l = b.length; <span class="keyword">var</span> i; <span class="keyword">var</span> t; <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; l; ++i) &#123; t = b[i] - c; <span class="keyword">if</span> (t &lt; <span class="number">0</span>) &#123; t += max; c = <span class="number">1</span> &#125; <span class="keyword">else</span> &#123; c = <span class="number">0</span> &#125; b[i] = t &#125; <span class="keyword">while</span> (b[b.length - <span class="number">1</span>] === <span class="number">0</span>) &#123; b.pop() &#125; &#125;; Int10.prototype.toString = <span class="function"><span class="keyword">function</span> (<span class="params">base</span>) </span>&#123; <span class="keyword">if</span> ((base || <span class="number">10</span>) != <span class="number">10</span>) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"only base 10 is supported"</span>); &#125; <span class="keyword">var</span> b = <span class="keyword">this</span>.buf; <span class="keyword">var</span> s = b[b.length - <span class="number">1</span>].toString(); <span class="keyword">for</span> (<span class="keyword">var</span> i = b.length - <span class="number">2</span>; i &gt;= <span class="number">0</span>; --i) &#123; s += (max + b[i]).toString().substring(<span class="number">1</span>) &#125; <span class="keyword">return</span> s &#125;; Int10.prototype.valueOf = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">var</span> b = <span class="keyword">this</span>.buf; <span class="keyword">var</span> v = <span class="number">0</span>; <span class="keyword">for</span> (<span class="keyword">var</span> i = b.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) &#123; v = v * max + b[i] &#125; <span class="keyword">return</span> v &#125;; Int10.prototype.simplify = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">var</span> b = <span class="keyword">this</span>.buf; <span class="keyword">return</span> (b.length == <span class="number">1</span>) ? b[<span class="number">0</span>] : <span class="keyword">this</span> &#125;; <span class="keyword">return</span> Int10 &#125;()); <span class="keyword">var</span> ellipsis = <span class="string">"\u2026"</span>; <span class="keyword">var</span> reTimeS = <span class="regexp">/^(\d\d)(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])([01]\d|2[0-3])(?:([0-5]\d)(?:([0-5]\d)(?:[.,](\d&#123;1,3&#125;))?)?)?(Z|[-+](?:[0]\d|1[0-2])([0-5]\d)?)?$/</span>; <span class="keyword">var</span> reTimeL = <span class="regexp">/^(\d\d\d\d)(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])([01]\d|2[0-3])(?:([0-5]\d)(?:([0-5]\d)(?:[.,](\d&#123;1,3&#125;))?)?)?(Z|[-+](?:[0]\d|1[0-2])([0-5]\d)?)?$/</span>; <span class="function"><span class="keyword">function</span> <span class="title">stringCut</span>(<span class="params">str, len</span>) </span>&#123; <span class="keyword">if</span> (str.length &gt; len) &#123; str = str.substring(<span class="number">0</span>, len) + ellipsis &#125; <span class="keyword">return</span> str &#125; <span class="keyword">var</span> Stream = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="function"><span class="keyword">function</span> <span class="title">Stream</span>(<span class="params">enc, pos</span>) </span>&#123; <span class="keyword">this</span>.hexDigits = <span class="string">"0123456789ABCDEF"</span>; <span class="keyword">if</span> (enc <span class="keyword">instanceof</span> Stream) &#123; <span class="keyword">this</span>.enc = enc.enc; <span class="keyword">this</span>.pos = enc.pos &#125; <span class="keyword">else</span> &#123; <span class="keyword">this</span>.enc = enc; <span class="keyword">this</span>.pos = pos &#125; &#125; Stream.prototype.get = <span class="function"><span class="keyword">function</span> (<span class="params">pos</span>) </span>&#123; <span class="keyword">if</span> (pos === <span class="literal">undefined</span>) &#123; pos = <span class="keyword">this</span>.pos++ &#125; <span class="keyword">if</span> (pos &gt;= <span class="keyword">this</span>.enc.length) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Requesting byte offset "</span> + pos + <span class="string">" on a stream of length "</span> + <span class="keyword">this</span>.enc.length); &#125; <span class="keyword">return</span> (<span class="string">"string"</span> === <span class="keyword">typeof</span> <span class="keyword">this</span>.enc) ? <span class="keyword">this</span>.enc.charCodeAt(pos) : <span class="keyword">this</span>.enc[pos] &#125;; Stream.prototype.hexByte = <span class="function"><span class="keyword">function</span> (<span class="params">b</span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.hexDigits.charAt((b &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0xF</span>) + <span class="keyword">this</span>.hexDigits.charAt(b &amp; <span class="number">0xF</span>) &#125;; Stream.prototype.hexDump = <span class="function"><span class="keyword">function</span> (<span class="params">start, end, raw</span>) </span>&#123; <span class="keyword">var</span> s = <span class="string">""</span>; <span class="keyword">for</span> (<span class="keyword">var</span> i = start; i &lt; end; ++i) &#123; s += <span class="keyword">this</span>.hexByte(<span class="keyword">this</span>.get(i)); <span class="keyword">if</span> (raw !== <span class="literal">true</span>) &#123; <span class="keyword">switch</span> (i &amp; <span class="number">0xF</span>) &#123; <span class="keyword">case</span> <span class="number">0x7</span>: s += <span class="string">"  "</span>; <span class="keyword">break</span>; <span class="keyword">case</span> <span class="number">0xF</span>: s += <span class="string">"\n"</span>; <span class="keyword">break</span>; <span class="keyword">default</span>: s += <span class="string">" "</span> &#125; &#125; &#125; <span class="keyword">return</span> s &#125;; Stream.prototype.isASCII = <span class="function"><span class="keyword">function</span> (<span class="params">start, end</span>) </span>&#123; <span class="keyword">for</span> (<span class="keyword">var</span> i = start; i &lt; end; ++i) &#123; <span class="keyword">var</span> c = <span class="keyword">this</span>.get(i); <span class="keyword">if</span> (c &lt; <span class="number">32</span> || c &gt; <span class="number">176</span>) &#123; <span class="keyword">return</span> <span class="literal">false</span> &#125; &#125; <span class="keyword">return</span> <span class="literal">true</span> &#125;; Stream.prototype.parseStringISO = <span class="function"><span class="keyword">function</span> (<span class="params">start, end</span>) </span>&#123; <span class="keyword">var</span> s = <span class="string">""</span>; <span class="keyword">for</span> (<span class="keyword">var</span> i = start; i &lt; end; ++i) &#123; s += <span class="built_in">String</span>.fromCharCode(<span class="keyword">this</span>.get(i)) &#125; <span class="keyword">return</span> s &#125;; Stream.prototype.parseStringUTF = <span class="function"><span class="keyword">function</span> (<span class="params">start, end</span>) </span>&#123; <span class="keyword">var</span> s = <span class="string">""</span>; <span class="keyword">for</span> (<span class="keyword">var</span> i = start; i &lt; end;) &#123; <span class="keyword">var</span> c = <span class="keyword">this</span>.get(i++); <span class="keyword">if</span> (c &lt; <span class="number">128</span>) &#123; s += <span class="built_in">String</span>.fromCharCode(c) &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((c &gt; <span class="number">191</span>) &amp;&amp; (c &lt; <span class="number">224</span>)) &#123; s += <span class="built_in">String</span>.fromCharCode(((c &amp; <span class="number">0x1F</span>) &lt;&lt; <span class="number">6</span>) | (<span class="keyword">this</span>.get(i++) &amp; <span class="number">0x3F</span>)) &#125; <span class="keyword">else</span> &#123; s += <span class="built_in">String</span>.fromCharCode(((c &amp; <span class="number">0x0F</span>) &lt;&lt; <span class="number">12</span>) | ((<span class="keyword">this</span>.get(i++) &amp; <span class="number">0x3F</span>) &lt;&lt; <span class="number">6</span>) | (<span class="keyword">this</span>.get(i++) &amp; <span class="number">0x3F</span>)) &#125; &#125; <span class="keyword">return</span> s &#125;; Stream.prototype.parseStringBMP = <span class="function"><span class="keyword">function</span> (<span class="params">start, end</span>) </span>&#123; <span class="keyword">var</span> str = <span class="string">""</span>; <span class="keyword">var</span> hi; <span class="keyword">var</span> lo; <span class="keyword">for</span> (<span class="keyword">var</span> i = start; i &lt; end;) &#123; hi = <span class="keyword">this</span>.get(i++); lo = <span class="keyword">this</span>.get(i++); str += <span class="built_in">String</span>.fromCharCode((hi &lt;&lt; <span class="number">8</span>) | lo) &#125; <span class="keyword">return</span> str &#125;; Stream.prototype.parseTime = <span class="function"><span class="keyword">function</span> (<span class="params">start, end, shortYear</span>) </span>&#123; <span class="keyword">var</span> s = <span class="keyword">this</span>.parseStringISO(start, end); <span class="keyword">var</span> m = (shortYear ? reTimeS : reTimeL).exec(s); <span class="keyword">if</span> (!m) &#123; <span class="keyword">return</span> <span class="string">"Unrecognized time: "</span> + s &#125; <span class="keyword">if</span> (shortYear) &#123; m[<span class="number">1</span>] = +m[<span class="number">1</span>]; m[<span class="number">1</span>] += (+m[<span class="number">1</span>] &lt; <span class="number">70</span>) ? <span class="number">2000</span> : <span class="number">1900</span> &#125; s = m[<span class="number">1</span>] + <span class="string">"-"</span> + m[<span class="number">2</span>] + <span class="string">"-"</span> + m[<span class="number">3</span>] + <span class="string">" "</span> + m[<span class="number">4</span>]; <span class="keyword">if</span> (m[<span class="number">5</span>]) &#123; s += <span class="string">":"</span> + m[<span class="number">5</span>]; <span class="keyword">if</span> (m[<span class="number">6</span>]) &#123; s += <span class="string">":"</span> + m[<span class="number">6</span>]; <span class="keyword">if</span> (m[<span class="number">7</span>]) &#123; s += <span class="string">"."</span> + m[<span class="number">7</span>] &#125; &#125; &#125; <span class="keyword">if</span> (m[<span class="number">8</span>]) &#123; s += <span class="string">" UTC"</span>; <span class="keyword">if</span> (m[<span class="number">8</span>] != <span class="string">"Z"</span>) &#123; s += m[<span class="number">8</span>]; <span class="keyword">if</span> (m[<span class="number">9</span>]) &#123; s += <span class="string">":"</span> + m[<span class="number">9</span>] &#125; &#125; &#125; <span class="keyword">return</span> s &#125;; Stream.prototype.parseInteger = <span class="function"><span class="keyword">function</span> (<span class="params">start, end</span>) </span>&#123; <span class="keyword">var</span> v = <span class="keyword">this</span>.get(start); <span class="keyword">var</span> neg = (v &gt; <span class="number">127</span>); <span class="keyword">var</span> pad = neg ? <span class="number">255</span> : <span class="number">0</span>; <span class="keyword">var</span> len; <span class="keyword">var</span> s = <span class="string">""</span>; <span class="keyword">while</span> (v == pad &amp;&amp; ++start &lt; end) &#123; v = <span class="keyword">this</span>.get(start) &#125; len = end - start; <span class="keyword">if</span> (len === <span class="number">0</span>) &#123; <span class="keyword">return</span> neg ? <span class="number">-1</span> : <span class="number">0</span> &#125; <span class="keyword">if</span> (len &gt; <span class="number">4</span>) &#123; s = v; len &lt;&lt;= <span class="number">3</span>; <span class="keyword">while</span> (((+s ^ pad) &amp; <span class="number">0x80</span>) == <span class="number">0</span>) &#123; s = +s &lt;&lt; <span class="number">1</span>; --len &#125; s = <span class="string">"("</span> + len + <span class="string">" bit)\n"</span> &#125; <span class="keyword">if</span> (neg) &#123; v = v - <span class="number">256</span> &#125; <span class="keyword">var</span> n = <span class="keyword">new</span> Int10(v); <span class="keyword">for</span> (<span class="keyword">var</span> i = start + <span class="number">1</span>; i &lt; end; ++i) &#123; n.mulAdd(<span class="number">256</span>, <span class="keyword">this</span>.get(i)) &#125; <span class="keyword">return</span> s + n.toString() &#125;; Stream.prototype.parseBitString = <span class="function"><span class="keyword">function</span> (<span class="params">start, end, maxLength</span>) </span>&#123; <span class="keyword">var</span> unusedBit = <span class="keyword">this</span>.get(start); <span class="keyword">var</span> lenBit = ((end - start - <span class="number">1</span>) &lt;&lt; <span class="number">3</span>) - unusedBit; <span class="keyword">var</span> intro = <span class="string">"("</span> + lenBit + <span class="string">" bit)\n"</span>; <span class="keyword">var</span> s = <span class="string">""</span>; <span class="keyword">for</span> (<span class="keyword">var</span> i = start + <span class="number">1</span>; i &lt; end; ++i) &#123; <span class="keyword">var</span> b = <span class="keyword">this</span>.get(i); <span class="keyword">var</span> skip = (i == end - <span class="number">1</span>) ? unusedBit : <span class="number">0</span>; <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">7</span>; j &gt;= skip; --j) &#123; s += (b &gt;&gt; j) &amp; <span class="number">1</span> ? <span class="string">"1"</span> : <span class="string">"0"</span> &#125; <span class="keyword">if</span> (s.length &gt; maxLength) &#123; <span class="keyword">return</span> intro + stringCut(s, maxLength) &#125; &#125; <span class="keyword">return</span> intro + s &#125;; Stream.prototype.parseOctetString = <span class="function"><span class="keyword">function</span> (<span class="params">start, end, maxLength</span>) </span>&#123; <span class="keyword">if</span> (<span class="keyword">this</span>.isASCII(start, end)) &#123; <span class="keyword">return</span> stringCut(<span class="keyword">this</span>.parseStringISO(start, end), maxLength) &#125; <span class="keyword">var</span> len = end - start; <span class="keyword">var</span> s = <span class="string">"("</span> + len + <span class="string">" byte)\n"</span>; maxLength /= <span class="number">2</span>; <span class="keyword">if</span> (len &gt; maxLength) &#123; end = start + maxLength &#125; <span class="keyword">for</span> (<span class="keyword">var</span> i = start; i &lt; end; ++i) &#123; s += <span class="keyword">this</span>.hexByte(<span class="keyword">this</span>.get(i)) &#125; <span class="keyword">if</span> (len &gt; maxLength) &#123; s += ellipsis &#125; <span class="keyword">return</span> s &#125;; Stream.prototype.parseOID = <span class="function"><span class="keyword">function</span> (<span class="params">start, end, maxLength</span>) </span>&#123; <span class="keyword">var</span> s = <span class="string">""</span>; <span class="keyword">var</span> n = <span class="keyword">new</span> Int10(); <span class="keyword">var</span> bits = <span class="number">0</span>; <span class="keyword">for</span> (<span class="keyword">var</span> i = start; i &lt; end; ++i) &#123; <span class="keyword">var</span> v = <span class="keyword">this</span>.get(i); n.mulAdd(<span class="number">128</span>, v &amp; <span class="number">0x7F</span>); bits += <span class="number">7</span>; <span class="keyword">if</span> (!(v &amp; <span class="number">0x80</span>)) &#123; <span class="keyword">if</span> (s === <span class="string">""</span>) &#123; n = n.simplify(); <span class="keyword">if</span> (n <span class="keyword">instanceof</span> Int10) &#123; n.sub(<span class="number">80</span>); s = <span class="string">"2."</span> + n.toString() &#125; <span class="keyword">else</span> &#123; <span class="keyword">var</span> m = n &lt; <span class="number">80</span> ? n &lt; <span class="number">40</span> ? <span class="number">0</span> : <span class="number">1</span> : <span class="number">2</span>; s = m + <span class="string">"."</span> + (n - m * <span class="number">40</span>) &#125; &#125; <span class="keyword">else</span> &#123; s += <span class="string">"."</span> + n.toString() &#125; <span class="keyword">if</span> (s.length &gt; maxLength) &#123; <span class="keyword">return</span> stringCut(s, maxLength) &#125; n = <span class="keyword">new</span> Int10(); bits = <span class="number">0</span> &#125; &#125; <span class="keyword">if</span> (bits &gt; <span class="number">0</span>) &#123; s += <span class="string">".incomplete"</span> &#125; <span class="keyword">return</span> s &#125;; <span class="keyword">return</span> Stream &#125;()); <span class="keyword">var</span> ASN1 = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="function"><span class="keyword">function</span> <span class="title">ASN1</span>(<span class="params">stream, header, length, tag, sub</span>) </span>&#123; <span class="keyword">if</span> (!(tag <span class="keyword">instanceof</span> ASN1Tag)) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Invalid tag value."</span>); &#125; <span class="keyword">this</span>.stream = stream; <span class="keyword">this</span>.header = header; <span class="keyword">this</span>.length = length; <span class="keyword">this</span>.tag = tag; <span class="keyword">this</span>.sub = sub &#125; ASN1.prototype.typeName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">switch</span> (<span class="keyword">this</span>.tag.tagClass) &#123; <span class="keyword">case</span> <span class="number">0</span>: <span class="keyword">switch</span> (<span class="keyword">this</span>.tag.tagNumber) &#123; <span class="keyword">case</span> <span class="number">0x00</span>: <span class="keyword">return</span> <span class="string">"EOC"</span>; <span class="keyword">case</span> <span class="number">0x01</span>: <span class="keyword">return</span> <span class="string">"BOOLEAN"</span>; <span class="keyword">case</span> <span class="number">0x02</span>: <span class="keyword">return</span> <span class="string">"INTEGER"</span>; <span class="keyword">case</span> <span class="number">0x03</span>: <span class="keyword">return</span> <span class="string">"BIT_STRING"</span>; <span class="keyword">case</span> <span class="number">0x04</span>: <span class="keyword">return</span> <span class="string">"OCTET_STRING"</span>; <span class="keyword">case</span> <span class="number">0x05</span>: <span class="keyword">return</span> <span class="string">"NULL"</span>; <span class="keyword">case</span> <span class="number">0x06</span>: <span class="keyword">return</span> <span class="string">"OBJECT_IDENTIFIER"</span>; <span class="keyword">case</span> <span class="number">0x07</span>: <span class="keyword">return</span> <span class="string">"ObjectDescriptor"</span>; <span class="keyword">case</span> <span class="number">0x08</span>: <span class="keyword">return</span> <span class="string">"EXTERNAL"</span>; <span class="keyword">case</span> <span class="number">0x09</span>: <span class="keyword">return</span> <span class="string">"REAL"</span>; <span class="keyword">case</span> <span class="number">0x0A</span>: <span class="keyword">return</span> <span class="string">"ENUMERATED"</span>; <span class="keyword">case</span> <span class="number">0x0B</span>: <span class="keyword">return</span> <span class="string">"EMBEDDED_PDV"</span>; <span class="keyword">case</span> <span class="number">0x0C</span>: <span class="keyword">return</span> <span class="string">"UTF8String"</span>; <span class="keyword">case</span> <span class="number">0x10</span>: <span class="keyword">return</span> <span class="string">"SEQUENCE"</span>; <span class="keyword">case</span> <span class="number">0x11</span>: <span class="keyword">return</span> <span class="string">"SET"</span>; <span class="keyword">case</span> <span class="number">0x12</span>: <span class="keyword">return</span> <span class="string">"NumericString"</span>; <span class="keyword">case</span> <span class="number">0x13</span>: <span class="keyword">return</span> <span class="string">"PrintableString"</span>; <span class="keyword">case</span> <span class="number">0x14</span>: <span class="keyword">return</span> <span class="string">"TeletexString"</span>; <span class="keyword">case</span> <span class="number">0x15</span>: <span class="keyword">return</span> <span class="string">"VideotexString"</span>; <span class="keyword">case</span> <span class="number">0x16</span>: <span class="keyword">return</span> <span class="string">"IA5String"</span>; <span class="keyword">case</span> <span class="number">0x17</span>: <span class="keyword">return</span> <span class="string">"UTCTime"</span>; <span class="keyword">case</span> <span class="number">0x18</span>: <span class="keyword">return</span> <span class="string">"GeneralizedTime"</span>; <span class="keyword">case</span> <span class="number">0x19</span>: <span class="keyword">return</span> <span class="string">"GraphicString"</span>; <span class="keyword">case</span> <span class="number">0x1A</span>: <span class="keyword">return</span> <span class="string">"VisibleString"</span>; <span class="keyword">case</span> <span class="number">0x1B</span>: <span class="keyword">return</span> <span class="string">"GeneralString"</span>; <span class="keyword">case</span> <span class="number">0x1C</span>: <span class="keyword">return</span> <span class="string">"UniversalString"</span>; <span class="keyword">case</span> <span class="number">0x1E</span>: <span class="keyword">return</span> <span class="string">"BMPString"</span> &#125;<span class="keyword">return</span> <span class="string">"Universal_"</span> + <span class="keyword">this</span>.tag.tagNumber.toString(); <span class="keyword">case</span> <span class="number">1</span>: <span class="keyword">return</span> <span class="string">"Application_"</span> + <span class="keyword">this</span>.tag.tagNumber.toString(); <span class="keyword">case</span> <span class="number">2</span>: <span class="keyword">return</span> <span class="string">"["</span> + <span class="keyword">this</span>.tag.tagNumber.toString() + <span class="string">"]"</span>; <span class="keyword">case</span> <span class="number">3</span>: <span class="keyword">return</span> <span class="string">"Private_"</span> + <span class="keyword">this</span>.tag.tagNumber.toString() &#125; &#125;; ASN1.prototype.content = <span class="function"><span class="keyword">function</span> (<span class="params">maxLength</span>) </span>&#123; <span class="keyword">if</span> (<span class="keyword">this</span>.tag === <span class="literal">undefined</span>) &#123; <span class="keyword">return</span> <span class="literal">null</span> &#125; <span class="keyword">if</span> (maxLength === <span class="literal">undefined</span>) &#123; maxLength = <span class="literal">Infinity</span> &#125; <span class="keyword">var</span> content = <span class="keyword">this</span>.posContent(); <span class="keyword">var</span> len = <span class="built_in">Math</span>.abs(<span class="keyword">this</span>.length); <span class="keyword">if</span> (!<span class="keyword">this</span>.tag.isUniversal()) &#123; <span class="keyword">if</span> (<span class="keyword">this</span>.sub !== <span class="literal">null</span>) &#123; <span class="keyword">return</span> <span class="string">"("</span> + <span class="keyword">this</span>.sub.length + <span class="string">" elem)"</span> &#125; <span class="keyword">return</span> <span class="keyword">this</span>.stream.parseOctetString(content, content + len, maxLength) &#125; <span class="keyword">switch</span> (<span class="keyword">this</span>.tag.tagNumber) &#123; <span class="keyword">case</span> <span class="number">0x01</span>: <span class="keyword">return</span> (<span class="keyword">this</span>.stream.get(content) === <span class="number">0</span>) ? <span class="string">"false"</span> : <span class="string">"true"</span>; <span class="keyword">case</span> <span class="number">0x02</span>: <span class="keyword">return</span> <span class="keyword">this</span>.stream.parseInteger(content, content + len); <span class="keyword">case</span> <span class="number">0x03</span>: <span class="keyword">return</span> <span class="keyword">this</span>.sub ? <span class="string">"("</span> + <span class="keyword">this</span>.sub.length + <span class="string">" elem)"</span> : <span class="keyword">this</span>.stream.parseBitString(content, content + len, maxLength); <span class="keyword">case</span> <span class="number">0x04</span>: <span class="keyword">return</span> <span class="keyword">this</span>.sub ? <span class="string">"("</span> + <span class="keyword">this</span>.sub.length + <span class="string">" elem)"</span> : <span class="keyword">this</span>.stream.parseOctetString(content, content + len, maxLength); <span class="keyword">case</span> <span class="number">0x06</span>: <span class="keyword">return</span> <span class="keyword">this</span>.stream.parseOID(content, content + len, maxLength); <span class="keyword">case</span> <span class="number">0x10</span>: <span class="keyword">case</span> <span class="number">0x11</span>: <span class="keyword">if</span> (<span class="keyword">this</span>.sub !== <span class="literal">null</span>) &#123; <span class="keyword">return</span> <span class="string">"("</span> + <span class="keyword">this</span>.sub.length + <span class="string">" elem)"</span> &#125; <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="string">"(no elem)"</span> &#125; <span class="keyword">case</span> <span class="number">0x0C</span>: <span class="keyword">return</span> stringCut(<span class="keyword">this</span>.stream.parseStringUTF(content, content + len), maxLength); <span class="keyword">case</span> <span class="number">0x12</span>: <span class="keyword">case</span> <span class="number">0x13</span>: <span class="keyword">case</span> <span class="number">0x14</span>: <span class="keyword">case</span> <span class="number">0x15</span>: <span class="keyword">case</span> <span class="number">0x16</span>: <span class="keyword">case</span> <span class="number">0x1A</span>: <span class="keyword">return</span> stringCut(<span class="keyword">this</span>.stream.parseStringISO(content, content + len), maxLength); <span class="keyword">case</span> <span class="number">0x1E</span>: <span class="keyword">return</span> stringCut(<span class="keyword">this</span>.stream.parseStringBMP(content, content + len), maxLength); <span class="keyword">case</span> <span class="number">0x17</span>: <span class="keyword">case</span> <span class="number">0x18</span>: <span class="keyword">return</span> <span class="keyword">this</span>.stream.parseTime(content, content + len, (<span class="keyword">this</span>.tag.tagNumber == <span class="number">0x17</span>)) &#125;<span class="keyword">return</span> <span class="literal">null</span> &#125;; ASN1.prototype.toString = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.typeName() + <span class="string">"@"</span> + <span class="keyword">this</span>.stream.pos + <span class="string">"[header:"</span> + <span class="keyword">this</span>.header + <span class="string">",length:"</span> + <span class="keyword">this</span>.length + <span class="string">",sub:"</span> + ((<span class="keyword">this</span>.sub === <span class="literal">null</span>) ? <span class="string">"null"</span> : <span class="keyword">this</span>.sub.length) + <span class="string">"]"</span> &#125;; ASN1.prototype.toPrettyString = <span class="function"><span class="keyword">function</span> (<span class="params">indent</span>) </span>&#123; <span class="keyword">if</span> (indent === <span class="literal">undefined</span>) &#123; indent = <span class="string">""</span> &#125; <span class="keyword">var</span> s = indent + <span class="keyword">this</span>.typeName() + <span class="string">" @"</span> + <span class="keyword">this</span>.stream.pos; <span class="keyword">if</span> (<span class="keyword">this</span>.length &gt;= <span class="number">0</span>) &#123; s += <span class="string">"+"</span> &#125; s += <span class="keyword">this</span>.length; <span class="keyword">if</span> (<span class="keyword">this</span>.tag.tagConstructed) &#123; s += <span class="string">" (constructed)"</span> &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((<span class="keyword">this</span>.tag.isUniversal() &amp;&amp; ((<span class="keyword">this</span>.tag.tagNumber == <span class="number">0x03</span>) || (<span class="keyword">this</span>.tag.tagNumber == <span class="number">0x04</span>))) &amp;&amp; (<span class="keyword">this</span>.sub !== <span class="literal">null</span>)) &#123; s += <span class="string">" (encapsulates)"</span> &#125; s += <span class="string">"\n"</span>; <span class="keyword">if</span> (<span class="keyword">this</span>.sub !== <span class="literal">null</span>) &#123; indent += <span class="string">"  "</span>; <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, max = <span class="keyword">this</span>.sub.length; i &lt; max; ++i) &#123; s += <span class="keyword">this</span>.sub[i].toPrettyString(indent) &#125; &#125; <span class="keyword">return</span> s &#125;; ASN1.prototype.posStart = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.stream.pos &#125;; ASN1.prototype.posContent = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.stream.pos + <span class="keyword">this</span>.header &#125;; ASN1.prototype.posEnd = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.stream.pos + <span class="keyword">this</span>.header + <span class="built_in">Math</span>.abs(<span class="keyword">this</span>.length) &#125;; ASN1.prototype.toHexString = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.stream.hexDump(<span class="keyword">this</span>.posStart(), <span class="keyword">this</span>.posEnd(), <span class="literal">true</span>) &#125;; ASN1.decodeLength = <span class="function"><span class="keyword">function</span> (<span class="params">stream</span>) </span>&#123; <span class="keyword">var</span> buf = stream.get(); <span class="keyword">var</span> len = buf &amp; <span class="number">0x7F</span>; <span class="keyword">if</span> (len == buf) &#123; <span class="keyword">return</span> len &#125; <span class="keyword">if</span> (len &gt; <span class="number">6</span>) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Length over 48 bits not supported at position "</span> + (stream.pos - <span class="number">1</span>)); &#125; <span class="keyword">if</span> (len === <span class="number">0</span>) &#123; <span class="keyword">return</span> <span class="literal">null</span> &#125; buf = <span class="number">0</span>; <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len; ++i) &#123; buf = (buf * <span class="number">256</span>) + stream.get() &#125; <span class="keyword">return</span> buf &#125;; ASN1.prototype.getHexStringValue = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">var</span> hexString = <span class="keyword">this</span>.toHexString(); <span class="keyword">var</span> offset = <span class="keyword">this</span>.header * <span class="number">2</span>; <span class="keyword">var</span> length = <span class="keyword">this</span>.length * <span class="number">2</span>; <span class="keyword">return</span> hexString.substr(offset, length) &#125;; ASN1.decode = <span class="function"><span class="keyword">function</span> (<span class="params">str</span>) </span>&#123; <span class="keyword">var</span> stream; <span class="keyword">if</span> (!(str <span class="keyword">instanceof</span> Stream)) &#123; stream = <span class="keyword">new</span> Stream(str, <span class="number">0</span>) &#125; <span class="keyword">else</span> &#123; stream = str &#125; <span class="keyword">var</span> streamStart = <span class="keyword">new</span> Stream(stream); <span class="keyword">var</span> tag = <span class="keyword">new</span> ASN1Tag(stream); <span class="keyword">var</span> len = ASN1.decodeLength(stream); <span class="keyword">var</span> start = stream.pos; <span class="keyword">var</span> header = start - streamStart.pos; <span class="keyword">var</span> sub = <span class="literal">null</span>; <span class="keyword">var</span> getSub = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">var</span> ret = []; <span class="keyword">if</span> (len !== <span class="literal">null</span>) &#123; <span class="keyword">var</span> end = start + len; <span class="keyword">while</span> (stream.pos &lt; end) &#123; ret[ret.length] = ASN1.decode(stream) &#125; <span class="keyword">if</span> (stream.pos != end) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Content size is not correct for container starting at offset "</span> + start); &#125; &#125; <span class="keyword">else</span> &#123; <span class="keyword">try</span> &#123; <span class="keyword">for</span> (; ;) &#123; <span class="keyword">var</span> s = ASN1.decode(stream); <span class="keyword">if</span> (s.tag.isEOC()) &#123; <span class="keyword">break</span> &#125; ret[ret.length] = s &#125; len = start - stream.pos &#125; <span class="keyword">catch</span> (e) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Exception while decoding undefined length content: "</span> + e); &#125; &#125; <span class="keyword">return</span> ret &#125;; <span class="keyword">if</span> (tag.tagConstructed) &#123; sub = getSub() &#125; <span class="keyword">else</span> <span class="keyword">if</span> (tag.isUniversal() &amp;&amp; ((tag.tagNumber == <span class="number">0x03</span>) || (tag.tagNumber == <span class="number">0x04</span>))) &#123; <span class="keyword">try</span> &#123; <span class="keyword">if</span> (tag.tagNumber == <span class="number">0x03</span>) &#123; <span class="keyword">if</span> (stream.get() != <span class="number">0</span>) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"BIT STRINGs with unused bits cannot encapsulate."</span>); &#125; &#125; sub = getSub(); <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; sub.length; ++i) &#123; <span class="keyword">if</span> (sub[i].tag.isEOC()) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"EOC is not supposed to be actual content."</span>); &#125; &#125; &#125; <span class="keyword">catch</span> (e) &#123; sub = <span class="literal">null</span> &#125; &#125; <span class="keyword">if</span> (sub === <span class="literal">null</span>) &#123; <span class="keyword">if</span> (len === <span class="literal">null</span>) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"We can't skip over an invalid tag with undefined length at offset "</span> + start); &#125; stream.pos = start + <span class="built_in">Math</span>.abs(len) &#125; <span class="keyword">return</span> <span class="keyword">new</span> ASN1(streamStart, header, len, tag, sub) &#125;; <span class="keyword">return</span> ASN1 &#125;()); <span class="keyword">var</span> ASN1Tag = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="function"><span class="keyword">function</span> <span class="title">ASN1Tag</span>(<span class="params">stream</span>) </span>&#123; <span class="keyword">var</span> buf = stream.get(); <span class="keyword">this</span>.tagClass = buf &gt;&gt; <span class="number">6</span>; <span class="keyword">this</span>.tagConstructed = ((buf &amp; <span class="number">0x20</span>) !== <span class="number">0</span>); <span class="keyword">this</span>.tagNumber = buf &amp; <span class="number">0x1F</span>; <span class="keyword">if</span> (<span class="keyword">this</span>.tagNumber == <span class="number">0x1F</span>) &#123; <span class="keyword">var</span> n = <span class="keyword">new</span> Int10(); <span class="keyword">do</span> &#123; buf = stream.get(); n.mulAdd(<span class="number">128</span>, buf &amp; <span class="number">0x7F</span>) &#125; <span class="keyword">while</span> (buf &amp; <span class="number">0x80</span>); <span class="keyword">this</span>.tagNumber = n.simplify() &#125; &#125; ASN1Tag.prototype.isUniversal = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.tagClass === <span class="number">0x00</span> &#125;; ASN1Tag.prototype.isEOC = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.tagClass === <span class="number">0x00</span> &amp;&amp; <span class="keyword">this</span>.tagNumber === <span class="number">0x00</span> &#125;; <span class="keyword">return</span> ASN1Tag &#125;()); <span class="keyword">var</span> dbits; <span class="keyword">var</span> canary = <span class="number">0xdeadbeefcafe</span>; <span class="keyword">var</span> j_lm = ((canary &amp; <span class="number">0xffffff</span>) == <span class="number">0xefcafe</span>); <span class="keyword">var</span> lowprimes = [<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">17</span>, <span class="number">19</span>, <span class="number">23</span>, <span class="number">29</span>, <span class="number">31</span>, <span class="number">37</span>, <span class="number">41</span>, <span class="number">43</span>, <span class="number">47</span>, <span class="number">53</span>, <span class="number">59</span>, <span class="number">61</span>, <span class="number">67</span>, <span class="number">71</span>, <span class="number">73</span>, <span class="number">79</span>, <span class="number">83</span>, <span class="number">89</span>, <span class="number">97</span>, <span class="number">101</span>, <span class="number">103</span>, <span class="number">107</span>, <span class="number">109</span>, <span class="number">113</span>, <span class="number">127</span>, <span class="number">131</span>, <span class="number">137</span>, <span class="number">139</span>, <span class="number">149</span>, <span class="number">151</span>, <span class="number">157</span>, <span class="number">163</span>, <span class="number">167</span>, <span class="number">173</span>, <span class="number">179</span>, <span class="number">181</span>, <span class="number">191</span>, <span class="number">193</span>, <span class="number">197</span>, <span class="number">199</span>, <span class="number">211</span>, <span class="number">223</span>, <span class="number">227</span>, <span class="number">229</span>, <span class="number">233</span>, <span class="number">239</span>, <span class="number">241</span>, <span class="number">251</span>, <span class="number">257</span>, <span class="number">263</span>, <span class="number">269</span>, <span class="number">271</span>, <span class="number">277</span>, <span class="number">281</span>, <span class="number">283</span>, <span class="number">293</span>, <span class="number">307</span>, <span class="number">311</span>, <span class="number">313</span>, <span class="number">317</span>, <span class="number">331</span>, <span class="number">337</span>, <span class="number">347</span>, <span class="number">349</span>, <span class="number">353</span>, <span class="number">359</span>, <span class="number">367</span>, <span class="number">373</span>, <span class="number">379</span>, <span class="number">383</span>, <span class="number">389</span>, <span class="number">397</span>, <span class="number">401</span>, <span class="number">409</span>, <span class="number">419</span>, <span class="number">421</span>, <span class="number">431</span>, <span class="number">433</span>, <span class="number">439</span>, <span class="number">443</span>, <span class="number">449</span>, <span class="number">457</span>, <span class="number">461</span>, <span class="number">463</span>, <span class="number">467</span>, <span class="number">479</span>, <span class="number">487</span>, <span class="number">491</span>, <span class="number">499</span>, <span class="number">503</span>, <span class="number">509</span>, <span class="number">521</span>, <span class="number">523</span>, <span class="number">541</span>, <span class="number">547</span>, <span class="number">557</span>, <span class="number">563</span>, <span class="number">569</span>, <span class="number">571</span>, <span class="number">577</span>, <span class="number">587</span>, <span class="number">593</span>, <span class="number">599</span>, <span class="number">601</span>, <span class="number">607</span>, <span class="number">613</span>, <span class="number">617</span>, <span class="number">619</span>, <span class="number">631</span>, <span class="number">641</span>, <span class="number">643</span>, <span class="number">647</span>, <span class="number">653</span>, <span class="number">659</span>, <span class="number">661</span>, <span class="number">673</span>, <span class="number">677</span>, <span class="number">683</span>, <span class="number">691</span>, <span class="number">701</span>, <span class="number">709</span>, <span class="number">719</span>, <span class="number">727</span>, <span class="number">733</span>, <span class="number">739</span>, <span class="number">743</span>, <span class="number">751</span>, <span class="number">757</span>, <span class="number">761</span>, <span class="number">769</span>, <span class="number">773</span>, <span class="number">787</span>, <span class="number">797</span>, <span class="number">809</span>, <span class="number">811</span>, <span class="number">821</span>, <span class="number">823</span>, <span class="number">827</span>, <span class="number">829</span>, <span class="number">839</span>, <span class="number">853</span>, <span class="number">857</span>, <span class="number">859</span>, <span class="number">863</span>, <span class="number">877</span>, <span class="number">881</span>, <span class="number">883</span>, <span class="number">887</span>, <span class="number">907</span>, <span class="number">911</span>, <span class="number">919</span>, <span class="number">929</span>, <span class="number">937</span>, <span class="number">941</span>, <span class="number">947</span>, <span class="number">953</span>, <span class="number">967</span>, <span class="number">971</span>, <span class="number">977</span>, <span class="number">983</span>, <span class="number">991</span>, <span class="number">997</span>]; <span class="keyword">var</span> lplim = (<span class="number">1</span> &lt;&lt; <span class="number">26</span>) / lowprimes[lowprimes.length - <span class="number">1</span>]; <span class="keyword">var</span> BigInteger = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="function"><span class="keyword">function</span> <span class="title">BigInteger</span>(<span class="params">a, b, c</span>) </span>&#123; <span class="keyword">if</span> (a != <span class="literal">null</span>) &#123; <span class="keyword">if</span> (<span class="string">"number"</span> == <span class="keyword">typeof</span> a) &#123; <span class="keyword">this</span>.fromNumber(a, b, c) &#125; <span class="keyword">else</span> <span class="keyword">if</span> (b == <span class="literal">null</span> &amp;&amp; <span class="string">"string"</span> != <span class="keyword">typeof</span> a) &#123; <span class="keyword">this</span>.fromString(a, <span class="number">256</span>) &#125; <span class="keyword">else</span> &#123; <span class="keyword">this</span>.fromString(a, b) &#125; &#125; &#125; BigInteger.prototype.toString = <span class="function"><span class="keyword">function</span> (<span class="params">b</span>) </span>&#123; <span class="keyword">if</span> (<span class="keyword">this</span>.s &lt; <span class="number">0</span>) &#123; <span class="keyword">return</span> <span class="string">"-"</span> + <span class="keyword">this</span>.negate().toString(b) &#125; <span class="keyword">var</span> k; <span class="keyword">if</span> (b == <span class="number">16</span>) &#123; k = <span class="number">4</span> &#125; <span class="keyword">else</span> <span class="keyword">if</span> (b == <span class="number">8</span>) &#123; k = <span class="number">3</span> &#125; <span class="keyword">else</span> <span class="keyword">if</span> (b == <span class="number">2</span>) &#123; k = <span class="number">1</span> &#125; <span class="keyword">else</span> <span class="keyword">if</span> (b == <span class="number">32</span>) &#123; k = <span class="number">5</span> &#125; <span class="keyword">else</span> <span class="keyword">if</span> (b == <span class="number">4</span>) &#123; k = <span class="number">2</span> &#125; <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="keyword">this</span>.toRadix(b) &#125; <span class="keyword">var</span> km = (<span class="number">1</span> &lt;&lt; k) - <span class="number">1</span>; <span class="keyword">var</span> d; <span class="keyword">var</span> m = <span class="literal">false</span>; <span class="keyword">var</span> r = <span class="string">""</span>; <span class="keyword">var</span> i = <span class="keyword">this</span>.t; <span class="keyword">var</span> p = <span class="keyword">this</span>.DB - (i * <span class="keyword">this</span>.DB) % k; <span class="keyword">if</span> (i-- &gt; <span class="number">0</span>) &#123; <span class="keyword">if</span> (p &lt; <span class="keyword">this</span>.DB &amp;&amp; (d = <span class="keyword">this</span>[i] &gt;&gt; p) &gt; <span class="number">0</span>) &#123; m = <span class="literal">true</span>; r = int2char(d) &#125; <span class="keyword">while</span> (i &gt;= <span class="number">0</span>) &#123; <span class="keyword">if</span> (p &lt; k) &#123; d = (<span class="keyword">this</span>[i] &amp; ((<span class="number">1</span> &lt;&lt; p) - <span class="number">1</span>)) &lt;&lt; (k - p); d |= <span class="keyword">this</span>[--i] &gt;&gt; (p += <span class="keyword">this</span>.DB - k) &#125; <span class="keyword">else</span> &#123; d = (<span class="keyword">this</span>[i] &gt;&gt; (p -= k)) &amp; km; <span class="keyword">if</span> (p &lt;= <span class="number">0</span>) &#123; p += <span class="keyword">this</span>.DB; --i &#125; &#125; <span class="keyword">if</span> (d &gt; <span class="number">0</span>) &#123; m = <span class="literal">true</span> &#125; <span class="keyword">if</span> (m) &#123; r += int2char(d) &#125; &#125; &#125; <span class="keyword">return</span> m ? r : <span class="string">"0"</span> &#125;; BigInteger.prototype.negate = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">var</span> r = nbi(); BigInteger.ZERO.subTo(<span class="keyword">this</span>, r); <span class="keyword">return</span> r &#125;; BigInteger.prototype.abs = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> (<span class="keyword">this</span>.s &lt; <span class="number">0</span>) ? <span class="keyword">this</span>.negate() : <span class="keyword">this</span> &#125;; BigInteger.prototype.compareTo = <span class="function"><span class="keyword">function</span> (<span class="params">a</span>) </span>&#123; <span class="keyword">var</span> r = <span class="keyword">this</span>.s - a.s; <span class="keyword">if</span> (r != <span class="number">0</span>) &#123; <span class="keyword">return</span> r &#125; <span class="keyword">var</span> i = <span class="keyword">this</span>.t; r = i - a.t; <span class="keyword">if</span> (r != <span class="number">0</span>) &#123; <span class="keyword">return</span> (<span class="keyword">this</span>.s &lt; <span class="number">0</span>) ? -r : r &#125; <span class="keyword">while</span> (--i &gt;= <span class="number">0</span>) &#123; <span class="keyword">if</span> ((r = <span class="keyword">this</span>[i] - a[i]) != <span class="number">0</span>) &#123; <span class="keyword">return</span> r &#125; &#125; <span class="keyword">return</span> <span class="number">0</span> &#125;; BigInteger.prototype.bitLength = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">if</span> (<span class="keyword">this</span>.t &lt;= <span class="number">0</span>) &#123; <span class="keyword">return</span> <span class="number">0</span> &#125; <span class="keyword">return</span> <span class="keyword">this</span>.DB * (<span class="keyword">this</span>.t - <span class="number">1</span>) + nbits(<span class="keyword">this</span>[<span class="keyword">this</span>.t - <span class="number">1</span>] ^ (<span class="keyword">this</span>.s &amp; <span class="keyword">this</span>.DM)) &#125;; BigInteger.prototype.mod = <span class="function"><span class="keyword">function</span> (<span class="params">a</span>) </span>&#123; <span class="keyword">var</span> r = nbi(); <span class="keyword">this</span>.abs().divRemTo(a, <span class="literal">null</span>, r); <span class="keyword">if</span> (<span class="keyword">this</span>.s &lt; <span class="number">0</span> &amp;&amp; r.compareTo(BigInteger.ZERO) &gt; <span class="number">0</span>) &#123; a.subTo(r, r) &#125; <span class="keyword">return</span> r &#125;; BigInteger.prototype.modPowInt = <span class="function"><span class="keyword">function</span> (<span class="params">e, m</span>) </span>&#123; <span class="keyword">var</span> z; <span class="keyword">if</span> (e &lt; <span class="number">256</span> || m.isEven()) &#123; z = <span class="keyword">new</span> Classic(m) &#125; <span class="keyword">else</span> &#123; z = <span class="keyword">new</span> Montgomery(m) &#125; <span class="keyword">return</span> <span class="keyword">this</span>.exp(e, z) &#125;; BigInteger.prototype.clone = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">var</span> r = nbi(); <span class="keyword">this</span>.copyTo(r); <span class="keyword">return</span> r &#125;; BigInteger.prototype.intValue = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">if</span> (<span class="keyword">this</span>.s &lt; <span class="number">0</span>) &#123; <span class="keyword">if</span> (<span class="keyword">this</span>.t == <span class="number">1</span>) &#123; <span class="keyword">return</span> <span class="keyword">this</span>[<span class="number">0</span>] - <span class="keyword">this</span>.DV &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.t == <span class="number">0</span>) &#123; <span class="keyword">return</span> <span class="number">-1</span> &#125; &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.t == <span class="number">1</span>) &#123; <span class="keyword">return</span> <span class="keyword">this</span>[<span class="number">0</span>] &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.t == <span class="number">0</span>) &#123; <span class="keyword">return</span> <span class="number">0</span> &#125; <span class="keyword">return</span> ((<span class="keyword">this</span>[<span class="number">1</span>] &amp; ((<span class="number">1</span> &lt;&lt; (<span class="number">32</span> - <span class="keyword">this</span>.DB)) - <span class="number">1</span>)) &lt;&lt; <span class="keyword">this</span>.DB) | <span class="keyword">this</span>[<span class="number">0</span>] &#125;; BigInteger.prototype.byteValue = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> (<span class="keyword">this</span>.t == <span class="number">0</span>) ? <span class="keyword">this</span>.s : (<span class="keyword">this</span>[<span class="number">0</span>] &lt;&lt; <span class="number">24</span>) &gt;&gt; <span class="number">24</span> &#125;; BigInteger.prototype.shortValue = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> (<span class="keyword">this</span>.t == <span class="number">0</span>) ? <span class="keyword">this</span>.s : (<span class="keyword">this</span>[<span class="number">0</span>] &lt;&lt; <span class="number">16</span>) &gt;&gt; <span class="number">16</span> &#125;; BigInteger.prototype.signum = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">if</span> (<span class="keyword">this</span>.s &lt; <span class="number">0</span>) &#123; <span class="keyword">return</span> <span class="number">-1</span> &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.t &lt;= <span class="number">0</span> || (<span class="keyword">this</span>.t == <span class="number">1</span> &amp;&amp; <span class="keyword">this</span>[<span class="number">0</span>] &lt;= <span class="number">0</span>)) &#123; <span class="keyword">return</span> <span class="number">0</span> &#125; <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="number">1</span> &#125; &#125;; BigInteger.prototype.toByteArray = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">var</span> i = <span class="keyword">this</span>.t; <span class="keyword">var</span> r = []; r[<span class="number">0</span>] = <span class="keyword">this</span>.s; <span class="keyword">var</span> p = <span class="keyword">this</span>.DB - (i * <span class="keyword">this</span>.DB) % <span class="number">8</span>; <span class="keyword">var</span> d; <span class="keyword">var</span> k = <span class="number">0</span>; <span class="keyword">if</span> (i-- &gt; <span class="number">0</span>) &#123; <span class="keyword">if</span> (p &lt; <span class="keyword">this</span>.DB &amp;&amp; (d = <span class="keyword">this</span>[i] &gt;&gt; p) != (<span class="keyword">this</span>.s &amp; <span class="keyword">this</span>.DM) &gt;&gt; p) &#123; r[k++] = d | (<span class="keyword">this</span>.s &lt;&lt; (<span class="keyword">this</span>.DB - p)) &#125; <span class="keyword">while</span> (i &gt;= <span class="number">0</span>) &#123; <span class="keyword">if</span> (p &lt; <span class="number">8</span>) &#123; d = (<span class="keyword">this</span>[i] &amp; ((<span class="number">1</span> &lt;&lt; p) - <span class="number">1</span>)) &lt;&lt; (<span class="number">8</span> - p); d |= <span class="keyword">this</span>[--i] &gt;&gt; (p += <span class="keyword">this</span>.DB - <span class="number">8</span>) &#125; <span class="keyword">else</span> &#123; d = (<span class="keyword">this</span>[i] &gt;&gt; (p -= <span class="number">8</span>)) &amp; <span class="number">0xff</span>; <span class="keyword">if</span> (p &lt;= <span class="number">0</span>) &#123; p += <span class="keyword">this</span>.DB; --i &#125; &#125; <span class="keyword">if</span> ((d &amp; <span class="number">0x80</span>) != <span class="number">0</span>) &#123; d |= <span class="number">-256</span> &#125; <span class="keyword">if</span> (k == <span class="number">0</span> &amp;&amp; (<span class="keyword">this</span>.s &amp; <span class="number">0x80</span>) != (d &amp; <span class="number">0x80</span>)) &#123; ++k &#125; <span class="keyword">if</span> (k &gt; <span class="number">0</span> || d != <span class="keyword">this</span>.s) &#123; r[k++] = d &#125; &#125; &#125; <span class="keyword">return</span> r &#125;; BigInteger.prototype.equals = <span class="function"><span class="keyword">function</span> (<span class="params">a</span>) </span>&#123; <span class="keyword">return</span> (<span class="keyword">this</span>.compareTo(a) == <span class="number">0</span>) &#125;; BigInteger.prototype.min = <span class="function"><span class="keyword">function</span> (<span class="params">a</span>) </span>&#123; <span class="keyword">return</span> (<span class="keyword">this</span>.compareTo(a) &lt; <span class="number">0</span>) ? <span class="keyword">this</span> : a &#125;; BigInteger.prototype.max = <span class="function"><span class="keyword">function</span> (<span class="params">a</span>) </span>&#123; <span class="keyword">return</span> (<span class="keyword">this</span>.compareTo(a) &gt; <span class="number">0</span>) ? <span class="keyword">this</span> : a &#125;; BigInteger.prototype.and = <span class="function"><span class="keyword">function</span> (<span class="params">a</span>) </span>&#123; <span class="keyword">var</span> r = nbi(); <span class="keyword">this</span>.bitwiseTo(a, op_and, r); <span class="keyword">return</span> r &#125;; BigInteger.prototype.or = <span class="function"><span class="keyword">function</span> (<span class="params">a</span>) </span>&#123; <span class="keyword">var</span> r = nbi(); <span class="keyword">this</span>.bitwiseTo(a, op_or, r); <span class="keyword">return</span> r &#125;; BigInteger.prototype.xor = <span class="function"><span class="keyword">function</span> (<span class="params">a</span>) </span>&#123; <span class="keyword">var</span> r = nbi(); <span class="keyword">this</span>.bitwiseTo(a, op_xor, r); <span class="keyword">return</span> r &#125;; BigInteger.prototype.andNot = <span class="function"><span class="keyword">function</span> (<span class="params">a</span>) </span>&#123; <span class="keyword">var</span> r = nbi(); <span class="keyword">this</span>.bitwiseTo(a, op_andnot, r); <span class="keyword">return</span> r &#125;; BigInteger.prototype.not = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">var</span> r = nbi(); <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.t; ++i) &#123; r[i] = <span class="keyword">this</span>.DM &amp; ~<span class="keyword">this</span>[i] &#125; r.t = <span class="keyword">this</span>.t; r.s = ~<span class="keyword">this</span>.s; <span class="keyword">return</span> r &#125;; BigInteger.prototype.shiftLeft = <span class="function"><span class="keyword">function</span> (<span class="params">n</span>) </span>&#123; <span class="keyword">var</span> r = nbi(); <span class="keyword">if</span> (n &lt; <span class="number">0</span>) &#123; <span class="keyword">this</span>.rShiftTo(-n, r) &#125; <span class="keyword">else</span> &#123; <span class="keyword">this</span>.lShiftTo(n, r) &#125; <span class="keyword">return</span> r &#125;; BigInteger.prototype.shiftRight = <span class="function"><span class="keyword">function</span> (<span class="params">n</span>) </span>&#123; <span class="keyword">var</span> r = nbi(); <span class="keyword">if</span> (n &lt; <span class="number">0</span>) &#123; <span class="keyword">this</span>.lShiftTo(-n, r) &#125; <span class="keyword">else</span> &#123; <span class="keyword">this</span>.rShiftTo(n, r) &#125; <span class="keyword">return</span> r &#125;; BigInteger.prototype.getLowestSetBit = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.t; ++i) &#123; <span class="keyword">if</span> (<span class="keyword">this</span>[i] != <span class="number">0</span>) &#123; <span class="keyword">return</span> i * <span class="keyword">this</span>.DB + lbit(<span class="keyword">this</span>[i]) &#125; &#125; <span class="keyword">if</span> (<span class="keyword">this</span>.s &lt; <span class="number">0</span>) &#123; <span class="keyword">return</span> <span class="keyword">this</span>.t * <span class="keyword">this</span>.DB &#125; <span class="keyword">return</span> <span class="number">-1</span> &#125;; BigInteger.prototype.bitCount = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">var</span> r = <span class="number">0</span>; <span class="keyword">var</span> x = <span class="keyword">this</span>.s &amp; <span class="keyword">this</span>.DM; <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.t; ++i) &#123; r += cbit(<span class="keyword">this</span>[i] ^ x) &#125; <span class="keyword">return</span> r &#125;; BigInteger.prototype.testBit = <span class="function"><span class="keyword">function</span> (<span class="params">n</span>) </span>&#123; <span class="keyword">var</span> j = <span class="built_in">Math</span>.floor(n / <span class="keyword">this</span>.DB); <span class="keyword">if</span> (j &gt;= <span class="keyword">this</span>.t) &#123; <span class="keyword">return</span> (<span class="keyword">this</span>.s != <span class="number">0</span>) &#125; <span class="keyword">return</span> ((<span class="keyword">this</span>[j] &amp; (<span class="number">1</span> &lt;&lt; (n % <span class="keyword">this</span>.DB))) != <span class="number">0</span>) &#125;; BigInteger.prototype.setBit = <span class="function"><span class="keyword">function</span> (<span class="params">n</span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.changeBit(n, op_or) &#125;; BigInteger.prototype.clearBit = <span class="function"><span class="keyword">function</span> (<span class="params">n</span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.changeBit(n, op_andnot) &#125;; BigInteger.prototype.flipBit = <span class="function"><span class="keyword">function</span> (<span class="params">n</span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.changeBit(n, op_xor) &#125;; BigInteger.prototype.add = <span class="function"><span class="keyword">function</span> (<span class="params">a</span>) </span>&#123; <span class="keyword">var</span> r = nbi(); <span class="keyword">this</span>.addTo(a, r); <span class="keyword">return</span> r &#125;; BigInteger.prototype.subtract = <span class="function"><span class="keyword">function</span> (<span class="params">a</span>) </span>&#123; <span class="keyword">var</span> r = nbi(); <span class="keyword">this</span>.subTo(a, r); <span class="keyword">return</span> r &#125;; BigInteger.prototype.multiply = <span class="function"><span class="keyword">function</span> (<span class="params">a</span>) </span>&#123; <span class="keyword">var</span> r = nbi(); <span class="keyword">this</span>.multiplyTo(a, r); <span class="keyword">return</span> r &#125;; BigInteger.prototype.divide = <span class="function"><span class="keyword">function</span> (<span class="params">a</span>) </span>&#123; <span class="keyword">var</span> r = nbi(); <span class="keyword">this</span>.divRemTo(a, r, <span class="literal">null</span>); <span class="keyword">return</span> r &#125;; BigInteger.prototype.remainder = <span class="function"><span class="keyword">function</span> (<span class="params">a</span>) </span>&#123; <span class="keyword">var</span> r = nbi(); <span class="keyword">this</span>.divRemTo(a, <span class="literal">null</span>, r); <span class="keyword">return</span> r &#125;; BigInteger.prototype.divideAndRemainder = <span class="function"><span class="keyword">function</span> (<span class="params">a</span>) </span>&#123; <span class="keyword">var</span> q = nbi(); <span class="keyword">var</span> r = nbi(); <span class="keyword">this</span>.divRemTo(a, q, r); <span class="keyword">return</span> [q, r] &#125;; BigInteger.prototype.modPow = <span class="function"><span class="keyword">function</span> (<span class="params">e, m</span>) </span>&#123; <span class="keyword">var</span> i = e.bitLength(); <span class="keyword">var</span> k; <span class="keyword">var</span> r = nbv(<span class="number">1</span>); <span class="keyword">var</span> z; <span class="keyword">if</span> (i &lt;= <span class="number">0</span>) &#123; <span class="keyword">return</span> r &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i &lt; <span class="number">18</span>) &#123; k = <span class="number">1</span> &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i &lt; <span class="number">48</span>) &#123; k = <span class="number">3</span> &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i &lt; <span class="number">144</span>) &#123; k = <span class="number">4</span> &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i &lt; <span class="number">768</span>) &#123; k = <span class="number">5</span> &#125; <span class="keyword">else</span> &#123; k = <span class="number">6</span> &#125; <span class="keyword">if</span> (i &lt; <span class="number">8</span>) &#123; z = <span class="keyword">new</span> Classic(m) &#125; <span class="keyword">else</span> <span class="keyword">if</span> (m.isEven()) &#123; z = <span class="keyword">new</span> Barrett(m) &#125; <span class="keyword">else</span> &#123; z = <span class="keyword">new</span> Montgomery(m) &#125; <span class="keyword">var</span> g = []; <span class="keyword">var</span> n = <span class="number">3</span>; <span class="keyword">var</span> k1 = k - <span class="number">1</span>; <span class="keyword">var</span> km = (<span class="number">1</span> &lt;&lt; k) - <span class="number">1</span>; g[<span class="number">1</span>] = z.convert(<span class="keyword">this</span>); <span class="keyword">if</span> (k &gt; <span class="number">1</span>) &#123; <span class="keyword">var</span> g2 = nbi(); z.sqrTo(g[<span class="number">1</span>], g2); <span class="keyword">while</span> (n &lt;= km) &#123; g[n] = nbi(); z.mulTo(g2, g[n - <span class="number">2</span>], g[n]); n += <span class="number">2</span> &#125; &#125; <span class="keyword">var</span> j = e.t - <span class="number">1</span>; <span class="keyword">var</span> w; <span class="keyword">var</span> is1 = <span class="literal">true</span>; <span class="keyword">var</span> r2 = nbi(); <span class="keyword">var</span> t; i = nbits(e[j]) - <span class="number">1</span>; <span class="keyword">while</span> (j &gt;= <span class="number">0</span>) &#123; <span class="keyword">if</span> (i &gt;= k1) &#123; w = (e[j] &gt;&gt; (i - k1)) &amp; km &#125; <span class="keyword">else</span> &#123; w = (e[j] &amp; ((<span class="number">1</span> &lt;&lt; (i + <span class="number">1</span>)) - <span class="number">1</span>)) &lt;&lt; (k1 - i); <span class="keyword">if</span> (j &gt; <span class="number">0</span>) &#123; w |= e[j - <span class="number">1</span>] &gt;&gt; (<span class="keyword">this</span>.DB + i - k1) &#125; &#125; n = k; <span class="keyword">while</span> ((w &amp; <span class="number">1</span>) == <span class="number">0</span>) &#123; w &gt;&gt;= <span class="number">1</span>; --n &#125; <span class="keyword">if</span> ((i -= n) &lt; <span class="number">0</span>) &#123; i += <span class="keyword">this</span>.DB; --j &#125; <span class="keyword">if</span> (is1) &#123; g[w].copyTo(r); is1 = <span class="literal">false</span> &#125; <span class="keyword">else</span> &#123; <span class="keyword">while</span> (n &gt; <span class="number">1</span>) &#123; z.sqrTo(r, r2); z.sqrTo(r2, r); n -= <span class="number">2</span> &#125; <span class="keyword">if</span> (n &gt; <span class="number">0</span>) &#123; z.sqrTo(r, r2) &#125; <span class="keyword">else</span> &#123; t = r; r = r2; r2 = t &#125; z.mulTo(r2, g[w], r) &#125; <span class="keyword">while</span> (j &gt;= <span class="number">0</span> &amp;&amp; (e[j] &amp; (<span class="number">1</span> &lt;&lt; i)) == <span class="number">0</span>) &#123; z.sqrTo(r, r2); t = r; r = r2; r2 = t; <span class="keyword">if</span> (--i &lt; <span class="number">0</span>) &#123; i = <span class="keyword">this</span>.DB - <span class="number">1</span>; --j &#125; &#125; &#125; <span class="keyword">return</span> z.revert(r) &#125;; BigInteger.prototype.modInverse = <span class="function"><span class="keyword">function</span> (<span class="params">m</span>) </span>&#123; <span class="keyword">var</span> ac = m.isEven(); <span class="keyword">if</span> ((<span class="keyword">this</span>.isEven() &amp;&amp; ac) || m.signum() == <span class="number">0</span>) &#123; <span class="keyword">return</span> BigInteger.ZERO &#125; <span class="keyword">var</span> u = m.clone(); <span class="keyword">var</span> v = <span class="keyword">this</span>.clone(); <span class="keyword">var</span> a = nbv(<span class="number">1</span>); <span class="keyword">var</span> b = nbv(<span class="number">0</span>); <span class="keyword">var</span> c = nbv(<span class="number">0</span>); <span class="keyword">var</span> d = nbv(<span class="number">1</span>); <span class="keyword">while</span> (u.signum() != <span class="number">0</span>) &#123; <span class="keyword">while</span> (u.isEven()) &#123; u.rShiftTo(<span class="number">1</span>, u); <span class="keyword">if</span> (ac) &#123; <span class="keyword">if</span> (!a.isEven() || !b.isEven()) &#123; a.addTo(<span class="keyword">this</span>, a); b.subTo(m, b) &#125; a.rShiftTo(<span class="number">1</span>, a) &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!b.isEven()) &#123; b.subTo(m, b) &#125; b.rShiftTo(<span class="number">1</span>, b) &#125; <span class="keyword">while</span> (v.isEven()) &#123; v.rShiftTo(<span class="number">1</span>, v); <span class="keyword">if</span> (ac) &#123; <span class="keyword">if</span> (!c.isEven() || !d.isEven()) &#123; c.addTo(<span class="keyword">this</span>, c); d.subTo(m, d) &#125; c.rShiftTo(<span class="number">1</span>, c) &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!d.isEven()) &#123; d.subTo(m, d) &#125; d.rShiftTo(<span class="number">1</span>, d) &#125; <span class="keyword">if</span> (u.compareTo(v) &gt;= <span class="number">0</span>) &#123; u.subTo(v, u); <span class="keyword">if</span> (ac) &#123; a.subTo(c, a) &#125; b.subTo(d, b) &#125; <span class="keyword">else</span> &#123; v.subTo(u, v); <span class="keyword">if</span> (ac) &#123; c.subTo(a, c) &#125; d.subTo(b, d) &#125; &#125; <span class="keyword">if</span> (v.compareTo(BigInteger.ONE) != <span class="number">0</span>) &#123; <span class="keyword">return</span> BigInteger.ZERO &#125; <span class="keyword">if</span> (d.compareTo(m) &gt;= <span class="number">0</span>) &#123; <span class="keyword">return</span> d.subtract(m) &#125; <span class="keyword">if</span> (d.signum() &lt; <span class="number">0</span>) &#123; d.addTo(m, d) &#125; <span class="keyword">else</span> &#123; <span class="keyword">return</span> d &#125; <span class="keyword">if</span> (d.signum() &lt; <span class="number">0</span>) &#123; <span class="keyword">return</span> d.add(m) &#125; <span class="keyword">else</span> &#123; <span class="keyword">return</span> d &#125; &#125;; BigInteger.prototype.pow = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.exp(e, <span class="keyword">new</span> NullExp()) &#125;; BigInteger.prototype.gcd = <span class="function"><span class="keyword">function</span> (<span class="params">a</span>) </span>&#123; <span class="keyword">var</span> x = (<span class="keyword">this</span>.s &lt; <span class="number">0</span>) ? <span class="keyword">this</span>.negate() : <span class="keyword">this</span>.clone(); <span class="keyword">var</span> y = (a.s &lt; <span class="number">0</span>) ? a.negate() : a.clone(); <span class="keyword">if</span> (x.compareTo(y) &lt; <span class="number">0</span>) &#123; <span class="keyword">var</span> t = x; x = y; y = t &#125; <span class="keyword">var</span> i = x.getLowestSetBit(); <span class="keyword">var</span> g = y.getLowestSetBit(); <span class="keyword">if</span> (g &lt; <span class="number">0</span>) &#123; <span class="keyword">return</span> x &#125; <span class="keyword">if</span> (i &lt; g) &#123; g = i &#125; <span class="keyword">if</span> (g &gt; <span class="number">0</span>) &#123; x.rShiftTo(g, x); y.rShiftTo(g, y) &#125; <span class="keyword">while</span> (x.signum() &gt; <span class="number">0</span>) &#123; <span class="keyword">if</span> ((i = x.getLowestSetBit()) &gt; <span class="number">0</span>) &#123; x.rShiftTo(i, x) &#125; <span class="keyword">if</span> ((i = y.getLowestSetBit()) &gt; <span class="number">0</span>) &#123; y.rShiftTo(i, y) &#125; <span class="keyword">if</span> (x.compareTo(y) &gt;= <span class="number">0</span>) &#123; x.subTo(y, x); x.rShiftTo(<span class="number">1</span>, x) &#125; <span class="keyword">else</span> &#123; y.subTo(x, y); y.rShiftTo(<span class="number">1</span>, y) &#125; &#125; <span class="keyword">if</span> (g &gt; <span class="number">0</span>) &#123; y.lShiftTo(g, y) &#125; <span class="keyword">return</span> y &#125;; BigInteger.prototype.isProbablePrime = <span class="function"><span class="keyword">function</span> (<span class="params">t</span>) </span>&#123; <span class="keyword">var</span> i; <span class="keyword">var</span> x = <span class="keyword">this</span>.abs(); <span class="keyword">if</span> (x.t == <span class="number">1</span> &amp;&amp; x[<span class="number">0</span>] &lt;= lowprimes[lowprimes.length - <span class="number">1</span>]) &#123; <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; lowprimes.length; ++i) &#123; <span class="keyword">if</span> (x[<span class="number">0</span>] == lowprimes[i]) &#123; <span class="keyword">return</span> <span class="literal">true</span> &#125; &#125; <span class="keyword">return</span> <span class="literal">false</span> &#125; <span class="keyword">if</span> (x.isEven()) &#123; <span class="keyword">return</span> <span class="literal">false</span> &#125; i = <span class="number">1</span>; <span class="keyword">while</span> (i &lt; lowprimes.length) &#123; <span class="keyword">var</span> m = lowprimes[i]; <span class="keyword">var</span> j = i + <span class="number">1</span>; <span class="keyword">while</span> (j &lt; lowprimes.length &amp;&amp; m &lt; lplim) &#123; m *= lowprimes[j++] &#125; m = x.modInt(m); <span class="keyword">while</span> (i &lt; j) &#123; <span class="keyword">if</span> (m % lowprimes[i++] == <span class="number">0</span>) &#123; <span class="keyword">return</span> <span class="literal">false</span> &#125; &#125; &#125; <span class="keyword">return</span> x.millerRabin(t) &#125;; BigInteger.prototype.copyTo = <span class="function"><span class="keyword">function</span> (<span class="params">r</span>) </span>&#123; <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="keyword">this</span>.t - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) &#123; r[i] = <span class="keyword">this</span>[i] &#125; r.t = <span class="keyword">this</span>.t; r.s = <span class="keyword">this</span>.s &#125;; BigInteger.prototype.fromInt = <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123; <span class="keyword">this</span>.t = <span class="number">1</span>; <span class="keyword">this</span>.s = (x &lt; <span class="number">0</span>) ? <span class="number">-1</span> : <span class="number">0</span>; <span class="keyword">if</span> (x &gt; <span class="number">0</span>) &#123; <span class="keyword">this</span>[<span class="number">0</span>] = x &#125; <span class="keyword">else</span> <span class="keyword">if</span> (x &lt; <span class="number">-1</span>) &#123; <span class="keyword">this</span>[<span class="number">0</span>] = x + <span class="keyword">this</span>.DV &#125; <span class="keyword">else</span> &#123; <span class="keyword">this</span>.t = <span class="number">0</span> &#125; &#125;; BigInteger.prototype.fromString = <span class="function"><span class="keyword">function</span> (<span class="params">s, b</span>) </span>&#123; <span class="keyword">var</span> k; <span class="keyword">if</span> (b == <span class="number">16</span>) &#123; k = <span class="number">4</span> &#125; <span class="keyword">else</span> <span class="keyword">if</span> (b == <span class="number">8</span>) &#123; k = <span class="number">3</span> &#125; <span class="keyword">else</span> <span class="keyword">if</span> (b == <span class="number">256</span>) &#123; k = <span class="number">8</span> &#125; <span class="keyword">else</span> <span class="keyword">if</span> (b == <span class="number">2</span>) &#123; k = <span class="number">1</span> &#125; <span class="keyword">else</span> <span class="keyword">if</span> (b == <span class="number">32</span>) &#123; k = <span class="number">5</span> &#125; <span class="keyword">else</span> <span class="keyword">if</span> (b == <span class="number">4</span>) &#123; k = <span class="number">2</span> &#125; <span class="keyword">else</span> &#123; <span class="keyword">this</span>.fromRadix(s, b); <span class="keyword">return</span> &#125; <span class="keyword">this</span>.t = <span class="number">0</span>; <span class="keyword">this</span>.s = <span class="number">0</span>; <span class="keyword">var</span> i = s.length; <span class="keyword">var</span> mi = <span class="literal">false</span>; <span class="keyword">var</span> sh = <span class="number">0</span>; <span class="keyword">while</span> (--i &gt;= <span class="number">0</span>) &#123; <span class="keyword">var</span> x = (k == <span class="number">8</span>) ? (+s[i]) &amp; <span class="number">0xff</span> : intAt(s, i); <span class="keyword">if</span> (x &lt; <span class="number">0</span>) &#123; <span class="keyword">if</span> (s.charAt(i) == <span class="string">"-"</span>) &#123; mi = <span class="literal">true</span> &#125; <span class="keyword">continue</span> &#125; mi = <span class="literal">false</span>; <span class="keyword">if</span> (sh == <span class="number">0</span>) &#123; <span class="keyword">this</span>[<span class="keyword">this</span>.t++] = x &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sh + k &gt; <span class="keyword">this</span>.DB) &#123; <span class="keyword">this</span>[<span class="keyword">this</span>.t - <span class="number">1</span>] |= (x &amp; ((<span class="number">1</span> &lt;&lt; (<span class="keyword">this</span>.DB - sh)) - <span class="number">1</span>)) &lt;&lt; sh; <span class="keyword">this</span>[<span class="keyword">this</span>.t++] = (x &gt;&gt; (<span class="keyword">this</span>.DB - sh)) &#125; <span class="keyword">else</span> &#123; <span class="keyword">this</span>[<span class="keyword">this</span>.t - <span class="number">1</span>] |= x &lt;&lt; sh &#125; sh += k; <span class="keyword">if</span> (sh &gt;= <span class="keyword">this</span>.DB) &#123; sh -= <span class="keyword">this</span>.DB &#125; &#125; <span class="keyword">if</span> (k == <span class="number">8</span> &amp;&amp; ((+s[<span class="number">0</span>]) &amp; <span class="number">0x80</span>) != <span class="number">0</span>) &#123; <span class="keyword">this</span>.s = <span class="number">-1</span>; <span class="keyword">if</span> (sh &gt; <span class="number">0</span>) &#123; <span class="keyword">this</span>[<span class="keyword">this</span>.t - <span class="number">1</span>] |= ((<span class="number">1</span> &lt;&lt; (<span class="keyword">this</span>.DB - sh)) - <span class="number">1</span>) &lt;&lt; sh &#125; &#125; <span class="keyword">this</span>.clamp(); <span class="keyword">if</span> (mi) &#123; BigInteger.ZERO.subTo(<span class="keyword">this</span>, <span class="keyword">this</span>) &#125; &#125;; BigInteger.prototype.clamp = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">var</span> c = <span class="keyword">this</span>.s &amp; <span class="keyword">this</span>.DM; <span class="keyword">while</span> (<span class="keyword">this</span>.t &gt; <span class="number">0</span> &amp;&amp; <span class="keyword">this</span>[<span class="keyword">this</span>.t - <span class="number">1</span>] == c) &#123; --<span class="keyword">this</span>.t &#125; &#125;; BigInteger.prototype.dlShiftTo = <span class="function"><span class="keyword">function</span> (<span class="params">n, r</span>) </span>&#123; <span class="keyword">var</span> i; <span class="keyword">for</span> (i = <span class="keyword">this</span>.t - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) &#123; r[i + n] = <span class="keyword">this</span>[i] &#125; <span class="keyword">for</span> (i = n - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) &#123; r[i] = <span class="number">0</span> &#125; r.t = <span class="keyword">this</span>.t + n; r.s = <span class="keyword">this</span>.s &#125;; BigInteger.prototype.drShiftTo = <span class="function"><span class="keyword">function</span> (<span class="params">n, r</span>) </span>&#123; <span class="keyword">for</span> (<span class="keyword">var</span> i = n; i &lt; <span class="keyword">this</span>.t; ++i) &#123; r[i - n] = <span class="keyword">this</span>[i] &#125; r.t = <span class="built_in">Math</span>.max(<span class="keyword">this</span>.t - n, <span class="number">0</span>); r.s = <span class="keyword">this</span>.s &#125;; BigInteger.prototype.lShiftTo = <span class="function"><span class="keyword">function</span> (<span class="params">n, r</span>) </span>&#123; <span class="keyword">var</span> bs = n % <span class="keyword">this</span>.DB; <span class="keyword">var</span> cbs = <span class="keyword">this</span>.DB - bs; <span class="keyword">var</span> bm = (<span class="number">1</span> &lt;&lt; cbs) - <span class="number">1</span>; <span class="keyword">var</span> ds = <span class="built_in">Math</span>.floor(n / <span class="keyword">this</span>.DB); <span class="keyword">var</span> c = (<span class="keyword">this</span>.s &lt;&lt; bs) &amp; <span class="keyword">this</span>.DM; <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="keyword">this</span>.t - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) &#123; r[i + ds + <span class="number">1</span>] = (<span class="keyword">this</span>[i] &gt;&gt; cbs) | c; c = (<span class="keyword">this</span>[i] &amp; bm) &lt;&lt; bs &#125; <span class="keyword">for</span> (<span class="keyword">var</span> i = ds - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) &#123; r[i] = <span class="number">0</span> &#125; r[ds] = c; r.t = <span class="keyword">this</span>.t + ds + <span class="number">1</span>; r.s = <span class="keyword">this</span>.s; r.clamp() &#125;; BigInteger.prototype.rShiftTo = <span class="function"><span class="keyword">function</span> (<span class="params">n, r</span>) </span>&#123; r.s = <span class="keyword">this</span>.s; <span class="keyword">var</span> ds = <span class="built_in">Math</span>.floor(n / <span class="keyword">this</span>.DB); <span class="keyword">if</span> (ds &gt;= <span class="keyword">this</span>.t) &#123; r.t = <span class="number">0</span>; <span class="keyword">return</span> &#125; <span class="keyword">var</span> bs = n % <span class="keyword">this</span>.DB; <span class="keyword">var</span> cbs = <span class="keyword">this</span>.DB - bs; <span class="keyword">var</span> bm = (<span class="number">1</span> &lt;&lt; bs) - <span class="number">1</span>; r[<span class="number">0</span>] = <span class="keyword">this</span>[ds] &gt;&gt; bs; <span class="keyword">for</span> (<span class="keyword">var</span> i = ds + <span class="number">1</span>; i &lt; <span class="keyword">this</span>.t; ++i) &#123; r[i - ds - <span class="number">1</span>] |= (<span class="keyword">this</span>[i] &amp; bm) &lt;&lt; cbs; r[i - ds] = <span class="keyword">this</span>[i] &gt;&gt; bs &#125; <span class="keyword">if</span> (bs &gt; <span class="number">0</span>) &#123; r[<span class="keyword">this</span>.t - ds - <span class="number">1</span>] |= (<span class="keyword">this</span>.s &amp; bm) &lt;&lt; cbs &#125; r.t = <span class="keyword">this</span>.t - ds; r.clamp() &#125;; BigInteger.prototype.subTo = <span class="function"><span class="keyword">function</span> (<span class="params">a, r</span>) </span>&#123; <span class="keyword">var</span> i = <span class="number">0</span>; <span class="keyword">var</span> c = <span class="number">0</span>; <span class="keyword">var</span> m = <span class="built_in">Math</span>.min(a.t, <span class="keyword">this</span>.t); <span class="keyword">while</span> (i &lt; m) &#123; c += <span class="keyword">this</span>[i] - a[i]; r[i++] = c &amp; <span class="keyword">this</span>.DM; c &gt;&gt;= <span class="keyword">this</span>.DB &#125; <span class="keyword">if</span> (a.t &lt; <span class="keyword">this</span>.t) &#123; c -= a.s; <span class="keyword">while</span> (i &lt; <span class="keyword">this</span>.t) &#123; c += <span class="keyword">this</span>[i]; r[i++] = c &amp; <span class="keyword">this</span>.DM; c &gt;&gt;= <span class="keyword">this</span>.DB &#125; c += <span class="keyword">this</span>.s &#125; <span class="keyword">else</span> &#123; c += <span class="keyword">this</span>.s; <span class="keyword">while</span> (i &lt; a.t) &#123; c -= a[i]; r[i++] = c &amp; <span class="keyword">this</span>.DM; c &gt;&gt;= <span class="keyword">this</span>.DB &#125; c -= a.s &#125; r.s = (c &lt; <span class="number">0</span>) ? <span class="number">-1</span> : <span class="number">0</span>; <span class="keyword">if</span> (c &lt; <span class="number">-1</span>) &#123; r[i++] = <span class="keyword">this</span>.DV + c &#125; <span class="keyword">else</span> <span class="keyword">if</span> (c &gt; <span class="number">0</span>) &#123; r[i++] = c &#125; r.t = i; r.clamp() &#125;; BigInteger.prototype.multiplyTo = <span class="function"><span class="keyword">function</span> (<span class="params">a, r</span>) </span>&#123; <span class="keyword">var</span> x = <span class="keyword">this</span>.abs(); <span class="keyword">var</span> y = a.abs(); <span class="keyword">var</span> i = x.t; r.t = i + y.t; <span class="keyword">while</span> (--i &gt;= <span class="number">0</span>) &#123; r[i] = <span class="number">0</span> &#125; <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; y.t; ++i) &#123; r[i + x.t] = x.am(<span class="number">0</span>, y[i], r, i, <span class="number">0</span>, x.t) &#125; r.s = <span class="number">0</span>; r.clamp(); <span class="keyword">if</span> (<span class="keyword">this</span>.s != a.s) &#123; BigInteger.ZERO.subTo(r, r) &#125; &#125;; BigInteger.prototype.squareTo = <span class="function"><span class="keyword">function</span> (<span class="params">r</span>) </span>&#123; <span class="keyword">var</span> x = <span class="keyword">this</span>.abs(); <span class="keyword">var</span> i = r.t = <span class="number">2</span> * x.t; <span class="keyword">while</span> (--i &gt;= <span class="number">0</span>) &#123; r[i] = <span class="number">0</span> &#125; <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; x.t - <span class="number">1</span>; ++i) &#123; <span class="keyword">var</span> c = x.am(i, x[i], r, <span class="number">2</span> * i, <span class="number">0</span>, <span class="number">1</span>); <span class="keyword">if</span> ((r[i + x.t] += x.am(i + <span class="number">1</span>, <span class="number">2</span> * x[i], r, <span class="number">2</span> * i + <span class="number">1</span>, c, x.t - i - <span class="number">1</span>)) &gt;= x.DV) &#123; r[i + x.t] -= x.DV; r[i + x.t + <span class="number">1</span>] = <span class="number">1</span> &#125; &#125; <span class="keyword">if</span> (r.t &gt; <span class="number">0</span>) &#123; r[r.t - <span class="number">1</span>] += x.am(i, x[i], r, <span class="number">2</span> * i, <span class="number">0</span>, <span class="number">1</span>) &#125; r.s = <span class="number">0</span>; r.clamp() &#125;; BigInteger.prototype.divRemTo = <span class="function"><span class="keyword">function</span> (<span class="params">m, q, r</span>) </span>&#123; <span class="keyword">var</span> pm = m.abs(); <span class="keyword">if</span> (pm.t &lt;= <span class="number">0</span>) &#123; <span class="keyword">return</span> &#125; <span class="keyword">var</span> pt = <span class="keyword">this</span>.abs(); <span class="keyword">if</span> (pt.t &lt; pm.t) &#123; <span class="keyword">if</span> (q != <span class="literal">null</span>) &#123; q.fromInt(<span class="number">0</span>) &#125; <span class="keyword">if</span> (r != <span class="literal">null</span>) &#123; <span class="keyword">this</span>.copyTo(r) &#125; <span class="keyword">return</span> &#125; <span class="keyword">if</span> (r == <span class="literal">null</span>) &#123; r = nbi() &#125; <span class="keyword">var</span> y = nbi(); <span class="keyword">var</span> ts = <span class="keyword">this</span>.s; <span class="keyword">var</span> ms = m.s; <span class="keyword">var</span> nsh = <span class="keyword">this</span>.DB - nbits(pm[pm.t - <span class="number">1</span>]); <span class="keyword">if</span> (nsh &gt; <span class="number">0</span>) &#123; pm.lShiftTo(nsh, y); pt.lShiftTo(nsh, r) &#125; <span class="keyword">else</span> &#123; pm.copyTo(y); pt.copyTo(r) &#125; <span class="keyword">var</span> ys = y.t; <span class="keyword">var</span> y0 = y[ys - <span class="number">1</span>]; <span class="keyword">if</span> (y0 == <span class="number">0</span>) &#123; <span class="keyword">return</span> &#125; <span class="keyword">var</span> yt = y0 * (<span class="number">1</span> &lt;&lt; <span class="keyword">this</span>.F1) + ((ys &gt; <span class="number">1</span>) ? y[ys - <span class="number">2</span>] &gt;&gt; <span class="keyword">this</span>.F2 : <span class="number">0</span>); <span class="keyword">var</span> d1 = <span class="keyword">this</span>.FV / yt; <span class="keyword">var</span> d2 = (<span class="number">1</span> &lt;&lt; <span class="keyword">this</span>.F1) / yt; <span class="keyword">var</span> e = <span class="number">1</span> &lt;&lt; <span class="keyword">this</span>.F2; <span class="keyword">var</span> i = r.t; <span class="keyword">var</span> j = i - ys; <span class="keyword">var</span> t = (q == <span class="literal">null</span>) ? nbi() : q; y.dlShiftTo(j, t); <span class="keyword">if</span> (r.compareTo(t) &gt;= <span class="number">0</span>) &#123; r[r.t++] = <span class="number">1</span>; r.subTo(t, r) &#125; BigInteger.ONE.dlShiftTo(ys, t); t.subTo(y, y); <span class="keyword">while</span> (y.t &lt; ys) &#123; y[y.t++] = <span class="number">0</span> &#125; <span class="keyword">while</span> (--j &gt;= <span class="number">0</span>) &#123; <span class="keyword">var</span> qd = (r[--i] == y0) ? <span class="keyword">this</span>.DM : <span class="built_in">Math</span>.floor(r[i] * d1 + (r[i - <span class="number">1</span>] + e) * d2); <span class="keyword">if</span> ((r[i] += y.am(<span class="number">0</span>, qd, r, j, <span class="number">0</span>, ys)) &lt; qd) &#123; y.dlShiftTo(j, t); r.subTo(t, r); <span class="keyword">while</span> (r[i] &lt; --qd) &#123; r.subTo(t, r) &#125; &#125; &#125; <span class="keyword">if</span> (q != <span class="literal">null</span>) &#123; r.drShiftTo(ys, q); <span class="keyword">if</span> (ts != ms) &#123; BigInteger.ZERO.subTo(q, q) &#125; &#125; r.t = ys; r.clamp(); <span class="keyword">if</span> (nsh &gt; <span class="number">0</span>) &#123; r.rShiftTo(nsh, r) &#125; <span class="keyword">if</span> (ts &lt; <span class="number">0</span>) &#123; BigInteger.ZERO.subTo(r, r) &#125; &#125;; BigInteger.prototype.invDigit = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">if</span> (<span class="keyword">this</span>.t &lt; <span class="number">1</span>) &#123; <span class="keyword">return</span> <span class="number">0</span> &#125; <span class="keyword">var</span> x = <span class="keyword">this</span>[<span class="number">0</span>]; <span class="keyword">if</span> ((x &amp; <span class="number">1</span>) == <span class="number">0</span>) &#123; <span class="keyword">return</span> <span class="number">0</span> &#125; <span class="keyword">var</span> y = x &amp; <span class="number">3</span>; y = (y * (<span class="number">2</span> - (x &amp; <span class="number">0xf</span>) * y)) &amp; <span class="number">0xf</span>; y = (y * (<span class="number">2</span> - (x &amp; <span class="number">0xff</span>) * y)) &amp; <span class="number">0xff</span>; y = (y * (<span class="number">2</span> - (((x &amp; <span class="number">0xffff</span>) * y) &amp; <span class="number">0xffff</span>))) &amp; <span class="number">0xffff</span>; y = (y * (<span class="number">2</span> - x * y % <span class="keyword">this</span>.DV)) % <span class="keyword">this</span>.DV; <span class="keyword">return</span> (y &gt; <span class="number">0</span>) ? <span class="keyword">this</span>.DV - y : -y &#125;; BigInteger.prototype.isEven = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> ((<span class="keyword">this</span>.t &gt; <span class="number">0</span>) ? (<span class="keyword">this</span>[<span class="number">0</span>] &amp; <span class="number">1</span>) : <span class="keyword">this</span>.s) == <span class="number">0</span> &#125;; BigInteger.prototype.exp = <span class="function"><span class="keyword">function</span> (<span class="params">e, z</span>) </span>&#123; <span class="keyword">if</span> (e &gt; <span class="number">0xffffffff</span> || e &lt; <span class="number">1</span>) &#123; <span class="keyword">return</span> BigInteger.ONE &#125; <span class="keyword">var</span> r = nbi(); <span class="keyword">var</span> r2 = nbi(); <span class="keyword">var</span> g = z.convert(<span class="keyword">this</span>); <span class="keyword">var</span> i = nbits(e) - <span class="number">1</span>; g.copyTo(r); <span class="keyword">while</span> (--i &gt;= <span class="number">0</span>) &#123; z.sqrTo(r, r2); <span class="keyword">if</span> ((e &amp; (<span class="number">1</span> &lt;&lt; i)) &gt; <span class="number">0</span>) &#123; z.mulTo(r2, g, r) &#125; <span class="keyword">else</span> &#123; <span class="keyword">var</span> t = r; r = r2; r2 = t &#125; &#125; <span class="keyword">return</span> z.revert(r) &#125;; BigInteger.prototype.chunkSize = <span class="function"><span class="keyword">function</span> (<span class="params">r</span>) </span>&#123; <span class="keyword">return</span> <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.LN2 * <span class="keyword">this</span>.DB / <span class="built_in">Math</span>.log(r)) &#125;; BigInteger.prototype.toRadix = <span class="function"><span class="keyword">function</span> (<span class="params">b</span>) </span>&#123; <span class="keyword">if</span> (b == <span class="literal">null</span>) &#123; b = <span class="number">10</span> &#125; <span class="keyword">if</span> (<span class="keyword">this</span>.signum() == <span class="number">0</span> || b &lt; <span class="number">2</span> || b &gt; <span class="number">36</span>) &#123; <span class="keyword">return</span> <span class="string">"0"</span> &#125; <span class="keyword">var</span> cs = <span class="keyword">this</span>.chunkSize(b); <span class="keyword">var</span> a = <span class="built_in">Math</span>.pow(b, cs); <span class="keyword">var</span> d = nbv(a); <span class="keyword">var</span> y = nbi(); <span class="keyword">var</span> z = nbi(); <span class="keyword">var</span> r = <span class="string">""</span>; <span class="keyword">this</span>.divRemTo(d, y, z); <span class="keyword">while</span> (y.signum() &gt; <span class="number">0</span>) &#123; r = (a + z.intValue()).toString(b).substr(<span class="number">1</span>) + r; y.divRemTo(d, y, z) &#125; <span class="keyword">return</span> z.intValue().toString(b) + r &#125;; BigInteger.prototype.fromRadix = <span class="function"><span class="keyword">function</span> (<span class="params">s, b</span>) </span>&#123; <span class="keyword">this</span>.fromInt(<span class="number">0</span>); <span class="keyword">if</span> (b == <span class="literal">null</span>) &#123; b = <span class="number">10</span> &#125; <span class="keyword">var</span> cs = <span class="keyword">this</span>.chunkSize(b); <span class="keyword">var</span> d = <span class="built_in">Math</span>.pow(b, cs); <span class="keyword">var</span> mi = <span class="literal">false</span>; <span class="keyword">var</span> j = <span class="number">0</span>; <span class="keyword">var</span> w = <span class="number">0</span>; <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; s.length; ++i) &#123; <span class="keyword">var</span> x = intAt(s, i); <span class="keyword">if</span> (x &lt; <span class="number">0</span>) &#123; <span class="keyword">if</span> (s.charAt(i) == <span class="string">"-"</span> &amp;&amp; <span class="keyword">this</span>.signum() == <span class="number">0</span>) &#123; mi = <span class="literal">true</span> &#125; <span class="keyword">continue</span> &#125; w = b * w + x; <span class="keyword">if</span> (++j &gt;= cs) &#123; <span class="keyword">this</span>.dMultiply(d); <span class="keyword">this</span>.dAddOffset(w, <span class="number">0</span>); j = <span class="number">0</span>; w = <span class="number">0</span> &#125; &#125; <span class="keyword">if</span> (j &gt; <span class="number">0</span>) &#123; <span class="keyword">this</span>.dMultiply(<span class="built_in">Math</span>.pow(b, j)); <span class="keyword">this</span>.dAddOffset(w, <span class="number">0</span>) &#125; <span class="keyword">if</span> (mi) &#123; BigInteger.ZERO.subTo(<span class="keyword">this</span>, <span class="keyword">this</span>) &#125; &#125;; BigInteger.prototype.fromNumber = <span class="function"><span class="keyword">function</span> (<span class="params">a, b, c</span>) </span>&#123; <span class="keyword">if</span> (<span class="string">"number"</span> == <span class="keyword">typeof</span> b) &#123; <span class="keyword">if</span> (a &lt; <span class="number">2</span>) &#123; <span class="keyword">this</span>.fromInt(<span class="number">1</span>) &#125; <span class="keyword">else</span> &#123; <span class="keyword">this</span>.fromNumber(a, c); <span class="keyword">if</span> (!<span class="keyword">this</span>.testBit(a - <span class="number">1</span>)) &#123; <span class="keyword">this</span>.bitwiseTo(BigInteger.ONE.shiftLeft(a - <span class="number">1</span>), op_or, <span class="keyword">this</span>) &#125; <span class="keyword">if</span> (<span class="keyword">this</span>.isEven()) &#123; <span class="keyword">this</span>.dAddOffset(<span class="number">1</span>, <span class="number">0</span>) &#125; <span class="keyword">while</span> (!<span class="keyword">this</span>.isProbablePrime(b)) &#123; <span class="keyword">this</span>.dAddOffset(<span class="number">2</span>, <span class="number">0</span>); <span class="keyword">if</span> (<span class="keyword">this</span>.bitLength() &gt; a) &#123; <span class="keyword">this</span>.subTo(BigInteger.ONE.shiftLeft(a - <span class="number">1</span>), <span class="keyword">this</span>) &#125; &#125; &#125; &#125; <span class="keyword">else</span> &#123; <span class="keyword">var</span> x = []; <span class="keyword">var</span> t = a &amp; <span class="number">7</span>; x.length = (a &gt;&gt; <span class="number">3</span>) + <span class="number">1</span>; b.nextBytes(x); <span class="keyword">if</span> (t &gt; <span class="number">0</span>) &#123; x[<span class="number">0</span>] &amp;= ((<span class="number">1</span> &lt;&lt; t) - <span class="number">1</span>) &#125; <span class="keyword">else</span> &#123; x[<span class="number">0</span>] = <span class="number">0</span> &#125; <span class="keyword">this</span>.fromString(x, <span class="number">256</span>) &#125; &#125;; BigInteger.prototype.bitwiseTo = <span class="function"><span class="keyword">function</span> (<span class="params">a, op, r</span>) </span>&#123; <span class="keyword">var</span> i; <span class="keyword">var</span> f; <span class="keyword">var</span> m = <span class="built_in">Math</span>.min(a.t, <span class="keyword">this</span>.t); <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; m; ++i) &#123; r[i] = op(<span class="keyword">this</span>[i], a[i]) &#125; <span class="keyword">if</span> (a.t &lt; <span class="keyword">this</span>.t) &#123; f = a.s &amp; <span class="keyword">this</span>.DM; <span class="keyword">for</span> (i = m; i &lt; <span class="keyword">this</span>.t; ++i) &#123; r[i] = op(<span class="keyword">this</span>[i], f) &#125; r.t = <span class="keyword">this</span>.t &#125; <span class="keyword">else</span> &#123; f = <span class="keyword">this</span>.s &amp; <span class="keyword">this</span>.DM; <span class="keyword">for</span> (i = m; i &lt; a.t; ++i) &#123; r[i] = op(f, a[i]) &#125; r.t = a.t &#125; r.s = op(<span class="keyword">this</span>.s, a.s); r.clamp() &#125;; BigInteger.prototype.changeBit = <span class="function"><span class="keyword">function</span> (<span class="params">n, op</span>) </span>&#123; <span class="keyword">var</span> r = BigInteger.ONE.shiftLeft(n); <span class="keyword">this</span>.bitwiseTo(r, op, r); <span class="keyword">return</span> r &#125;; BigInteger.prototype.addTo = <span class="function"><span class="keyword">function</span> (<span class="params">a, r</span>) </span>&#123; <span class="keyword">var</span> i = <span class="number">0</span>; <span class="keyword">var</span> c = <span class="number">0</span>; <span class="keyword">var</span> m = <span class="built_in">Math</span>.min(a.t, <span class="keyword">this</span>.t); <span class="keyword">while</span> (i &lt; m) &#123; c += <span class="keyword">this</span>[i] + a[i]; r[i++] = c &amp; <span class="keyword">this</span>.DM; c &gt;&gt;= <span class="keyword">this</span>.DB &#125; <span class="keyword">if</span> (a.t &lt; <span class="keyword">this</span>.t) &#123; c += a.s; <span class="keyword">while</span> (i &lt; <span class="keyword">this</span>.t) &#123; c += <span class="keyword">this</span>[i]; r[i++] = c &amp; <span class="keyword">this</span>.DM; c &gt;&gt;= <span class="keyword">this</span>.DB &#125; c += <span class="keyword">this</span>.s &#125; <span class="keyword">else</span> &#123; c += <span class="keyword">this</span>.s; <span class="keyword">while</span> (i &lt; a.t) &#123; c += a[i]; r[i++] = c &amp; <span class="keyword">this</span>.DM; c &gt;&gt;= <span class="keyword">this</span>.DB &#125; c += a.s &#125; r.s = (c &lt; <span class="number">0</span>) ? <span class="number">-1</span> : <span class="number">0</span>; <span class="keyword">if</span> (c &gt; <span class="number">0</span>) &#123; r[i++] = c &#125; <span class="keyword">else</span> <span class="keyword">if</span> (c &lt; <span class="number">-1</span>) &#123; r[i++] = <span class="keyword">this</span>.DV + c &#125; r.t = i; r.clamp() &#125;; BigInteger.prototype.dMultiply = <span class="function"><span class="keyword">function</span> (<span class="params">n</span>) </span>&#123; <span class="keyword">this</span>[<span class="keyword">this</span>.t] = <span class="keyword">this</span>.am(<span class="number">0</span>, n - <span class="number">1</span>, <span class="keyword">this</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="keyword">this</span>.t); ++<span class="keyword">this</span>.t; <span class="keyword">this</span>.clamp() &#125;; BigInteger.prototype.dAddOffset = <span class="function"><span class="keyword">function</span> (<span class="params">n, w</span>) </span>&#123; <span class="keyword">if</span> (n == <span class="number">0</span>) &#123; <span class="keyword">return</span> &#125; <span class="keyword">while</span> (<span class="keyword">this</span>.t &lt;= w) &#123; <span class="keyword">this</span>[<span class="keyword">this</span>.t++] = <span class="number">0</span> &#125; <span class="keyword">this</span>[w] += n; <span class="keyword">while</span> (<span class="keyword">this</span>[w] &gt;= <span class="keyword">this</span>.DV) &#123; <span class="keyword">this</span>[w] -= <span class="keyword">this</span>.DV; <span class="keyword">if</span> (++w &gt;= <span class="keyword">this</span>.t) &#123; <span class="keyword">this</span>[<span class="keyword">this</span>.t++] = <span class="number">0</span> &#125; ++<span class="keyword">this</span>[w] &#125; &#125;; BigInteger.prototype.multiplyLowerTo = <span class="function"><span class="keyword">function</span> (<span class="params">a, n, r</span>) </span>&#123; <span class="keyword">var</span> i = <span class="built_in">Math</span>.min(<span class="keyword">this</span>.t + a.t, n); r.s = <span class="number">0</span>; r.t = i; <span class="keyword">while</span> (i &gt; <span class="number">0</span>) &#123; r[--i] = <span class="number">0</span> &#125; <span class="keyword">for</span> (<span class="keyword">var</span> j = r.t - <span class="keyword">this</span>.t; i &lt; j; ++i) &#123; r[i + <span class="keyword">this</span>.t] = <span class="keyword">this</span>.am(<span class="number">0</span>, a[i], r, i, <span class="number">0</span>, <span class="keyword">this</span>.t) &#125; <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="built_in">Math</span>.min(a.t, n); i &lt; j; ++i) &#123; <span class="keyword">this</span>.am(<span class="number">0</span>, a[i], r, i, <span class="number">0</span>, n - i) &#125; r.clamp() &#125;; BigInteger.prototype.multiplyUpperTo = <span class="function"><span class="keyword">function</span> (<span class="params">a, n, r</span>) </span>&#123; --n; <span class="keyword">var</span> i = r.t = <span class="keyword">this</span>.t + a.t - n; r.s = <span class="number">0</span>; <span class="keyword">while</span> (--i &gt;= <span class="number">0</span>) &#123; r[i] = <span class="number">0</span> &#125; <span class="keyword">for</span> (i = <span class="built_in">Math</span>.max(n - <span class="keyword">this</span>.t, <span class="number">0</span>); i &lt; a.t; ++i) &#123; r[<span class="keyword">this</span>.t + i - n] = <span class="keyword">this</span>.am(n - i, a[i], r, <span class="number">0</span>, <span class="number">0</span>, <span class="keyword">this</span>.t + i - n) &#125; r.clamp(); r.drShiftTo(<span class="number">1</span>, r) &#125;; BigInteger.prototype.modInt = <span class="function"><span class="keyword">function</span> (<span class="params">n</span>) </span>&#123; <span class="keyword">if</span> (n &lt;= <span class="number">0</span>) &#123; <span class="keyword">return</span> <span class="number">0</span> &#125; <span class="keyword">var</span> d = <span class="keyword">this</span>.DV % n; <span class="keyword">var</span> r = (<span class="keyword">this</span>.s &lt; <span class="number">0</span>) ? n - <span class="number">1</span> : <span class="number">0</span>; <span class="keyword">if</span> (<span class="keyword">this</span>.t &gt; <span class="number">0</span>) &#123; <span class="keyword">if</span> (d == <span class="number">0</span>) &#123; r = <span class="keyword">this</span>[<span class="number">0</span>] % n &#125; <span class="keyword">else</span> &#123; <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="keyword">this</span>.t - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) &#123; r = (d * r + <span class="keyword">this</span>[i]) % n &#125; &#125; &#125; <span class="keyword">return</span> r &#125;; BigInteger.prototype.millerRabin = <span class="function"><span class="keyword">function</span> (<span class="params">t</span>) </span>&#123; <span class="keyword">var</span> n1 = <span class="keyword">this</span>.subtract(BigInteger.ONE); <span class="keyword">var</span> k = n1.getLowestSetBit(); <span class="keyword">if</span> (k &lt;= <span class="number">0</span>) &#123; <span class="keyword">return</span> <span class="literal">false</span> &#125; <span class="keyword">var</span> r = n1.shiftRight(k); t = (t + <span class="number">1</span>) &gt;&gt; <span class="number">1</span>; <span class="keyword">if</span> (t &gt; lowprimes.length) &#123; t = lowprimes.length &#125; <span class="keyword">var</span> a = nbi(); <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; t; ++i) &#123; a.fromInt(lowprimes[<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * lowprimes.length)]); <span class="keyword">var</span> y = a.modPow(r, <span class="keyword">this</span>); <span class="keyword">if</span> (y.compareTo(BigInteger.ONE) != <span class="number">0</span> &amp;&amp; y.compareTo(n1) != <span class="number">0</span>) &#123; <span class="keyword">var</span> j = <span class="number">1</span>; <span class="keyword">while</span> (j++ &lt; k &amp;&amp; y.compareTo(n1) != <span class="number">0</span>) &#123; y = y.modPowInt(<span class="number">2</span>, <span class="keyword">this</span>); <span class="keyword">if</span> (y.compareTo(BigInteger.ONE) == <span class="number">0</span>) &#123; <span class="keyword">return</span> <span class="literal">false</span> &#125; &#125; <span class="keyword">if</span> (y.compareTo(n1) != <span class="number">0</span>) &#123; <span class="keyword">return</span> <span class="literal">false</span> &#125; &#125; &#125; <span class="keyword">return</span> <span class="literal">true</span> &#125;; BigInteger.prototype.square = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">var</span> r = nbi(); <span class="keyword">this</span>.squareTo(r); <span class="keyword">return</span> r &#125;; BigInteger.prototype.gcda = <span class="function"><span class="keyword">function</span> (<span class="params">a, callback</span>) </span>&#123; <span class="keyword">var</span> x = (<span class="keyword">this</span>.s &lt; <span class="number">0</span>) ? <span class="keyword">this</span>.negate() : <span class="keyword">this</span>.clone(); <span class="keyword">var</span> y = (a.s &lt; <span class="number">0</span>) ? a.negate() : a.clone(); <span class="keyword">if</span> (x.compareTo(y) &lt; <span class="number">0</span>) &#123; <span class="keyword">var</span> t = x; x = y; y = t &#125; <span class="keyword">var</span> i = x.getLowestSetBit(); <span class="keyword">var</span> g = y.getLowestSetBit(); <span class="keyword">if</span> (g &lt; <span class="number">0</span>) &#123; callback(x); <span class="keyword">return</span> &#125; <span class="keyword">if</span> (i &lt; g) &#123; g = i &#125; <span class="keyword">if</span> (g &gt; <span class="number">0</span>) &#123; x.rShiftTo(g, x); y.rShiftTo(g, y) &#125; <span class="keyword">var</span> gcda1 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">if</span> ((i = x.getLowestSetBit()) &gt; <span class="number">0</span>) &#123; x.rShiftTo(i, x) &#125; <span class="keyword">if</span> ((i = y.getLowestSetBit()) &gt; <span class="number">0</span>) &#123; y.rShiftTo(i, y) &#125; <span class="keyword">if</span> (x.compareTo(y) &gt;= <span class="number">0</span>) &#123; x.subTo(y, x); x.rShiftTo(<span class="number">1</span>, x) &#125; <span class="keyword">else</span> &#123; y.subTo(x, y); y.rShiftTo(<span class="number">1</span>, y) &#125; <span class="keyword">if</span> (!(x.signum() &gt; <span class="number">0</span>)) &#123; <span class="keyword">if</span> (g &gt; <span class="number">0</span>) &#123; y.lShiftTo(g, y) &#125; setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; callback(y) &#125;, <span class="number">0</span>) &#125; <span class="keyword">else</span> &#123; setTimeout(gcda1, <span class="number">0</span>) &#125; &#125;; setTimeout(gcda1, <span class="number">10</span>) &#125;; BigInteger.prototype.fromNumberAsync = <span class="function"><span class="keyword">function</span> (<span class="params">a, b, c, callback</span>) </span>&#123; <span class="keyword">if</span> (<span class="string">"number"</span> == <span class="keyword">typeof</span> b) &#123; <span class="keyword">if</span> (a &lt; <span class="number">2</span>) &#123; <span class="keyword">this</span>.fromInt(<span class="number">1</span>) &#125; <span class="keyword">else</span> &#123; <span class="keyword">this</span>.fromNumber(a, c); <span class="keyword">if</span> (!<span class="keyword">this</span>.testBit(a - <span class="number">1</span>)) &#123; <span class="keyword">this</span>.bitwiseTo(BigInteger.ONE.shiftLeft(a - <span class="number">1</span>), op_or, <span class="keyword">this</span>) &#125; <span class="keyword">if</span> (<span class="keyword">this</span>.isEven()) &#123; <span class="keyword">this</span>.dAddOffset(<span class="number">1</span>, <span class="number">0</span>) &#125; <span class="keyword">var</span> bnp_1 = <span class="keyword">this</span>; <span class="keyword">var</span> bnpfn1_1 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; bnp_1.dAddOffset(<span class="number">2</span>, <span class="number">0</span>); <span class="keyword">if</span> (bnp_1.bitLength() &gt; a) &#123; bnp_1.subTo(BigInteger.ONE.shiftLeft(a - <span class="number">1</span>), bnp_1) &#125; <span class="keyword">if</span> (bnp_1.isProbablePrime(b)) &#123; setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; callback() &#125;, <span class="number">0</span>) &#125; <span class="keyword">else</span> &#123; setTimeout(bnpfn1_1, <span class="number">0</span>) &#125; &#125;; setTimeout(bnpfn1_1, <span class="number">0</span>) &#125; &#125; <span class="keyword">else</span> &#123; <span class="keyword">var</span> x = []; <span class="keyword">var</span> t = a &amp; <span class="number">7</span>; x.length = (a &gt;&gt; <span class="number">3</span>) + <span class="number">1</span>; b.nextBytes(x); <span class="keyword">if</span> (t &gt; <span class="number">0</span>) &#123; x[<span class="number">0</span>] &amp;= ((<span class="number">1</span> &lt;&lt; t) - <span class="number">1</span>) &#125; <span class="keyword">else</span> &#123; x[<span class="number">0</span>] = <span class="number">0</span> &#125; <span class="keyword">this</span>.fromString(x, <span class="number">256</span>) &#125; &#125;; <span class="keyword">return</span> BigInteger &#125;()); <span class="keyword">var</span> NullExp = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="function"><span class="keyword">function</span> <span class="title">NullExp</span>(<span class="params"></span>) </span>&#123; &#125; NullExp.prototype.convert = <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123; <span class="keyword">return</span> x &#125;; NullExp.prototype.revert = <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123; <span class="keyword">return</span> x &#125;; NullExp.prototype.mulTo = <span class="function"><span class="keyword">function</span> (<span class="params">x, y, r</span>) </span>&#123; x.multiplyTo(y, r) &#125;; NullExp.prototype.sqrTo = <span class="function"><span class="keyword">function</span> (<span class="params">x, r</span>) </span>&#123; x.squareTo(r) &#125;; <span class="keyword">return</span> NullExp &#125;()); <span class="keyword">var</span> Classic = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="function"><span class="keyword">function</span> <span class="title">Classic</span>(<span class="params">m</span>) </span>&#123; <span class="keyword">this</span>.m = m &#125; Classic.prototype.convert = <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123; <span class="keyword">if</span> (x.s &lt; <span class="number">0</span> || x.compareTo(<span class="keyword">this</span>.m) &gt;= <span class="number">0</span>) &#123; <span class="keyword">return</span> x.mod(<span class="keyword">this</span>.m) &#125; <span class="keyword">else</span> &#123; <span class="keyword">return</span> x &#125; &#125;; Classic.prototype.revert = <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123; <span class="keyword">return</span> x &#125;; Classic.prototype.reduce = <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123; x.divRemTo(<span class="keyword">this</span>.m, <span class="literal">null</span>, x) &#125;; Classic.prototype.mulTo = <span class="function"><span class="keyword">function</span> (<span class="params">x, y, r</span>) </span>&#123; x.multiplyTo(y, r); <span class="keyword">this</span>.reduce(r) &#125;; Classic.prototype.sqrTo = <span class="function"><span class="keyword">function</span> (<span class="params">x, r</span>) </span>&#123; x.squareTo(r); <span class="keyword">this</span>.reduce(r) &#125;; <span class="keyword">return</span> Classic &#125;()); <span class="keyword">var</span> Montgomery = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="function"><span class="keyword">function</span> <span class="title">Montgomery</span>(<span class="params">m</span>) </span>&#123; <span class="keyword">this</span>.m = m; <span class="keyword">this</span>.mp = m.invDigit(); <span class="keyword">this</span>.mpl = <span class="keyword">this</span>.mp &amp; <span class="number">0x7fff</span>; <span class="keyword">this</span>.mph = <span class="keyword">this</span>.mp &gt;&gt; <span class="number">15</span>; <span class="keyword">this</span>.um = (<span class="number">1</span> &lt;&lt; (m.DB - <span class="number">15</span>)) - <span class="number">1</span>; <span class="keyword">this</span>.mt2 = <span class="number">2</span> * m.t &#125; Montgomery.prototype.convert = <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123; <span class="keyword">var</span> r = nbi(); x.abs().dlShiftTo(<span class="keyword">this</span>.m.t, r); r.divRemTo(<span class="keyword">this</span>.m, <span class="literal">null</span>, r); <span class="keyword">if</span> (x.s &lt; <span class="number">0</span> &amp;&amp; r.compareTo(BigInteger.ZERO) &gt; <span class="number">0</span>) &#123; <span class="keyword">this</span>.m.subTo(r, r) &#125; <span class="keyword">return</span> r &#125;; Montgomery.prototype.revert = <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123; <span class="keyword">var</span> r = nbi(); x.copyTo(r); <span class="keyword">this</span>.reduce(r); <span class="keyword">return</span> r &#125;; Montgomery.prototype.reduce = <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123; <span class="keyword">while</span> (x.t &lt;= <span class="keyword">this</span>.mt2) &#123; x[x.t++] = <span class="number">0</span> &#125; <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.m.t; ++i) &#123; <span class="keyword">var</span> j = x[i] &amp; <span class="number">0x7fff</span>; <span class="keyword">var</span> u0 = (j * <span class="keyword">this</span>.mpl + (((j * <span class="keyword">this</span>.mph + (x[i] &gt;&gt; <span class="number">15</span>) * <span class="keyword">this</span>.mpl) &amp; <span class="keyword">this</span>.um) &lt;&lt; <span class="number">15</span>)) &amp; x.DM; j = i + <span class="keyword">this</span>.m.t; x[j] += <span class="keyword">this</span>.m.am(<span class="number">0</span>, u0, x, i, <span class="number">0</span>, <span class="keyword">this</span>.m.t); <span class="keyword">while</span> (x[j] &gt;= x.DV) &#123; x[j] -= x.DV; x[++j]++ &#125; &#125; x.clamp(); x.drShiftTo(<span class="keyword">this</span>.m.t, x); <span class="keyword">if</span> (x.compareTo(<span class="keyword">this</span>.m) &gt;= <span class="number">0</span>) &#123; x.subTo(<span class="keyword">this</span>.m, x) &#125; &#125;; Montgomery.prototype.mulTo = <span class="function"><span class="keyword">function</span> (<span class="params">x, y, r</span>) </span>&#123; x.multiplyTo(y, r); <span class="keyword">this</span>.reduce(r) &#125;; Montgomery.prototype.sqrTo = <span class="function"><span class="keyword">function</span> (<span class="params">x, r</span>) </span>&#123; x.squareTo(r); <span class="keyword">this</span>.reduce(r) &#125;; <span class="keyword">return</span> Montgomery &#125;()); <span class="keyword">var</span> Barrett = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="function"><span class="keyword">function</span> <span class="title">Barrett</span>(<span class="params">m</span>) </span>&#123; <span class="keyword">this</span>.m = m; <span class="keyword">this</span>.r2 = nbi(); <span class="keyword">this</span>.q3 = nbi(); BigInteger.ONE.dlShiftTo(<span class="number">2</span> * m.t, <span class="keyword">this</span>.r2); <span class="keyword">this</span>.mu = <span class="keyword">this</span>.r2.divide(m) &#125; Barrett.prototype.convert = <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123; <span class="keyword">if</span> (x.s &lt; <span class="number">0</span> || x.t &gt; <span class="number">2</span> * <span class="keyword">this</span>.m.t) &#123; <span class="keyword">return</span> x.mod(<span class="keyword">this</span>.m) &#125; <span class="keyword">else</span> <span class="keyword">if</span> (x.compareTo(<span class="keyword">this</span>.m) &lt; <span class="number">0</span>) &#123; <span class="keyword">return</span> x &#125; <span class="keyword">else</span> &#123; <span class="keyword">var</span> r = nbi(); x.copyTo(r); <span class="keyword">this</span>.reduce(r); <span class="keyword">return</span> r &#125; &#125;; Barrett.prototype.revert = <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123; <span class="keyword">return</span> x &#125;; Barrett.prototype.reduce = <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123; x.drShiftTo(<span class="keyword">this</span>.m.t - <span class="number">1</span>, <span class="keyword">this</span>.r2); <span class="keyword">if</span> (x.t &gt; <span class="keyword">this</span>.m.t + <span class="number">1</span>) &#123; x.t = <span class="keyword">this</span>.m.t + <span class="number">1</span>; x.clamp() &#125; <span class="keyword">this</span>.mu.multiplyUpperTo(<span class="keyword">this</span>.r2, <span class="keyword">this</span>.m.t + <span class="number">1</span>, <span class="keyword">this</span>.q3); <span class="keyword">this</span>.m.multiplyLowerTo(<span class="keyword">this</span>.q3, <span class="keyword">this</span>.m.t + <span class="number">1</span>, <span class="keyword">this</span>.r2); <span class="keyword">while</span> (x.compareTo(<span class="keyword">this</span>.r2) &lt; <span class="number">0</span>) &#123; x.dAddOffset(<span class="number">1</span>, <span class="keyword">this</span>.m.t + <span class="number">1</span>) &#125; x.subTo(<span class="keyword">this</span>.r2, x); <span class="keyword">while</span> (x.compareTo(<span class="keyword">this</span>.m) &gt;= <span class="number">0</span>) &#123; x.subTo(<span class="keyword">this</span>.m, x) &#125; &#125;; Barrett.prototype.mulTo = <span class="function"><span class="keyword">function</span> (<span class="params">x, y, r</span>) </span>&#123; x.multiplyTo(y, r); <span class="keyword">this</span>.reduce(r) &#125;; Barrett.prototype.sqrTo = <span class="function"><span class="keyword">function</span> (<span class="params">x, r</span>) </span>&#123; x.squareTo(r); <span class="keyword">this</span>.reduce(r) &#125;; <span class="keyword">return</span> Barrett &#125;()); <span class="function"><span class="keyword">function</span> <span class="title">nbi</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">new</span> BigInteger(<span class="literal">null</span>) &#125; <span class="function"><span class="keyword">function</span> <span class="title">parseBigInt</span>(<span class="params">str, r</span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">new</span> BigInteger(str, r) &#125; <span class="function"><span class="keyword">function</span> <span class="title">am1</span>(<span class="params">i, x, w, j, c, n</span>) </span>&#123; <span class="keyword">while</span> (--n &gt;= <span class="number">0</span>) &#123; <span class="keyword">var</span> v = x * <span class="keyword">this</span>[i++] + w[j] + c; c = <span class="built_in">Math</span>.floor(v / <span class="number">0x4000000</span>); w[j++] = v &amp; <span class="number">0x3ffffff</span> &#125; <span class="keyword">return</span> c &#125; <span class="function"><span class="keyword">function</span> <span class="title">am2</span>(<span class="params">i, x, w, j, c, n</span>) </span>&#123; <span class="keyword">var</span> xl = x &amp; <span class="number">0x7fff</span>; <span class="keyword">var</span> xh = x &gt;&gt; <span class="number">15</span>; <span class="keyword">while</span> (--n &gt;= <span class="number">0</span>) &#123; <span class="keyword">var</span> l = <span class="keyword">this</span>[i] &amp; <span class="number">0x7fff</span>; <span class="keyword">var</span> h = <span class="keyword">this</span>[i++] &gt;&gt; <span class="number">15</span>; <span class="keyword">var</span> m = xh * l + h * xl; l = xl * l + ((m &amp; <span class="number">0x7fff</span>) &lt;&lt; <span class="number">15</span>) + w[j] + (c &amp; <span class="number">0x3fffffff</span>); c = (l &gt;&gt;&gt; <span class="number">30</span>) + (m &gt;&gt;&gt; <span class="number">15</span>) + xh * h + (c &gt;&gt;&gt; <span class="number">30</span>); w[j++] = l &amp; <span class="number">0x3fffffff</span> &#125; <span class="keyword">return</span> c &#125; <span class="function"><span class="keyword">function</span> <span class="title">am3</span>(<span class="params">i, x, w, j, c, n</span>) </span>&#123; <span class="keyword">var</span> xl = x &amp; <span class="number">0x3fff</span>; <span class="keyword">var</span> xh = x &gt;&gt; <span class="number">14</span>; <span class="keyword">while</span> (--n &gt;= <span class="number">0</span>) &#123; <span class="keyword">var</span> l = <span class="keyword">this</span>[i] &amp; <span class="number">0x3fff</span>; <span class="keyword">var</span> h = <span class="keyword">this</span>[i++] &gt;&gt; <span class="number">14</span>; <span class="keyword">var</span> m = xh * l + h * xl; l = xl * l + ((m &amp; <span class="number">0x3fff</span>) &lt;&lt; <span class="number">14</span>) + w[j] + c; c = (l &gt;&gt; <span class="number">28</span>) + (m &gt;&gt; <span class="number">14</span>) + xh * h; w[j++] = l &amp; <span class="number">0xfffffff</span> &#125; <span class="keyword">return</span> c &#125; <span class="keyword">if</span> (j_lm &amp;&amp; (navigator2.appName == <span class="string">"Microsoft Internet Explorer"</span>)) &#123; BigInteger.prototype.am = am2; dbits = <span class="number">30</span> &#125; <span class="keyword">else</span> <span class="keyword">if</span> (j_lm &amp;&amp; (navigator2.appName != <span class="string">"Netscape"</span>)) &#123; BigInteger.prototype.am = am1; dbits = <span class="number">26</span> &#125; <span class="keyword">else</span> &#123; BigInteger.prototype.am = am3; dbits = <span class="number">28</span> &#125; BigInteger.prototype.DB = dbits; BigInteger.prototype.DM = ((<span class="number">1</span> &lt;&lt; dbits) - <span class="number">1</span>); BigInteger.prototype.DV = (<span class="number">1</span> &lt;&lt; dbits); <span class="keyword">var</span> BI_FP = <span class="number">52</span>; BigInteger.prototype.FV = <span class="built_in">Math</span>.pow(<span class="number">2</span>, BI_FP); BigInteger.prototype.F1 = BI_FP - dbits; BigInteger.prototype.F2 = <span class="number">2</span> * dbits - BI_FP; <span class="keyword">var</span> BI_RC = []; <span class="keyword">var</span> rr; <span class="keyword">var</span> vv; rr = <span class="string">"0"</span>.charCodeAt(<span class="number">0</span>); <span class="keyword">for</span> (vv = <span class="number">0</span>; vv &lt;= <span class="number">9</span>; ++vv) &#123; BI_RC[rr++] = vv &#125; rr = <span class="string">"a"</span>.charCodeAt(<span class="number">0</span>); <span class="keyword">for</span> (vv = <span class="number">10</span>; vv &lt; <span class="number">36</span>; ++vv) &#123; BI_RC[rr++] = vv &#125; rr = <span class="string">"A"</span>.charCodeAt(<span class="number">0</span>); <span class="keyword">for</span> (vv = <span class="number">10</span>; vv &lt; <span class="number">36</span>; ++vv) &#123; BI_RC[rr++] = vv &#125; <span class="function"><span class="keyword">function</span> <span class="title">intAt</span>(<span class="params">s, i</span>) </span>&#123; <span class="keyword">var</span> c = BI_RC[s.charCodeAt(i)]; <span class="keyword">return</span> (c == <span class="literal">null</span>) ? <span class="number">-1</span> : c &#125; <span class="function"><span class="keyword">function</span> <span class="title">nbv</span>(<span class="params">i</span>) </span>&#123; <span class="keyword">var</span> r = nbi(); r.fromInt(i); <span class="keyword">return</span> r &#125; <span class="function"><span class="keyword">function</span> <span class="title">nbits</span>(<span class="params">x</span>) </span>&#123; <span class="keyword">var</span> r = <span class="number">1</span>; <span class="keyword">var</span> t; <span class="keyword">if</span> ((t = x &gt;&gt;&gt; <span class="number">16</span>) != <span class="number">0</span>) &#123; x = t; r += <span class="number">16</span> &#125; <span class="keyword">if</span> ((t = x &gt;&gt; <span class="number">8</span>) != <span class="number">0</span>) &#123; x = t; r += <span class="number">8</span> &#125; <span class="keyword">if</span> ((t = x &gt;&gt; <span class="number">4</span>) != <span class="number">0</span>) &#123; x = t; r += <span class="number">4</span> &#125; <span class="keyword">if</span> ((t = x &gt;&gt; <span class="number">2</span>) != <span class="number">0</span>) &#123; x = t; r += <span class="number">2</span> &#125; <span class="keyword">if</span> ((t = x &gt;&gt; <span class="number">1</span>) != <span class="number">0</span>) &#123; x = t; r += <span class="number">1</span> &#125; <span class="keyword">return</span> r &#125; BigInteger.ZERO = nbv(<span class="number">0</span>); BigInteger.ONE = nbv(<span class="number">1</span>); <span class="keyword">var</span> Arcfour = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="function"><span class="keyword">function</span> <span class="title">Arcfour</span>(<span class="params"></span>) </span>&#123; <span class="keyword">this</span>.i = <span class="number">0</span>; <span class="keyword">this</span>.j = <span class="number">0</span>; <span class="keyword">this</span>.S = [] &#125; Arcfour.prototype.init = <span class="function"><span class="keyword">function</span> (<span class="params">key</span>) </span>&#123; <span class="keyword">var</span> i; <span class="keyword">var</span> j; <span class="keyword">var</span> t; <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">256</span>; ++i) &#123; <span class="keyword">this</span>.S[i] = i &#125; j = <span class="number">0</span>; <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">256</span>; ++i) &#123; j = (j + <span class="keyword">this</span>.S[i] + key[i % key.length]) &amp; <span class="number">255</span>; t = <span class="keyword">this</span>.S[i]; <span class="keyword">this</span>.S[i] = <span class="keyword">this</span>.S[j]; <span class="keyword">this</span>.S[j] = t &#125; <span class="keyword">this</span>.i = <span class="number">0</span>; <span class="keyword">this</span>.j = <span class="number">0</span> &#125;; Arcfour.prototype.next = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">var</span> t; <span class="keyword">this</span>.i = (<span class="keyword">this</span>.i + <span class="number">1</span>) &amp; <span class="number">255</span>; <span class="keyword">this</span>.j = (<span class="keyword">this</span>.j + <span class="keyword">this</span>.S[<span class="keyword">this</span>.i]) &amp; <span class="number">255</span>; t = <span class="keyword">this</span>.S[<span class="keyword">this</span>.i]; <span class="keyword">this</span>.S[<span class="keyword">this</span>.i] = <span class="keyword">this</span>.S[<span class="keyword">this</span>.j]; <span class="keyword">this</span>.S[<span class="keyword">this</span>.j] = t; <span class="keyword">return</span> <span class="keyword">this</span>.S[(t + <span class="keyword">this</span>.S[<span class="keyword">this</span>.i]) &amp; <span class="number">255</span>] &#125;; <span class="keyword">return</span> Arcfour &#125;()); <span class="function"><span class="keyword">function</span> <span class="title">prng_newstate</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">new</span> Arcfour() &#125; <span class="keyword">var</span> rng_psize = <span class="number">256</span>; <span class="keyword">var</span> rng_state; <span class="keyword">var</span> rng_pool = <span class="literal">null</span>; <span class="keyword">var</span> rng_pptr; <span class="keyword">if</span> (rng_pool == <span class="literal">null</span>) &#123; rng_pool = []; rng_pptr = <span class="number">0</span>; <span class="keyword">var</span> t = <span class="keyword">void</span> <span class="number">0</span>; <span class="keyword">if</span> (window2.crypto &amp;&amp; window2.crypto.getRandomValues) &#123; <span class="keyword">var</span> z = <span class="keyword">new</span> <span class="built_in">Uint32Array</span>(<span class="number">256</span>); window2.crypto.getRandomValues(z); <span class="keyword">for</span> (t = <span class="number">0</span>; t &lt; z.length; ++t) &#123; rng_pool[rng_pptr++] = z[t] &amp; <span class="number">255</span> &#125; &#125; <span class="keyword">var</span> onMouseMoveListener_1 = <span class="function"><span class="keyword">function</span> (<span class="params">ev</span>) </span>&#123; <span class="keyword">this</span>.count = <span class="keyword">this</span>.count || <span class="number">0</span>; <span class="keyword">if</span> (<span class="keyword">this</span>.count &gt;= <span class="number">256</span> || rng_pptr &gt;= rng_psize) &#123; <span class="keyword">if</span> (window2.removeEventListener) &#123; window2.removeEventListener(<span class="string">"mousemove"</span>, onMouseMoveListener_1, <span class="literal">false</span>) &#125; <span class="keyword">else</span> <span class="keyword">if</span> (window2.detachEvent) &#123; window2.detachEvent(<span class="string">"onmousemove"</span>, onMouseMoveListener_1) &#125; <span class="keyword">return</span> &#125; <span class="keyword">try</span> &#123; <span class="keyword">var</span> mouseCoordinates = ev.x + ev.y; rng_pool[rng_pptr++] = mouseCoordinates &amp; <span class="number">255</span>; <span class="keyword">this</span>.count += <span class="number">1</span> &#125; <span class="keyword">catch</span> (e) &#123; &#125; &#125;; <span class="keyword">if</span> (window2.addEventListener) &#123; window2.addEventListener(<span class="string">"mousemove"</span>, onMouseMoveListener_1, <span class="literal">false</span>) &#125; <span class="keyword">else</span> <span class="keyword">if</span> (window2.attachEvent) &#123; window2.attachEvent(<span class="string">"onmousemove"</span>, onMouseMoveListener_1) &#125; &#125; <span class="function"><span class="keyword">function</span> <span class="title">rng_get_byte</span>(<span class="params"></span>) </span>&#123; <span class="keyword">if</span> (rng_state == <span class="literal">null</span>) &#123; rng_state = prng_newstate(); <span class="keyword">while</span> (rng_pptr &lt; rng_psize) &#123; <span class="keyword">var</span> random = <span class="built_in">Math</span>.floor(<span class="number">65536</span> * <span class="built_in">Math</span>.random()); rng_pool[rng_pptr++] = random &amp; <span class="number">255</span> &#125; rng_state.init(rng_pool); <span class="keyword">for</span> (rng_pptr = <span class="number">0</span>; rng_pptr &lt; rng_pool.length; ++rng_pptr) &#123; rng_pool[rng_pptr] = <span class="number">0</span> &#125; rng_pptr = <span class="number">0</span> &#125; <span class="keyword">return</span> rng_state.next() &#125; <span class="keyword">var</span> SecureRandom = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="function"><span class="keyword">function</span> <span class="title">SecureRandom</span>(<span class="params"></span>) </span>&#123; &#125; SecureRandom.prototype.nextBytes = <span class="function"><span class="keyword">function</span> (<span class="params">ba</span>) </span>&#123; <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; ba.length; ++i) &#123; ba[i] = rng_get_byte() &#125; &#125;; <span class="keyword">return</span> SecureRandom &#125;()); <span class="function"><span class="keyword">function</span> <span class="title">pkcs1pad1</span>(<span class="params">s, n</span>) </span>&#123; <span class="keyword">if</span> (n &lt; s.length + <span class="number">22</span>) &#123; <span class="built_in">console</span>.error(<span class="string">"Message too long for RSA"</span>); <span class="keyword">return</span> <span class="literal">null</span> &#125; <span class="keyword">var</span> len = n - s.length - <span class="number">6</span>; <span class="keyword">var</span> filler = <span class="string">""</span>; <span class="keyword">for</span> (<span class="keyword">var</span> f = <span class="number">0</span>; f &lt; len; f += <span class="number">2</span>) &#123; filler += <span class="string">"ff"</span> &#125; <span class="keyword">var</span> m = <span class="string">"0001"</span> + filler + <span class="string">"00"</span> + s; <span class="keyword">return</span> parseBigInt(m, <span class="number">16</span>) &#125; <span class="function"><span class="keyword">function</span> <span class="title">pkcs1pad2</span>(<span class="params">s, n</span>) </span>&#123; <span class="keyword">if</span> (n &lt; s.length + <span class="number">11</span>) &#123; <span class="built_in">console</span>.error(<span class="string">"Message too long for RSA"</span>); <span class="keyword">return</span> <span class="literal">null</span> &#125; <span class="keyword">var</span> ba = []; <span class="keyword">var</span> i = s.length - <span class="number">1</span>; <span class="keyword">while</span> (i &gt;= <span class="number">0</span> &amp;&amp; n &gt; <span class="number">0</span>) &#123; <span class="keyword">var</span> c = s.charCodeAt(i--); <span class="keyword">if</span> (c &lt; <span class="number">128</span>) &#123; ba[--n] = c &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((c &gt; <span class="number">127</span>) &amp;&amp; (c &lt; <span class="number">2048</span>)) &#123; ba[--n] = (c &amp; <span class="number">63</span>) | <span class="number">128</span>; ba[--n] = (c &gt;&gt; <span class="number">6</span>) | <span class="number">192</span> &#125; <span class="keyword">else</span> &#123; ba[--n] = (c &amp; <span class="number">63</span>) | <span class="number">128</span>; ba[--n] = ((c &gt;&gt; <span class="number">6</span>) &amp; <span class="number">63</span>) | <span class="number">128</span>; ba[--n] = (c &gt;&gt; <span class="number">12</span>) | <span class="number">224</span> &#125; &#125; ba[--n] = <span class="number">0</span>; <span class="keyword">var</span> rng = <span class="keyword">new</span> SecureRandom(); <span class="keyword">var</span> x = []; <span class="keyword">while</span> (n &gt; <span class="number">2</span>) &#123; x[<span class="number">0</span>] = <span class="number">0</span>; <span class="keyword">while</span> (x[<span class="number">0</span>] == <span class="number">0</span>) &#123; rng.nextBytes(x) &#125; ba[--n] = x[<span class="number">0</span>] &#125; ba[--n] = <span class="number">2</span>; ba[--n] = <span class="number">0</span>; <span class="keyword">return</span> <span class="keyword">new</span> BigInteger(ba) &#125; <span class="keyword">var</span> RSAKey = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="function"><span class="keyword">function</span> <span class="title">RSAKey</span>(<span class="params"></span>) </span>&#123; <span class="keyword">this</span>.n = <span class="literal">null</span>; <span class="keyword">this</span>.e = <span class="number">0</span>; <span class="keyword">this</span>.d = <span class="literal">null</span>; <span class="keyword">this</span>.p = <span class="literal">null</span>; <span class="keyword">this</span>.q = <span class="literal">null</span>; <span class="keyword">this</span>.dmp1 = <span class="literal">null</span>; <span class="keyword">this</span>.dmq1 = <span class="literal">null</span>; <span class="keyword">this</span>.coeff = <span class="literal">null</span> &#125; RSAKey.prototype.doPublic = <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123; <span class="keyword">return</span> x.modPowInt(<span class="keyword">this</span>.e, <span class="keyword">this</span>.n) &#125;; RSAKey.prototype.doPrivate = <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123; <span class="keyword">if</span> (<span class="keyword">this</span>.p == <span class="literal">null</span> || <span class="keyword">this</span>.q == <span class="literal">null</span>) &#123; <span class="keyword">return</span> x.modPow(<span class="keyword">this</span>.d, <span class="keyword">this</span>.n) &#125; <span class="keyword">var</span> xp = x.mod(<span class="keyword">this</span>.p).modPow(<span class="keyword">this</span>.dmp1, <span class="keyword">this</span>.p); <span class="keyword">var</span> xq = x.mod(<span class="keyword">this</span>.q).modPow(<span class="keyword">this</span>.dmq1, <span class="keyword">this</span>.q); <span class="keyword">while</span> (xp.compareTo(xq) &lt; <span class="number">0</span>) &#123; xp = xp.add(<span class="keyword">this</span>.p) &#125; <span class="keyword">return</span> xp.subtract(xq).multiply(<span class="keyword">this</span>.coeff).mod(<span class="keyword">this</span>.p).multiply(<span class="keyword">this</span>.q).add(xq) &#125;; RSAKey.prototype.setPublic = <span class="function"><span class="keyword">function</span> (<span class="params">N, E</span>) </span>&#123; <span class="keyword">if</span> (N != <span class="literal">null</span> &amp;&amp; E != <span class="literal">null</span> &amp;&amp; N.length &gt; <span class="number">0</span> &amp;&amp; E.length &gt; <span class="number">0</span>) &#123; <span class="keyword">this</span>.n = parseBigInt(N, <span class="number">16</span>); <span class="keyword">this</span>.e = <span class="built_in">parseInt</span>(E, <span class="number">16</span>) &#125; <span class="keyword">else</span> &#123; <span class="built_in">console</span>.error(<span class="string">"Invalid RSA public key"</span>) &#125; &#125;; RSAKey.prototype.encrypt = <span class="function"><span class="keyword">function</span> (<span class="params">text</span>) </span>&#123; <span class="keyword">var</span> m = pkcs1pad2(text, (<span class="keyword">this</span>.n.bitLength() + <span class="number">7</span>) &gt;&gt; <span class="number">3</span>); <span class="keyword">if</span> (m == <span class="literal">null</span>) &#123; <span class="keyword">return</span> <span class="literal">null</span> &#125; <span class="keyword">var</span> c = <span class="keyword">this</span>.doPublic(m); <span class="keyword">if</span> (c == <span class="literal">null</span>) &#123; <span class="keyword">return</span> <span class="literal">null</span> &#125; <span class="keyword">var</span> h = c.toString(<span class="number">16</span>); <span class="keyword">if</span> ((h.length &amp; <span class="number">1</span>) == <span class="number">0</span>) &#123; <span class="keyword">return</span> h &#125; <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="string">"0"</span> + h &#125; &#125;; RSAKey.prototype.setPrivate = <span class="function"><span class="keyword">function</span> (<span class="params">N, E, D</span>) </span>&#123; <span class="keyword">if</span> (N != <span class="literal">null</span> &amp;&amp; E != <span class="literal">null</span> &amp;&amp; N.length &gt; <span class="number">0</span> &amp;&amp; E.length &gt; <span class="number">0</span>) &#123; <span class="keyword">this</span>.n = parseBigInt(N, <span class="number">16</span>); <span class="keyword">this</span>.e = <span class="built_in">parseInt</span>(E, <span class="number">16</span>); <span class="keyword">this</span>.d = parseBigInt(D, <span class="number">16</span>) &#125; <span class="keyword">else</span> &#123; <span class="built_in">console</span>.error(<span class="string">"Invalid RSA private key"</span>) &#125; &#125;; RSAKey.prototype.setPrivateEx = <span class="function"><span class="keyword">function</span> (<span class="params">N, E, D, P, Q, DP, DQ, C</span>) </span>&#123; <span class="keyword">if</span> (N != <span class="literal">null</span> &amp;&amp; E != <span class="literal">null</span> &amp;&amp; N.length &gt; <span class="number">0</span> &amp;&amp; E.length &gt; <span class="number">0</span>) &#123; <span class="keyword">this</span>.n = parseBigInt(N, <span class="number">16</span>); <span class="keyword">this</span>.e = <span class="built_in">parseInt</span>(E, <span class="number">16</span>); <span class="keyword">this</span>.d = parseBigInt(D, <span class="number">16</span>); <span class="keyword">this</span>.p = parseBigInt(P, <span class="number">16</span>); <span class="keyword">this</span>.q = parseBigInt(Q, <span class="number">16</span>); <span class="keyword">this</span>.dmp1 = parseBigInt(DP, <span class="number">16</span>); <span class="keyword">this</span>.dmq1 = parseBigInt(DQ, <span class="number">16</span>); <span class="keyword">this</span>.coeff = parseBigInt(C, <span class="number">16</span>) &#125; <span class="keyword">else</span> &#123; <span class="built_in">console</span>.error(<span class="string">"Invalid RSA private key"</span>) &#125; &#125;; RSAKey.prototype.generate = <span class="function"><span class="keyword">function</span> (<span class="params">B, E</span>) </span>&#123; <span class="keyword">var</span> rng = <span class="keyword">new</span> SecureRandom(); <span class="keyword">var</span> qs = B &gt;&gt; <span class="number">1</span>; <span class="keyword">this</span>.e = <span class="built_in">parseInt</span>(E, <span class="number">16</span>); <span class="keyword">var</span> ee = <span class="keyword">new</span> BigInteger(E, <span class="number">16</span>); <span class="keyword">for</span> (; ;) &#123; <span class="keyword">for</span> (; ;) &#123; <span class="keyword">this</span>.p = <span class="keyword">new</span> BigInteger(B - qs, <span class="number">1</span>, rng); <span class="keyword">if</span> (<span class="keyword">this</span>.p.subtract(BigInteger.ONE).gcd(ee).compareTo(BigInteger.ONE) == <span class="number">0</span> &amp;&amp; <span class="keyword">this</span>.p.isProbablePrime(<span class="number">10</span>)) &#123; <span class="keyword">break</span> &#125; &#125; <span class="keyword">for</span> (; ;) &#123; <span class="keyword">this</span>.q = <span class="keyword">new</span> BigInteger(qs, <span class="number">1</span>, rng); <span class="keyword">if</span> (<span class="keyword">this</span>.q.subtract(BigInteger.ONE).gcd(ee).compareTo(BigInteger.ONE) == <span class="number">0</span> &amp;&amp; <span class="keyword">this</span>.q.isProbablePrime(<span class="number">10</span>)) &#123; <span class="keyword">break</span> &#125; &#125; <span class="keyword">if</span> (<span class="keyword">this</span>.p.compareTo(<span class="keyword">this</span>.q) &lt;= <span class="number">0</span>) &#123; <span class="keyword">var</span> t = <span class="keyword">this</span>.p; <span class="keyword">this</span>.p = <span class="keyword">this</span>.q; <span class="keyword">this</span>.q = t &#125; <span class="keyword">var</span> p1 = <span class="keyword">this</span>.p.subtract(BigInteger.ONE); <span class="keyword">var</span> q1 = <span class="keyword">this</span>.q.subtract(BigInteger.ONE); <span class="keyword">var</span> phi = p1.multiply(q1); <span class="keyword">if</span> (phi.gcd(ee).compareTo(BigInteger.ONE) == <span class="number">0</span>) &#123; <span class="keyword">this</span>.n = <span class="keyword">this</span>.p.multiply(<span class="keyword">this</span>.q); <span class="keyword">this</span>.d = ee.modInverse(phi); <span class="keyword">this</span>.dmp1 = <span class="keyword">this</span>.d.mod(p1); <span class="keyword">this</span>.dmq1 = <span class="keyword">this</span>.d.mod(q1); <span class="keyword">this</span>.coeff = <span class="keyword">this</span>.q.modInverse(<span class="keyword">this</span>.p); <span class="keyword">break</span> &#125; &#125; &#125;; RSAKey.prototype.decrypt = <span class="function"><span class="keyword">function</span> (<span class="params">ctext</span>) </span>&#123; <span class="keyword">var</span> c = parseBigInt(ctext, <span class="number">16</span>); <span class="keyword">var</span> m = <span class="keyword">this</span>.doPrivate(c); <span class="keyword">if</span> (m == <span class="literal">null</span>) &#123; <span class="keyword">return</span> <span class="literal">null</span> &#125; <span class="keyword">return</span> pkcs1unpad2(m, (<span class="keyword">this</span>.n.bitLength() + <span class="number">7</span>) &gt;&gt; <span class="number">3</span>) &#125;; RSAKey.prototype.generateAsync = <span class="function"><span class="keyword">function</span> (<span class="params">B, E, callback</span>) </span>&#123; <span class="keyword">var</span> rng = <span class="keyword">new</span> SecureRandom(); <span class="keyword">var</span> qs = B &gt;&gt; <span class="number">1</span>; <span class="keyword">this</span>.e = <span class="built_in">parseInt</span>(E, <span class="number">16</span>); <span class="keyword">var</span> ee = <span class="keyword">new</span> BigInteger(E, <span class="number">16</span>); <span class="keyword">var</span> rsa = <span class="keyword">this</span>; <span class="keyword">var</span> loop1 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">var</span> loop4 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">if</span> (rsa.p.compareTo(rsa.q) &lt;= <span class="number">0</span>) &#123; <span class="keyword">var</span> t = rsa.p; rsa.p = rsa.q; rsa.q = t &#125; <span class="keyword">var</span> p1 = rsa.p.subtract(BigInteger.ONE); <span class="keyword">var</span> q1 = rsa.q.subtract(BigInteger.ONE); <span class="keyword">var</span> phi = p1.multiply(q1); <span class="keyword">if</span> (phi.gcd(ee).compareTo(BigInteger.ONE) == <span class="number">0</span>) &#123; rsa.n = rsa.p.multiply(rsa.q); rsa.d = ee.modInverse(phi); rsa.dmp1 = rsa.d.mod(p1); rsa.dmq1 = rsa.d.mod(q1); rsa.coeff = rsa.q.modInverse(rsa.p); setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; callback() &#125;, <span class="number">0</span>) &#125; <span class="keyword">else</span> &#123; setTimeout(loop1, <span class="number">0</span>) &#125; &#125;; <span class="keyword">var</span> loop3 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; rsa.q = nbi(); rsa.q.fromNumberAsync(qs, <span class="number">1</span>, rng, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; rsa.q.subtract(BigInteger.ONE).gcda(ee, <span class="function"><span class="keyword">function</span> (<span class="params">r</span>) </span>&#123; <span class="keyword">if</span> (r.compareTo(BigInteger.ONE) == <span class="number">0</span> &amp;&amp; rsa.q.isProbablePrime(<span class="number">10</span>)) &#123; setTimeout(loop4, <span class="number">0</span>) &#125; <span class="keyword">else</span> &#123; setTimeout(loop3, <span class="number">0</span>) &#125; &#125;) &#125;) &#125;; <span class="keyword">var</span> loop2 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; rsa.p = nbi(); rsa.p.fromNumberAsync(B - qs, <span class="number">1</span>, rng, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; rsa.p.subtract(BigInteger.ONE).gcda(ee, <span class="function"><span class="keyword">function</span> (<span class="params">r</span>) </span>&#123; <span class="keyword">if</span> (r.compareTo(BigInteger.ONE) == <span class="number">0</span> &amp;&amp; rsa.p.isProbablePrime(<span class="number">10</span>)) &#123; setTimeout(loop3, <span class="number">0</span>) &#125; <span class="keyword">else</span> &#123; setTimeout(loop2, <span class="number">0</span>) &#125; &#125;) &#125;) &#125;; setTimeout(loop2, <span class="number">0</span>) &#125;; setTimeout(loop1, <span class="number">0</span>) &#125;; RSAKey.prototype.sign = <span class="function"><span class="keyword">function</span> (<span class="params">text, digestMethod, digestName</span>) </span>&#123; <span class="keyword">var</span> header = getDigestHeader(digestName); <span class="keyword">var</span> digest = header + digestMethod(text).toString(); <span class="keyword">var</span> m = pkcs1pad1(digest, <span class="keyword">this</span>.n.bitLength() / <span class="number">4</span>); <span class="keyword">if</span> (m == <span class="literal">null</span>) &#123; <span class="keyword">return</span> <span class="literal">null</span> &#125; <span class="keyword">var</span> c = <span class="keyword">this</span>.doPrivate(m); <span class="keyword">if</span> (c == <span class="literal">null</span>) &#123; <span class="keyword">return</span> <span class="literal">null</span> &#125; <span class="keyword">var</span> h = c.toString(<span class="number">16</span>); <span class="keyword">if</span> ((h.length &amp; <span class="number">1</span>) == <span class="number">0</span>) &#123; <span class="keyword">return</span> h &#125; <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="string">"0"</span> + h &#125; &#125;; RSAKey.prototype.verify = <span class="function"><span class="keyword">function</span> (<span class="params">text, signature, digestMethod</span>) </span>&#123; <span class="keyword">var</span> c = parseBigInt(signature, <span class="number">16</span>); <span class="keyword">var</span> m = <span class="keyword">this</span>.doPublic(c); <span class="keyword">if</span> (m == <span class="literal">null</span>) &#123; <span class="keyword">return</span> <span class="literal">null</span> &#125; <span class="keyword">var</span> unpadded = m.toString(<span class="number">16</span>).replace(<span class="regexp">/^1f+00/</span>, <span class="string">""</span>); <span class="keyword">var</span> digest = removeDigestHeader(unpadded); <span class="keyword">return</span> digest == digestMethod(text).toString() &#125;; <span class="keyword">return</span> RSAKey &#125;()); <span class="function"><span class="keyword">function</span> <span class="title">pkcs1unpad2</span>(<span class="params">d, n</span>) </span>&#123; <span class="keyword">var</span> b = d.toByteArray(); <span class="keyword">var</span> i = <span class="number">0</span>; <span class="keyword">while</span> (i &lt; b.length &amp;&amp; b[i] == <span class="number">0</span>) &#123; ++i &#125; <span class="keyword">if</span> (b.length - i != n - <span class="number">1</span> || b[i] != <span class="number">2</span>) &#123; <span class="keyword">return</span> <span class="literal">null</span> &#125; ++i; <span class="keyword">while</span> (b[i] != <span class="number">0</span>) &#123; <span class="keyword">if</span> (++i &gt;= b.length) &#123; <span class="keyword">return</span> <span class="literal">null</span> &#125; &#125; <span class="keyword">var</span> ret = <span class="string">""</span>; <span class="keyword">while</span> (++i &lt; b.length) &#123; <span class="keyword">var</span> c = b[i] &amp; <span class="number">255</span>; <span class="keyword">if</span> (c &lt; <span class="number">128</span>) &#123; ret += <span class="built_in">String</span>.fromCharCode(c) &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((c &gt; <span class="number">191</span>) &amp;&amp; (c &lt; <span class="number">224</span>)) &#123; ret += <span class="built_in">String</span>.fromCharCode(((c &amp; <span class="number">31</span>) &lt;&lt; <span class="number">6</span>) | (b[i + <span class="number">1</span>] &amp; <span class="number">63</span>)); ++i &#125; <span class="keyword">else</span> &#123; ret += <span class="built_in">String</span>.fromCharCode(((c &amp; <span class="number">15</span>) &lt;&lt; <span class="number">12</span>) | ((b[i + <span class="number">1</span>] &amp; <span class="number">63</span>) &lt;&lt; <span class="number">6</span>) | (b[i + <span class="number">2</span>] &amp; <span class="number">63</span>)); i += <span class="number">2</span> &#125; &#125; <span class="keyword">return</span> ret &#125; <span class="keyword">var</span> DIGEST_HEADERS = &#123; <span class="attr">md2</span>: <span class="string">"3020300c06082a864886f70d020205000410"</span>, <span class="attr">md5</span>: <span class="string">"3020300c06082a864886f70d020505000410"</span>, <span class="attr">sha1</span>: <span class="string">"3021300906052b0e03021a05000414"</span>, <span class="attr">sha224</span>: <span class="string">"302d300d06096086480165030402040500041c"</span>, <span class="attr">sha256</span>: <span class="string">"3031300d060960864801650304020105000420"</span>, <span class="attr">sha384</span>: <span class="string">"3041300d060960864801650304020205000430"</span>, <span class="attr">sha512</span>: <span class="string">"3051300d060960864801650304020305000440"</span>, <span class="attr">ripemd160</span>: <span class="string">"3021300906052b2403020105000414"</span>, &#125;; <span class="function"><span class="keyword">function</span> <span class="title">getDigestHeader</span>(<span class="params">name</span>) </span>&#123; <span class="keyword">return</span> DIGEST_HEADERS[name] || <span class="string">""</span> &#125; <span class="function"><span class="keyword">function</span> <span class="title">removeDigestHeader</span>(<span class="params">str</span>) </span>&#123; <span class="keyword">for</span> (<span class="keyword">var</span> name_1 <span class="keyword">in</span> DIGEST_HEADERS) &#123; <span class="keyword">if</span> (DIGEST_HEADERS.hasOwnProperty(name_1)) &#123; <span class="keyword">var</span> header = DIGEST_HEADERS[name_1]; <span class="keyword">var</span> len = header.length; <span class="keyword">if</span> (str.substr(<span class="number">0</span>, len) == header) &#123; <span class="keyword">return</span> str.substr(len) &#125; &#125; &#125; <span class="keyword">return</span> str &#125; <span class="keyword">var</span> YAHOO = &#123;&#125;; YAHOO.lang = &#123; <span class="attr">extend</span>: <span class="function"><span class="keyword">function</span> (<span class="params">subc, superc, overrides</span>) </span>&#123; <span class="keyword">if</span> (!superc || !subc) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"YAHOO.lang.extend failed, please check that all dependencies are included."</span>); &#125; <span class="keyword">var</span> F = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; &#125;; F.prototype = superc.prototype; subc.prototype = <span class="keyword">new</span> F(); subc.prototype.constructor = subc; subc.superclass = superc.prototype; <span class="keyword">if</span> (superc.prototype.constructor == <span class="built_in">Object</span>.prototype.constructor) &#123; superc.prototype.constructor = superc &#125; <span class="keyword">if</span> (overrides) &#123; <span class="keyword">var</span> i; <span class="keyword">for</span> (i <span class="keyword">in</span> overrides) &#123; subc.prototype[i] = overrides[i] &#125; <span class="keyword">var</span> _IEEnumFix = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; &#125;, ADD = [<span class="string">"toString"</span>, <span class="string">"valueOf"</span>]; <span class="keyword">try</span> &#123; <span class="keyword">if</span> (<span class="regexp">/MSIE/</span>.test(navigator2.userAgent)) &#123; _IEEnumFix = <span class="function"><span class="keyword">function</span> (<span class="params">r, s</span>) </span>&#123; <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; ADD.length; i = i + <span class="number">1</span>) &#123; <span class="keyword">var</span> fname = ADD[i], f = s[fname]; <span class="keyword">if</span> (<span class="keyword">typeof</span> f === <span class="string">'function'</span> &amp;&amp; f != <span class="built_in">Object</span>.prototype[fname]) &#123; r[fname] = f &#125; &#125; &#125; &#125; &#125; <span class="keyword">catch</span> (ex) &#123; &#125; _IEEnumFix(subc.prototype, overrides) &#125; &#125; &#125;; <span class="keyword">var</span> KJUR = &#123;&#125;; <span class="keyword">if</span> (<span class="keyword">typeof</span> KJUR.asn1 == <span class="string">"undefined"</span> || !KJUR.asn1) KJUR.asn1 = &#123;&#125;; KJUR.asn1.ASN1Util = <span class="keyword">new</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">this</span>.integerToByteHex = <span class="function"><span class="keyword">function</span> (<span class="params">i</span>) </span>&#123; <span class="keyword">var</span> h = i.toString(<span class="number">16</span>); <span class="keyword">if</span> ((h.length % <span class="number">2</span>) == <span class="number">1</span>) h = <span class="string">'0'</span> + h; <span class="keyword">return</span> h &#125;; <span class="keyword">this</span>.bigIntToMinTwosComplementsHex = <span class="function"><span class="keyword">function</span> (<span class="params">bigIntegerValue</span>) </span>&#123; <span class="keyword">var</span> h = bigIntegerValue.toString(<span class="number">16</span>); <span class="keyword">if</span> (h.substr(<span class="number">0</span>, <span class="number">1</span>) != <span class="string">'-'</span>) &#123; <span class="keyword">if</span> (h.length % <span class="number">2</span> == <span class="number">1</span>) &#123; h = <span class="string">'0'</span> + h &#125; <span class="keyword">else</span> &#123; <span class="keyword">if</span> (!h.match(<span class="regexp">/^[0-7]/</span>)) &#123; h = <span class="string">'00'</span> + h &#125; &#125; &#125; <span class="keyword">else</span> &#123; <span class="keyword">var</span> hPos = h.substr(<span class="number">1</span>); <span class="keyword">var</span> xorLen = hPos.length; <span class="keyword">if</span> (xorLen % <span class="number">2</span> == <span class="number">1</span>) &#123; xorLen += <span class="number">1</span> &#125; <span class="keyword">else</span> &#123; <span class="keyword">if</span> (!h.match(<span class="regexp">/^[0-7]/</span>)) &#123; xorLen += <span class="number">2</span> &#125; &#125; <span class="keyword">var</span> hMask = <span class="string">''</span>; <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; xorLen; i++) &#123; hMask += <span class="string">'f'</span> &#125; <span class="keyword">var</span> biMask = <span class="keyword">new</span> BigInteger(hMask, <span class="number">16</span>); <span class="keyword">var</span> biNeg = biMask.xor(bigIntegerValue).add(BigInteger.ONE); h = biNeg.toString(<span class="number">16</span>).replace(<span class="regexp">/^-/</span>, <span class="string">''</span>) &#125; <span class="keyword">return</span> h &#125;; <span class="keyword">this</span>.getPEMStringFromHex = <span class="function"><span class="keyword">function</span> (<span class="params">dataHex, pemHeader</span>) </span>&#123; <span class="keyword">return</span> hextopem(dataHex, pemHeader) &#125;; <span class="keyword">this</span>.newObject = <span class="function"><span class="keyword">function</span> (<span class="params">param</span>) </span>&#123; <span class="keyword">var</span> _KJUR = KJUR, _KJUR_asn1 = _KJUR.asn1, _DERBoolean = _KJUR_asn1.DERBoolean, _DERInteger = _KJUR_asn1.DERInteger, _DERBitString = _KJUR_asn1.DERBitString, _DEROctetString = _KJUR_asn1.DEROctetString, _DERNull = _KJUR_asn1.DERNull, _DERObjectIdentifier = _KJUR_asn1.DERObjectIdentifier, _DEREnumerated = _KJUR_asn1.DEREnumerated, _DERUTF8String = _KJUR_asn1.DERUTF8String, _DERNumericString = _KJUR_asn1.DERNumericString, _DERPrintableString = _KJUR_asn1.DERPrintableString, _DERTeletexString = _KJUR_asn1.DERTeletexString, _DERIA5String = _KJUR_asn1.DERIA5String, _DERUTCTime = _KJUR_asn1.DERUTCTime, _DERGeneralizedTime = _KJUR_asn1.DERGeneralizedTime, _DERSequence = _KJUR_asn1.DERSequence, _DERSet = _KJUR_asn1.DERSet, _DERTaggedObject = _KJUR_asn1.DERTaggedObject, _newObject = _KJUR_asn1.ASN1Util.newObject; <span class="keyword">var</span> keys = <span class="built_in">Object</span>.keys(param); <span class="keyword">if</span> (keys.length != <span class="number">1</span>) <span class="keyword">throw</span> <span class="string">"key of param shall be only one."</span>; <span class="keyword">var</span> key = keys[<span class="number">0</span>]; <span class="keyword">if</span> (<span class="string">":bool:int:bitstr:octstr:null:oid:enum:utf8str:numstr:prnstr:telstr:ia5str:utctime:gentime:seq:set:tag:"</span>.indexOf(<span class="string">":"</span> + key + <span class="string">":"</span>) == <span class="number">-1</span>) <span class="keyword">throw</span> <span class="string">"undefined key: "</span> + key; <span class="keyword">if</span> (key == <span class="string">"bool"</span>) <span class="keyword">return</span> <span class="keyword">new</span> _DERBoolean(param[key]); <span class="keyword">if</span> (key == <span class="string">"int"</span>) <span class="keyword">return</span> <span class="keyword">new</span> _DERInteger(param[key]); <span class="keyword">if</span> (key == <span class="string">"bitstr"</span>) <span class="keyword">return</span> <span class="keyword">new</span> _DERBitString(param[key]); <span class="keyword">if</span> (key == <span class="string">"octstr"</span>) <span class="keyword">return</span> <span class="keyword">new</span> _DEROctetString(param[key]); <span class="keyword">if</span> (key == <span class="string">"null"</span>) <span class="keyword">return</span> <span class="keyword">new</span> _DERNull(param[key]); <span class="keyword">if</span> (key == <span class="string">"oid"</span>) <span class="keyword">return</span> <span class="keyword">new</span> _DERObjectIdentifier(param[key]); <span class="keyword">if</span> (key == <span class="string">"enum"</span>) <span class="keyword">return</span> <span class="keyword">new</span> _DEREnumerated(param[key]); <span class="keyword">if</span> (key == <span class="string">"utf8str"</span>) <span class="keyword">return</span> <span class="keyword">new</span> _DERUTF8String(param[key]); <span class="keyword">if</span> (key == <span class="string">"numstr"</span>) <span class="keyword">return</span> <span class="keyword">new</span> _DERNumericString(param[key]); <span class="keyword">if</span> (key == <span class="string">"prnstr"</span>) <span class="keyword">return</span> <span class="keyword">new</span> _DERPrintableString(param[key]); <span class="keyword">if</span> (key == <span class="string">"telstr"</span>) <span class="keyword">return</span> <span class="keyword">new</span> _DERTeletexString(param[key]); <span class="keyword">if</span> (key == <span class="string">"ia5str"</span>) <span class="keyword">return</span> <span class="keyword">new</span> _DERIA5String(param[key]); <span class="keyword">if</span> (key == <span class="string">"utctime"</span>) <span class="keyword">return</span> <span class="keyword">new</span> _DERUTCTime(param[key]); <span class="keyword">if</span> (key == <span class="string">"gentime"</span>) <span class="keyword">return</span> <span class="keyword">new</span> _DERGeneralizedTime(param[key]); <span class="keyword">if</span> (key == <span class="string">"seq"</span>) &#123; <span class="keyword">var</span> paramList = param[key]; <span class="keyword">var</span> a = []; <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; paramList.length; i++) &#123; <span class="keyword">var</span> asn1Obj = _newObject(paramList[i]); a.push(asn1Obj) &#125; <span class="keyword">return</span> <span class="keyword">new</span> _DERSequence(&#123; <span class="string">'array'</span>: a &#125;) &#125; <span class="keyword">if</span> (key == <span class="string">"set"</span>) &#123; <span class="keyword">var</span> paramList = param[key]; <span class="keyword">var</span> a = []; <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; paramList.length; i++) &#123; <span class="keyword">var</span> asn1Obj = _newObject(paramList[i]); a.push(asn1Obj) &#125; <span class="keyword">return</span> <span class="keyword">new</span> _DERSet(&#123; <span class="string">'array'</span>: a &#125;) &#125; <span class="keyword">if</span> (key == <span class="string">"tag"</span>) &#123; <span class="keyword">var</span> tagParam = param[key]; <span class="keyword">if</span> (<span class="built_in">Object</span>.prototype.toString.call(tagParam) === <span class="string">'[object Array]'</span> &amp;&amp; tagParam.length == <span class="number">3</span>) &#123; <span class="keyword">var</span> obj = _newObject(tagParam[<span class="number">2</span>]); <span class="keyword">return</span> <span class="keyword">new</span> _DERTaggedObject(&#123; <span class="attr">tag</span>: tagParam[<span class="number">0</span>], <span class="attr">explicit</span>: tagParam[<span class="number">1</span>], <span class="attr">obj</span>: obj &#125;) &#125; <span class="keyword">else</span> &#123; <span class="keyword">var</span> newParam = &#123;&#125;; <span class="keyword">if</span> (tagParam.explicit !== <span class="literal">undefined</span>) newParam.explicit = tagParam.explicit; <span class="keyword">if</span> (tagParam.tag !== <span class="literal">undefined</span>) newParam.tag = tagParam.tag; <span class="keyword">if</span> (tagParam.obj === <span class="literal">undefined</span>) <span class="keyword">throw</span> <span class="string">"obj shall be specified for 'tag'."</span>; newParam.obj = _newObject(tagParam.obj); <span class="keyword">return</span> <span class="keyword">new</span> _DERTaggedObject(newParam) &#125; &#125; &#125;; <span class="keyword">this</span>.jsonToASN1HEX = <span class="function"><span class="keyword">function</span> (<span class="params">param</span>) </span>&#123; <span class="keyword">var</span> asn1Obj = <span class="keyword">this</span>.newObject(param); <span class="keyword">return</span> asn1Obj.getEncodedHex() &#125; &#125;; KJUR.asn1.ASN1Util.oidHexToInt = <span class="function"><span class="keyword">function</span> (<span class="params">hex</span>) </span>&#123; <span class="keyword">var</span> s = <span class="string">""</span>; <span class="keyword">var</span> i01 = <span class="built_in">parseInt</span>(hex.substr(<span class="number">0</span>, <span class="number">2</span>), <span class="number">16</span>); <span class="keyword">var</span> i0 = <span class="built_in">Math</span>.floor(i01 / <span class="number">40</span>); <span class="keyword">var</span> i1 = i01 % <span class="number">40</span>; <span class="keyword">var</span> s = i0 + <span class="string">"."</span> + i1; <span class="keyword">var</span> binbuf = <span class="string">""</span>; <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">2</span>; i &lt; hex.length; i += <span class="number">2</span>) &#123; <span class="keyword">var</span> value = <span class="built_in">parseInt</span>(hex.substr(i, <span class="number">2</span>), <span class="number">16</span>); <span class="keyword">var</span> bin = (<span class="string">"00000000"</span> + value.toString(<span class="number">2</span>)).slice(<span class="number">-8</span>); binbuf = binbuf + bin.substr(<span class="number">1</span>, <span class="number">7</span>); <span class="keyword">if</span> (bin.substr(<span class="number">0</span>, <span class="number">1</span>) == <span class="string">"0"</span>) &#123; <span class="keyword">var</span> bi = <span class="keyword">new</span> BigInteger(binbuf, <span class="number">2</span>); s = s + <span class="string">"."</span> + bi.toString(<span class="number">10</span>); binbuf = <span class="string">""</span> &#125; &#125; <span class="keyword">return</span> s &#125;; KJUR.asn1.ASN1Util.oidIntToHex = <span class="function"><span class="keyword">function</span> (<span class="params">oidString</span>) </span>&#123; <span class="keyword">var</span> itox = <span class="function"><span class="keyword">function</span> (<span class="params">i</span>) </span>&#123; <span class="keyword">var</span> h = i.toString(<span class="number">16</span>); <span class="keyword">if</span> (h.length == <span class="number">1</span>) h = <span class="string">'0'</span> + h; <span class="keyword">return</span> h &#125;; <span class="keyword">var</span> roidtox = <span class="function"><span class="keyword">function</span> (<span class="params">roid</span>) </span>&#123; <span class="keyword">var</span> h = <span class="string">''</span>; <span class="keyword">var</span> bi = <span class="keyword">new</span> BigInteger(roid, <span class="number">10</span>); <span class="keyword">var</span> b = bi.toString(<span class="number">2</span>); <span class="keyword">var</span> padLen = <span class="number">7</span> - b.length % <span class="number">7</span>; <span class="keyword">if</span> (padLen == <span class="number">7</span>) padLen = <span class="number">0</span>; <span class="keyword">var</span> bPad = <span class="string">''</span>; <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; padLen; i++)bPad += <span class="string">'0'</span>; b = bPad + b; <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; b.length - <span class="number">1</span>; i += <span class="number">7</span>) &#123; <span class="keyword">var</span> b8 = b.substr(i, <span class="number">7</span>); <span class="keyword">if</span> (i != b.length - <span class="number">7</span>) b8 = <span class="string">'1'</span> + b8; h += itox(<span class="built_in">parseInt</span>(b8, <span class="number">2</span>)) &#125; <span class="keyword">return</span> h &#125;; <span class="keyword">if</span> (!oidString.match(<span class="regexp">/^[0-9.]+$/</span>)) &#123; <span class="keyword">throw</span> <span class="string">"malformed oid string: "</span> + oidString; &#125; <span class="keyword">var</span> h = <span class="string">''</span>; <span class="keyword">var</span> a = oidString.split(<span class="string">'.'</span>); <span class="keyword">var</span> i0 = <span class="built_in">parseInt</span>(a[<span class="number">0</span>]) * <span class="number">40</span> + <span class="built_in">parseInt</span>(a[<span class="number">1</span>]); h += itox(i0); a.splice(<span class="number">0</span>, <span class="number">2</span>); <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; a.length; i++) &#123; h += roidtox(a[i]) &#125; <span class="keyword">return</span> h &#125;; KJUR.asn1.ASN1Object = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">var</span> hV = <span class="string">''</span>; <span class="keyword">this</span>.getLengthHexFromValue = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="keyword">this</span>.hV == <span class="string">"undefined"</span> || <span class="keyword">this</span>.hV == <span class="literal">null</span>) &#123; <span class="keyword">throw</span> <span class="string">"this.hV is null or undefined."</span>; &#125; <span class="keyword">if</span> (<span class="keyword">this</span>.hV.length % <span class="number">2</span> == <span class="number">1</span>) &#123; <span class="keyword">throw</span> <span class="string">"value hex must be even length: n="</span> + hV.length + <span class="string">",v="</span> + <span class="keyword">this</span>.hV; &#125; <span class="keyword">var</span> n = <span class="keyword">this</span>.hV.length / <span class="number">2</span>; <span class="keyword">var</span> hN = n.toString(<span class="number">16</span>); <span class="keyword">if</span> (hN.length % <span class="number">2</span> == <span class="number">1</span>) &#123; hN = <span class="string">"0"</span> + hN &#125; <span class="keyword">if</span> (n &lt; <span class="number">128</span>) &#123; <span class="keyword">return</span> hN &#125; <span class="keyword">else</span> &#123; <span class="keyword">var</span> hNlen = hN.length / <span class="number">2</span>; <span class="keyword">if</span> (hNlen &gt; <span class="number">15</span>) &#123; <span class="keyword">throw</span> <span class="string">"ASN.1 length too long to represent by 8x: n = "</span> + n.toString(<span class="number">16</span>); &#125; <span class="keyword">var</span> head = <span class="number">128</span> + hNlen; <span class="keyword">return</span> head.toString(<span class="number">16</span>) + hN &#125; &#125;; <span class="keyword">this</span>.getEncodedHex = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">if</span> (<span class="keyword">this</span>.hTLV == <span class="literal">null</span> || <span class="keyword">this</span>.isModified) &#123; <span class="keyword">this</span>.hV = <span class="keyword">this</span>.getFreshValueHex(); <span class="keyword">this</span>.hL = <span class="keyword">this</span>.getLengthHexFromValue(); <span class="keyword">this</span>.hTLV = <span class="keyword">this</span>.hT + <span class="keyword">this</span>.hL + <span class="keyword">this</span>.hV; <span class="keyword">this</span>.isModified = <span class="literal">false</span> &#125; <span class="keyword">return</span> <span class="keyword">this</span>.hTLV &#125;; <span class="keyword">this</span>.getValueHex = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">this</span>.getEncodedHex(); <span class="keyword">return</span> <span class="keyword">this</span>.hV &#125;; <span class="keyword">this</span>.getFreshValueHex = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="string">''</span> &#125; &#125;; KJUR.asn1.DERAbstractString = <span class="function"><span class="keyword">function</span> (<span class="params">params</span>) </span>&#123; KJUR.asn1.DERAbstractString.superclass.constructor.call(<span class="keyword">this</span>); <span class="keyword">this</span>.getString = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.s &#125;; <span class="keyword">this</span>.setString = <span class="function"><span class="keyword">function</span> (<span class="params">newS</span>) </span>&#123; <span class="keyword">this</span>.hTLV = <span class="literal">null</span>; <span class="keyword">this</span>.isModified = <span class="literal">true</span>; <span class="keyword">this</span>.s = newS; <span class="keyword">this</span>.hV = stohex(<span class="keyword">this</span>.s) &#125;; <span class="keyword">this</span>.setStringHex = <span class="function"><span class="keyword">function</span> (<span class="params">newHexString</span>) </span>&#123; <span class="keyword">this</span>.hTLV = <span class="literal">null</span>; <span class="keyword">this</span>.isModified = <span class="literal">true</span>; <span class="keyword">this</span>.s = <span class="literal">null</span>; <span class="keyword">this</span>.hV = newHexString &#125;; <span class="keyword">this</span>.getFreshValueHex = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.hV &#125;; <span class="keyword">if</span> (<span class="keyword">typeof</span> params != <span class="string">"undefined"</span>) &#123; <span class="keyword">if</span> (<span class="keyword">typeof</span> params == <span class="string">"string"</span>) &#123; <span class="keyword">this</span>.setString(params) &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> params[<span class="string">'str'</span>] != <span class="string">"undefined"</span>) &#123; <span class="keyword">this</span>.setString(params[<span class="string">'str'</span>]) &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> params[<span class="string">'hex'</span>] != <span class="string">"undefined"</span>) &#123; <span class="keyword">this</span>.setStringHex(params[<span class="string">'hex'</span>]) &#125; &#125; &#125;; YAHOO.lang.extend(KJUR.asn1.DERAbstractString, KJUR.asn1.ASN1Object); KJUR.asn1.DERAbstractTime = <span class="function"><span class="keyword">function</span> (<span class="params">params</span>) </span>&#123; KJUR.asn1.DERAbstractTime.superclass.constructor.call(<span class="keyword">this</span>); <span class="keyword">this</span>.localDateToUTC = <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; utc = d.getTime() + (d.getTimezoneOffset() * <span class="number">60000</span>); <span class="keyword">var</span> utcDate = <span class="keyword">new</span> <span class="built_in">Date</span>(utc); <span class="keyword">return</span> utcDate &#125;; <span class="keyword">this</span>.formatDate = <span class="function"><span class="keyword">function</span> (<span class="params">dateObject, type, withMillis</span>) </span>&#123; <span class="keyword">var</span> pad = <span class="keyword">this</span>.zeroPadding; <span class="keyword">var</span> d = <span class="keyword">this</span>.localDateToUTC(dateObject); <span class="keyword">var</span> year = <span class="built_in">String</span>(d.getFullYear()); <span class="keyword">if</span> (type == <span class="string">'utc'</span>) year = year.substr(<span class="number">2</span>, <span class="number">2</span>); <span class="keyword">var</span> month = pad(<span class="built_in">String</span>(d.getMonth() + <span class="number">1</span>), <span class="number">2</span>); <span class="keyword">var</span> day = pad(<span class="built_in">String</span>(d.getDate()), <span class="number">2</span>); <span class="keyword">var</span> hour = pad(<span class="built_in">String</span>(d.getHours()), <span class="number">2</span>); <span class="keyword">var</span> min = pad(<span class="built_in">String</span>(d.getMinutes()), <span class="number">2</span>); <span class="keyword">var</span> sec = pad(<span class="built_in">String</span>(d.getSeconds()), <span class="number">2</span>); <span class="keyword">var</span> s = year + month + day + hour + min + sec; <span class="keyword">if</span> (withMillis === <span class="literal">true</span>) &#123; <span class="keyword">var</span> millis = d.getMilliseconds(); <span class="keyword">if</span> (millis != <span class="number">0</span>) &#123; <span class="keyword">var</span> sMillis = pad(<span class="built_in">String</span>(millis), <span class="number">3</span>); sMillis = sMillis.replace(<span class="regexp">/[0]+$/</span>, <span class="string">""</span>); s = s + <span class="string">"."</span> + sMillis &#125; &#125; <span class="keyword">return</span> s + <span class="string">"Z"</span> &#125;; <span class="keyword">this</span>.zeroPadding = <span class="function"><span class="keyword">function</span> (<span class="params">s, len</span>) </span>&#123; <span class="keyword">if</span> (s.length &gt;= len) <span class="keyword">return</span> s; <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Array</span>(len - s.length + <span class="number">1</span>).join(<span class="string">'0'</span>) + s &#125;; <span class="keyword">this</span>.getString = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.s &#125;; <span class="keyword">this</span>.setString = <span class="function"><span class="keyword">function</span> (<span class="params">newS</span>) </span>&#123; <span class="keyword">this</span>.hTLV = <span class="literal">null</span>; <span class="keyword">this</span>.isModified = <span class="literal">true</span>; <span class="keyword">this</span>.s = newS; <span class="keyword">this</span>.hV = stohex(newS) &#125;; <span class="keyword">this</span>.setByDateValue = <span class="function"><span class="keyword">function</span> (<span class="params">year, month, day, hour, min, sec</span>) </span>&#123; <span class="keyword">var</span> dateObject = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="built_in">Date</span>.UTC(year, month - <span class="number">1</span>, day, hour, min, sec, <span class="number">0</span>)); <span class="keyword">this</span>.setByDate(dateObject) &#125;; <span class="keyword">this</span>.getFreshValueHex = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.hV &#125; &#125;; YAHOO.lang.extend(KJUR.asn1.DERAbstractTime, KJUR.asn1.ASN1Object); KJUR.asn1.DERAbstractStructured = <span class="function"><span class="keyword">function</span> (<span class="params">params</span>) </span>&#123; KJUR.asn1.DERAbstractString.superclass.constructor.call(<span class="keyword">this</span>); <span class="keyword">this</span>.setByASN1ObjectArray = <span class="function"><span class="keyword">function</span> (<span class="params">asn1ObjectArray</span>) </span>&#123; <span class="keyword">this</span>.hTLV = <span class="literal">null</span>; <span class="keyword">this</span>.isModified = <span class="literal">true</span>; <span class="keyword">this</span>.asn1Array = asn1ObjectArray &#125;; <span class="keyword">this</span>.appendASN1Object = <span class="function"><span class="keyword">function</span> (<span class="params">asn1Object</span>) </span>&#123; <span class="keyword">this</span>.hTLV = <span class="literal">null</span>; <span class="keyword">this</span>.isModified = <span class="literal">true</span>; <span class="keyword">this</span>.asn1Array.push(asn1Object) &#125;; <span class="keyword">this</span>.asn1Array = <span class="keyword">new</span> <span class="built_in">Array</span>(); <span class="keyword">if</span> (<span class="keyword">typeof</span> params != <span class="string">"undefined"</span>) &#123; <span class="keyword">if</span> (<span class="keyword">typeof</span> params[<span class="string">'array'</span>] != <span class="string">"undefined"</span>) &#123; <span class="keyword">this</span>.asn1Array = params[<span class="string">'array'</span>] &#125; &#125; &#125;; YAHOO.lang.extend(KJUR.asn1.DERAbstractStructured, KJUR.asn1.ASN1Object); KJUR.asn1.DERBoolean = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; KJUR.asn1.DERBoolean.superclass.constructor.call(<span class="keyword">this</span>); <span class="keyword">this</span>.hT = <span class="string">"01"</span>; <span class="keyword">this</span>.hTLV = <span class="string">"0101ff"</span> &#125;; YAHOO.lang.extend(KJUR.asn1.DERBoolean, KJUR.asn1.ASN1Object); KJUR.asn1.DERInteger = <span class="function"><span class="keyword">function</span> (<span class="params">params</span>) </span>&#123; KJUR.asn1.DERInteger.superclass.constructor.call(<span class="keyword">this</span>); <span class="keyword">this</span>.hT = <span class="string">"02"</span>; <span class="keyword">this</span>.setByBigInteger = <span class="function"><span class="keyword">function</span> (<span class="params">bigIntegerValue</span>) </span>&#123; <span class="keyword">this</span>.hTLV = <span class="literal">null</span>; <span class="keyword">this</span>.isModified = <span class="literal">true</span>; <span class="keyword">this</span>.hV = KJUR.asn1.ASN1Util.bigIntToMinTwosComplementsHex(bigIntegerValue) &#125;; <span class="keyword">this</span>.setByInteger = <span class="function"><span class="keyword">function</span> (<span class="params">intValue</span>) </span>&#123; <span class="keyword">var</span> bi = <span class="keyword">new</span> BigInteger(<span class="built_in">String</span>(intValue), <span class="number">10</span>); <span class="keyword">this</span>.setByBigInteger(bi) &#125;; <span class="keyword">this</span>.setValueHex = <span class="function"><span class="keyword">function</span> (<span class="params">newHexString</span>) </span>&#123; <span class="keyword">this</span>.hV = newHexString &#125;; <span class="keyword">this</span>.getFreshValueHex = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.hV &#125;; <span class="keyword">if</span> (<span class="keyword">typeof</span> params != <span class="string">"undefined"</span>) &#123; <span class="keyword">if</span> (<span class="keyword">typeof</span> params[<span class="string">'bigint'</span>] != <span class="string">"undefined"</span>) &#123; <span class="keyword">this</span>.setByBigInteger(params[<span class="string">'bigint'</span>]) &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> params[<span class="string">'int'</span>] != <span class="string">"undefined"</span>) &#123; <span class="keyword">this</span>.setByInteger(params[<span class="string">'int'</span>]) &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> params == <span class="string">"number"</span>) &#123; <span class="keyword">this</span>.setByInteger(params) &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> params[<span class="string">'hex'</span>] != <span class="string">"undefined"</span>) &#123; <span class="keyword">this</span>.setValueHex(params[<span class="string">'hex'</span>]) &#125; &#125; &#125;; YAHOO.lang.extend(KJUR.asn1.DERInteger, KJUR.asn1.ASN1Object); KJUR.asn1.DERBitString = <span class="function"><span class="keyword">function</span> (<span class="params">params</span>) </span>&#123; <span class="keyword">if</span> (params !== <span class="literal">undefined</span> &amp;&amp; <span class="keyword">typeof</span> params.obj !== <span class="string">"undefined"</span>) &#123; <span class="keyword">var</span> o = KJUR.asn1.ASN1Util.newObject(params.obj); params.hex = <span class="string">"00"</span> + o.getEncodedHex() &#125; KJUR.asn1.DERBitString.superclass.constructor.call(<span class="keyword">this</span>); <span class="keyword">this</span>.hT = <span class="string">"03"</span>; <span class="keyword">this</span>.setHexValueIncludingUnusedBits = <span class="function"><span class="keyword">function</span> (<span class="params">newHexStringIncludingUnusedBits</span>) </span>&#123; <span class="keyword">this</span>.hTLV = <span class="literal">null</span>; <span class="keyword">this</span>.isModified = <span class="literal">true</span>; <span class="keyword">this</span>.hV = newHexStringIncludingUnusedBits &#125;; <span class="keyword">this</span>.setUnusedBitsAndHexValue = <span class="function"><span class="keyword">function</span> (<span class="params">unusedBits, hValue</span>) </span>&#123; <span class="keyword">if</span> (unusedBits &lt; <span class="number">0</span> || <span class="number">7</span> &lt; unusedBits) &#123; <span class="keyword">throw</span> <span class="string">"unused bits shall be from 0 to 7: u = "</span> + unusedBits; &#125; <span class="keyword">var</span> hUnusedBits = <span class="string">"0"</span> + unusedBits; <span class="keyword">this</span>.hTLV = <span class="literal">null</span>; <span class="keyword">this</span>.isModified = <span class="literal">true</span>; <span class="keyword">this</span>.hV = hUnusedBits + hValue &#125;; <span class="keyword">this</span>.setByBinaryString = <span class="function"><span class="keyword">function</span> (<span class="params">binaryString</span>) </span>&#123; binaryString = binaryString.replace(<span class="regexp">/0+$/</span>, <span class="string">''</span>); <span class="keyword">var</span> unusedBits = <span class="number">8</span> - binaryString.length % <span class="number">8</span>; <span class="keyword">if</span> (unusedBits == <span class="number">8</span>) unusedBits = <span class="number">0</span>; <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt;= unusedBits; i++) &#123; binaryString += <span class="string">'0'</span> &#125; <span class="keyword">var</span> h = <span class="string">''</span>; <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; binaryString.length - <span class="number">1</span>; i += <span class="number">8</span>) &#123; <span class="keyword">var</span> b = binaryString.substr(i, <span class="number">8</span>); <span class="keyword">var</span> x = <span class="built_in">parseInt</span>(b, <span class="number">2</span>).toString(<span class="number">16</span>); <span class="keyword">if</span> (x.length == <span class="number">1</span>) x = <span class="string">'0'</span> + x; h += x &#125; <span class="keyword">this</span>.hTLV = <span class="literal">null</span>; <span class="keyword">this</span>.isModified = <span class="literal">true</span>; <span class="keyword">this</span>.hV = <span class="string">'0'</span> + unusedBits + h &#125;; <span class="keyword">this</span>.setByBooleanArray = <span class="function"><span class="keyword">function</span> (<span class="params">booleanArray</span>) </span>&#123; <span class="keyword">var</span> s = <span class="string">''</span>; <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; booleanArray.length; i++) &#123; <span class="keyword">if</span> (booleanArray[i] == <span class="literal">true</span>) &#123; s += <span class="string">'1'</span> &#125; <span class="keyword">else</span> &#123; s += <span class="string">'0'</span> &#125; &#125; <span class="keyword">this</span>.setByBinaryString(s) &#125;; <span class="keyword">this</span>.newFalseArray = <span class="function"><span class="keyword">function</span> (<span class="params">nLength</span>) </span>&#123; <span class="keyword">var</span> a = <span class="keyword">new</span> <span class="built_in">Array</span>(nLength); <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; nLength; i++) &#123; a[i] = <span class="literal">false</span> &#125; <span class="keyword">return</span> a &#125;; <span class="keyword">this</span>.getFreshValueHex = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.hV &#125;; <span class="keyword">if</span> (<span class="keyword">typeof</span> params != <span class="string">"undefined"</span>) &#123; <span class="keyword">if</span> (<span class="keyword">typeof</span> params == <span class="string">"string"</span> &amp;&amp; params.toLowerCase().match(<span class="regexp">/^[0-9a-f]+$/</span>)) &#123; <span class="keyword">this</span>.setHexValueIncludingUnusedBits(params) &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> params[<span class="string">'hex'</span>] != <span class="string">"undefined"</span>) &#123; <span class="keyword">this</span>.setHexValueIncludingUnusedBits(params[<span class="string">'hex'</span>]) &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> params[<span class="string">'bin'</span>] != <span class="string">"undefined"</span>) &#123; <span class="keyword">this</span>.setByBinaryString(params[<span class="string">'bin'</span>]) &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> params[<span class="string">'array'</span>] != <span class="string">"undefined"</span>) &#123; <span class="keyword">this</span>.setByBooleanArray(params[<span class="string">'array'</span>]) &#125; &#125; &#125;; YAHOO.lang.extend(KJUR.asn1.DERBitString, KJUR.asn1.ASN1Object); KJUR.asn1.DEROctetString = <span class="function"><span class="keyword">function</span> (<span class="params">params</span>) </span>&#123; <span class="keyword">if</span> (params !== <span class="literal">undefined</span> &amp;&amp; <span class="keyword">typeof</span> params.obj !== <span class="string">"undefined"</span>) &#123; <span class="keyword">var</span> o = KJUR.asn1.ASN1Util.newObject(params.obj); params.hex = o.getEncodedHex() &#125; KJUR.asn1.DEROctetString.superclass.constructor.call(<span class="keyword">this</span>, params); <span class="keyword">this</span>.hT = <span class="string">"04"</span> &#125;; YAHOO.lang.extend(KJUR.asn1.DEROctetString, KJUR.asn1.DERAbstractString); KJUR.asn1.DERNull = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; KJUR.asn1.DERNull.superclass.constructor.call(<span class="keyword">this</span>); <span class="keyword">this</span>.hT = <span class="string">"05"</span>; <span class="keyword">this</span>.hTLV = <span class="string">"0500"</span> &#125;; YAHOO.lang.extend(KJUR.asn1.DERNull, KJUR.asn1.ASN1Object); KJUR.asn1.DERObjectIdentifier = <span class="function"><span class="keyword">function</span> (<span class="params">params</span>) </span>&#123; <span class="keyword">var</span> itox = <span class="function"><span class="keyword">function</span> (<span class="params">i</span>) </span>&#123; <span class="keyword">var</span> h = i.toString(<span class="number">16</span>); <span class="keyword">if</span> (h.length == <span class="number">1</span>) h = <span class="string">'0'</span> + h; <span class="keyword">return</span> h &#125;; <span class="keyword">var</span> roidtox = <span class="function"><span class="keyword">function</span> (<span class="params">roid</span>) </span>&#123; <span class="keyword">var</span> h = <span class="string">''</span>; <span class="keyword">var</span> bi = <span class="keyword">new</span> BigInteger(roid, <span class="number">10</span>); <span class="keyword">var</span> b = bi.toString(<span class="number">2</span>); <span class="keyword">var</span> padLen = <span class="number">7</span> - b.length % <span class="number">7</span>; <span class="keyword">if</span> (padLen == <span class="number">7</span>) padLen = <span class="number">0</span>; <span class="keyword">var</span> bPad = <span class="string">''</span>; <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; padLen; i++)bPad += <span class="string">'0'</span>; b = bPad + b; <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; b.length - <span class="number">1</span>; i += <span class="number">7</span>) &#123; <span class="keyword">var</span> b8 = b.substr(i, <span class="number">7</span>); <span class="keyword">if</span> (i != b.length - <span class="number">7</span>) b8 = <span class="string">'1'</span> + b8; h += itox(<span class="built_in">parseInt</span>(b8, <span class="number">2</span>)) &#125; <span class="keyword">return</span> h &#125;; KJUR.asn1.DERObjectIdentifier.superclass.constructor.call(<span class="keyword">this</span>); <span class="keyword">this</span>.hT = <span class="string">"06"</span>; <span class="keyword">this</span>.setValueHex = <span class="function"><span class="keyword">function</span> (<span class="params">newHexString</span>) </span>&#123; <span class="keyword">this</span>.hTLV = <span class="literal">null</span>; <span class="keyword">this</span>.isModified = <span class="literal">true</span>; <span class="keyword">this</span>.s = <span class="literal">null</span>; <span class="keyword">this</span>.hV = newHexString &#125;; <span class="keyword">this</span>.setValueOidString = <span class="function"><span class="keyword">function</span> (<span class="params">oidString</span>) </span>&#123; <span class="keyword">if</span> (!oidString.match(<span class="regexp">/^[0-9.]+$/</span>)) &#123; <span class="keyword">throw</span> <span class="string">"malformed oid string: "</span> + oidString; &#125; <span class="keyword">var</span> h = <span class="string">''</span>; <span class="keyword">var</span> a = oidString.split(<span class="string">'.'</span>); <span class="keyword">var</span> i0 = <span class="built_in">parseInt</span>(a[<span class="number">0</span>]) * <span class="number">40</span> + <span class="built_in">parseInt</span>(a[<span class="number">1</span>]); h += itox(i0); a.splice(<span class="number">0</span>, <span class="number">2</span>); <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; a.length; i++) &#123; h += roidtox(a[i]) &#125; <span class="keyword">this</span>.hTLV = <span class="literal">null</span>; <span class="keyword">this</span>.isModified = <span class="literal">true</span>; <span class="keyword">this</span>.s = <span class="literal">null</span>; <span class="keyword">this</span>.hV = h &#125;; <span class="keyword">this</span>.setValueName = <span class="function"><span class="keyword">function</span> (<span class="params">oidName</span>) </span>&#123; <span class="keyword">var</span> oid = KJUR.asn1.x509.OID.name2oid(oidName); <span class="keyword">if</span> (oid !== <span class="string">''</span>) &#123; <span class="keyword">this</span>.setValueOidString(oid) &#125; <span class="keyword">else</span> &#123; <span class="keyword">throw</span> <span class="string">"DERObjectIdentifier oidName undefined: "</span> + oidName; &#125; &#125;; <span class="keyword">this</span>.getFreshValueHex = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.hV &#125;; <span class="keyword">if</span> (params !== <span class="literal">undefined</span>) &#123; <span class="keyword">if</span> (<span class="keyword">typeof</span> params === <span class="string">"string"</span>) &#123; <span class="keyword">if</span> (params.match(<span class="regexp">/^[0-2].[0-9.]+$/</span>)) &#123; <span class="keyword">this</span>.setValueOidString(params) &#125; <span class="keyword">else</span> &#123; <span class="keyword">this</span>.setValueName(params) &#125; &#125; <span class="keyword">else</span> <span class="keyword">if</span> (params.oid !== <span class="literal">undefined</span>) &#123; <span class="keyword">this</span>.setValueOidString(params.oid) &#125; <span class="keyword">else</span> <span class="keyword">if</span> (params.hex !== <span class="literal">undefined</span>) &#123; <span class="keyword">this</span>.setValueHex(params.hex) &#125; <span class="keyword">else</span> <span class="keyword">if</span> (params.name !== <span class="literal">undefined</span>) &#123; <span class="keyword">this</span>.setValueName(params.name) &#125; &#125; &#125;; YAHOO.lang.extend(KJUR.asn1.DERObjectIdentifier, KJUR.asn1.ASN1Object); KJUR.asn1.DEREnumerated = <span class="function"><span class="keyword">function</span> (<span class="params">params</span>) </span>&#123; KJUR.asn1.DEREnumerated.superclass.constructor.call(<span class="keyword">this</span>); <span class="keyword">this</span>.hT = <span class="string">"0a"</span>; <span class="keyword">this</span>.setByBigInteger = <span class="function"><span class="keyword">function</span> (<span class="params">bigIntegerValue</span>) </span>&#123; <span class="keyword">this</span>.hTLV = <span class="literal">null</span>; <span class="keyword">this</span>.isModified = <span class="literal">true</span>; <span class="keyword">this</span>.hV = KJUR.asn1.ASN1Util.bigIntToMinTwosComplementsHex(bigIntegerValue) &#125;; <span class="keyword">this</span>.setByInteger = <span class="function"><span class="keyword">function</span> (<span class="params">intValue</span>) </span>&#123; <span class="keyword">var</span> bi = <span class="keyword">new</span> BigInteger(<span class="built_in">String</span>(intValue), <span class="number">10</span>); <span class="keyword">this</span>.setByBigInteger(bi) &#125;; <span class="keyword">this</span>.setValueHex = <span class="function"><span class="keyword">function</span> (<span class="params">newHexString</span>) </span>&#123; <span class="keyword">this</span>.hV = newHexString &#125;; <span class="keyword">this</span>.getFreshValueHex = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.hV &#125;; <span class="keyword">if</span> (<span class="keyword">typeof</span> params != <span class="string">"undefined"</span>) &#123; <span class="keyword">if</span> (<span class="keyword">typeof</span> params[<span class="string">'int'</span>] != <span class="string">"undefined"</span>) &#123; <span class="keyword">this</span>.setByInteger(params[<span class="string">'int'</span>]) &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> params == <span class="string">"number"</span>) &#123; <span class="keyword">this</span>.setByInteger(params) &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> params[<span class="string">'hex'</span>] != <span class="string">"undefined"</span>) &#123; <span class="keyword">this</span>.setValueHex(params[<span class="string">'hex'</span>]) &#125; &#125; &#125;; YAHOO.lang.extend(KJUR.asn1.DEREnumerated, KJUR.asn1.ASN1Object); KJUR.asn1.DERUTF8String = <span class="function"><span class="keyword">function</span> (<span class="params">params</span>) </span>&#123; KJUR.asn1.DERUTF8String.superclass.constructor.call(<span class="keyword">this</span>, params); <span class="keyword">this</span>.hT = <span class="string">"0c"</span> &#125;; YAHOO.lang.extend(KJUR.asn1.DERUTF8String, KJUR.asn1.DERAbstractString); KJUR.asn1.DERNumericString = <span class="function"><span class="keyword">function</span> (<span class="params">params</span>) </span>&#123; KJUR.asn1.DERNumericString.superclass.constructor.call(<span class="keyword">this</span>, params); <span class="keyword">this</span>.hT = <span class="string">"12"</span> &#125;; YAHOO.lang.extend(KJUR.asn1.DERNumericString, KJUR.asn1.DERAbstractString); KJUR.asn1.DERPrintableString = <span class="function"><span class="keyword">function</span> (<span class="params">params</span>) </span>&#123; KJUR.asn1.DERPrintableString.superclass.constructor.call(<span class="keyword">this</span>, params); <span class="keyword">this</span>.hT = <span class="string">"13"</span> &#125;; YAHOO.lang.extend(KJUR.asn1.DERPrintableString, KJUR.asn1.DERAbstractString); KJUR.asn1.DERTeletexString = <span class="function"><span class="keyword">function</span> (<span class="params">params</span>) </span>&#123; KJUR.asn1.DERTeletexString.superclass.constructor.call(<span class="keyword">this</span>, params); <span class="keyword">this</span>.hT = <span class="string">"14"</span> &#125;; YAHOO.lang.extend(KJUR.asn1.DERTeletexString, KJUR.asn1.DERAbstractString); KJUR.asn1.DERIA5String = <span class="function"><span class="keyword">function</span> (<span class="params">params</span>) </span>&#123; KJUR.asn1.DERIA5String.superclass.constructor.call(<span class="keyword">this</span>, params); <span class="keyword">this</span>.hT = <span class="string">"16"</span> &#125;; YAHOO.lang.extend(KJUR.asn1.DERIA5String, KJUR.asn1.DERAbstractString); KJUR.asn1.DERUTCTime = <span class="function"><span class="keyword">function</span> (<span class="params">params</span>) </span>&#123; KJUR.asn1.DERUTCTime.superclass.constructor.call(<span class="keyword">this</span>, params); <span class="keyword">this</span>.hT = <span class="string">"17"</span>; <span class="keyword">this</span>.setByDate = <span class="function"><span class="keyword">function</span> (<span class="params">dateObject</span>) </span>&#123; <span class="keyword">this</span>.hTLV = <span class="literal">null</span>; <span class="keyword">this</span>.isModified = <span class="literal">true</span>; <span class="keyword">this</span>.date = dateObject; <span class="keyword">this</span>.s = <span class="keyword">this</span>.formatDate(<span class="keyword">this</span>.date, <span class="string">'utc'</span>); <span class="keyword">this</span>.hV = stohex(<span class="keyword">this</span>.s) &#125;; <span class="keyword">this</span>.getFreshValueHex = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="keyword">this</span>.date == <span class="string">"undefined"</span> &amp;&amp; <span class="keyword">typeof</span> <span class="keyword">this</span>.s == <span class="string">"undefined"</span>) &#123; <span class="keyword">this</span>.date = <span class="keyword">new</span> <span class="built_in">Date</span>(); <span class="keyword">this</span>.s = <span class="keyword">this</span>.formatDate(<span class="keyword">this</span>.date, <span class="string">'utc'</span>); <span class="keyword">this</span>.hV = stohex(<span class="keyword">this</span>.s) &#125; <span class="keyword">return</span> <span class="keyword">this</span>.hV &#125;; <span class="keyword">if</span> (params !== <span class="literal">undefined</span>) &#123; <span class="keyword">if</span> (params.str !== <span class="literal">undefined</span>) &#123; <span class="keyword">this</span>.setString(params.str) &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> params == <span class="string">"string"</span> &amp;&amp; params.match(<span class="regexp">/^[0-9]&#123;12&#125;Z$/</span>)) &#123; <span class="keyword">this</span>.setString(params) &#125; <span class="keyword">else</span> <span class="keyword">if</span> (params.hex !== <span class="literal">undefined</span>) &#123; <span class="keyword">this</span>.setStringHex(params.hex) &#125; <span class="keyword">else</span> <span class="keyword">if</span> (params.date !== <span class="literal">undefined</span>) &#123; <span class="keyword">this</span>.setByDate(params.date) &#125; &#125; &#125;; YAHOO.lang.extend(KJUR.asn1.DERUTCTime, KJUR.asn1.DERAbstractTime); KJUR.asn1.DERGeneralizedTime = <span class="function"><span class="keyword">function</span> (<span class="params">params</span>) </span>&#123; KJUR.asn1.DERGeneralizedTime.superclass.constructor.call(<span class="keyword">this</span>, params); <span class="keyword">this</span>.hT = <span class="string">"18"</span>; <span class="keyword">this</span>.withMillis = <span class="literal">false</span>; <span class="keyword">this</span>.setByDate = <span class="function"><span class="keyword">function</span> (<span class="params">dateObject</span>) </span>&#123; <span class="keyword">this</span>.hTLV = <span class="literal">null</span>; <span class="keyword">this</span>.isModified = <span class="literal">true</span>; <span class="keyword">this</span>.date = dateObject; <span class="keyword">this</span>.s = <span class="keyword">this</span>.formatDate(<span class="keyword">this</span>.date, <span class="string">'gen'</span>, <span class="keyword">this</span>.withMillis); <span class="keyword">this</span>.hV = stohex(<span class="keyword">this</span>.s) &#125;; <span class="keyword">this</span>.getFreshValueHex = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">if</span> (<span class="keyword">this</span>.date === <span class="literal">undefined</span> &amp;&amp; <span class="keyword">this</span>.s === <span class="literal">undefined</span>) &#123; <span class="keyword">this</span>.date = <span class="keyword">new</span> <span class="built_in">Date</span>(); <span class="keyword">this</span>.s = <span class="keyword">this</span>.formatDate(<span class="keyword">this</span>.date, <span class="string">'gen'</span>, <span class="keyword">this</span>.withMillis); <span class="keyword">this</span>.hV = stohex(<span class="keyword">this</span>.s) &#125; <span class="keyword">return</span> <span class="keyword">this</span>.hV &#125;; <span class="keyword">if</span> (params !== <span class="literal">undefined</span>) &#123; <span class="keyword">if</span> (params.str !== <span class="literal">undefined</span>) &#123; <span class="keyword">this</span>.setString(params.str) &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> params == <span class="string">"string"</span> &amp;&amp; params.match(<span class="regexp">/^[0-9]&#123;14&#125;Z$/</span>)) &#123; <span class="keyword">this</span>.setString(params) &#125; <span class="keyword">else</span> <span class="keyword">if</span> (params.hex !== <span class="literal">undefined</span>) &#123; <span class="keyword">this</span>.setStringHex(params.hex) &#125; <span class="keyword">else</span> <span class="keyword">if</span> (params.date !== <span class="literal">undefined</span>) &#123; <span class="keyword">this</span>.setByDate(params.date) &#125; <span class="keyword">if</span> (params.millis === <span class="literal">true</span>) &#123; <span class="keyword">this</span>.withMillis = <span class="literal">true</span> &#125; &#125; &#125;; YAHOO.lang.extend(KJUR.asn1.DERGeneralizedTime, KJUR.asn1.DERAbstractTime); KJUR.asn1.DERSequence = <span class="function"><span class="keyword">function</span> (<span class="params">params</span>) </span>&#123; KJUR.asn1.DERSequence.superclass.constructor.call(<span class="keyword">this</span>, params); <span class="keyword">this</span>.hT = <span class="string">"30"</span>; <span class="keyword">this</span>.getFreshValueHex = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">var</span> h = <span class="string">''</span>; <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.asn1Array.length; i++) &#123; <span class="keyword">var</span> asn1Obj = <span class="keyword">this</span>.asn1Array[i]; h += asn1Obj.getEncodedHex() &#125; <span class="keyword">this</span>.hV = h; <span class="keyword">return</span> <span class="keyword">this</span>.hV &#125; &#125;; YAHOO.lang.extend(KJUR.asn1.DERSequence, KJUR.asn1.DERAbstractStructured); KJUR.asn1.DERSet = <span class="function"><span class="keyword">function</span> (<span class="params">params</span>) </span>&#123; KJUR.asn1.DERSet.superclass.constructor.call(<span class="keyword">this</span>, params); <span class="keyword">this</span>.hT = <span class="string">"31"</span>; <span class="keyword">this</span>.sortFlag = <span class="literal">true</span>; <span class="keyword">this</span>.getFreshValueHex = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">var</span> a = <span class="keyword">new</span> <span class="built_in">Array</span>(); <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.asn1Array.length; i++) &#123; <span class="keyword">var</span> asn1Obj = <span class="keyword">this</span>.asn1Array[i]; a.push(asn1Obj.getEncodedHex()) &#125; <span class="keyword">if</span> (<span class="keyword">this</span>.sortFlag == <span class="literal">true</span>) a.sort(); <span class="keyword">this</span>.hV = a.join(<span class="string">''</span>); <span class="keyword">return</span> <span class="keyword">this</span>.hV &#125;; <span class="keyword">if</span> (<span class="keyword">typeof</span> params != <span class="string">"undefined"</span>) &#123; <span class="keyword">if</span> (<span class="keyword">typeof</span> params.sortflag != <span class="string">"undefined"</span> &amp;&amp; params.sortflag == <span class="literal">false</span>) <span class="keyword">this</span>.sortFlag = <span class="literal">false</span> &#125; &#125;; YAHOO.lang.extend(KJUR.asn1.DERSet, KJUR.asn1.DERAbstractStructured); KJUR.asn1.DERTaggedObject = <span class="function"><span class="keyword">function</span> (<span class="params">params</span>) </span>&#123; KJUR.asn1.DERTaggedObject.superclass.constructor.call(<span class="keyword">this</span>); <span class="keyword">this</span>.hT = <span class="string">"a0"</span>; <span class="keyword">this</span>.hV = <span class="string">''</span>; <span class="keyword">this</span>.isExplicit = <span class="literal">true</span>; <span class="keyword">this</span>.asn1Object = <span class="literal">null</span>; <span class="keyword">this</span>.setASN1Object = <span class="function"><span class="keyword">function</span> (<span class="params">isExplicitFlag, tagNoHex, asn1Object</span>) </span>&#123; <span class="keyword">this</span>.hT = tagNoHex; <span class="keyword">this</span>.isExplicit = isExplicitFlag; <span class="keyword">this</span>.asn1Object = asn1Object; <span class="keyword">if</span> (<span class="keyword">this</span>.isExplicit) &#123; <span class="keyword">this</span>.hV = <span class="keyword">this</span>.asn1Object.getEncodedHex(); <span class="keyword">this</span>.hTLV = <span class="literal">null</span>; <span class="keyword">this</span>.isModified = <span class="literal">true</span> &#125; <span class="keyword">else</span> &#123; <span class="keyword">this</span>.hV = <span class="literal">null</span>; <span class="keyword">this</span>.hTLV = asn1Object.getEncodedHex(); <span class="keyword">this</span>.hTLV = <span class="keyword">this</span>.hTLV.replace(<span class="regexp">/^../</span>, tagNoHex); <span class="keyword">this</span>.isModified = <span class="literal">false</span> &#125; &#125;; <span class="keyword">this</span>.getFreshValueHex = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.hV &#125;; <span class="keyword">if</span> (<span class="keyword">typeof</span> params != <span class="string">"undefined"</span>) &#123; <span class="keyword">if</span> (<span class="keyword">typeof</span> params[<span class="string">'tag'</span>] != <span class="string">"undefined"</span>) &#123; <span class="keyword">this</span>.hT = params[<span class="string">'tag'</span>] &#125; <span class="keyword">if</span> (<span class="keyword">typeof</span> params[<span class="string">'explicit'</span>] != <span class="string">"undefined"</span>) &#123; <span class="keyword">this</span>.isExplicit = params[<span class="string">'explicit'</span>] &#125; <span class="keyword">if</span> (<span class="keyword">typeof</span> params[<span class="string">'obj'</span>] != <span class="string">"undefined"</span>) &#123; <span class="keyword">this</span>.asn1Object = params[<span class="string">'obj'</span>]; <span class="keyword">this</span>.setASN1Object(<span class="keyword">this</span>.isExplicit, <span class="keyword">this</span>.hT, <span class="keyword">this</span>.asn1Object) &#125; &#125; &#125;; YAHOO.lang.extend(KJUR.asn1.DERTaggedObject, KJUR.asn1.ASN1Object); <span class="keyword">var</span> JSEncryptRSAKey = (<span class="function"><span class="keyword">function</span> (<span class="params">_super</span>) </span>&#123; __extends(JSEncryptRSAKey, _super); <span class="function"><span class="keyword">function</span> <span class="title">JSEncryptRSAKey</span>(<span class="params">key</span>) </span>&#123; <span class="keyword">var</span> _this = _super.call(<span class="keyword">this</span>) || <span class="keyword">this</span>; <span class="keyword">if</span> (key) &#123; <span class="keyword">if</span> (<span class="keyword">typeof</span> key === <span class="string">"string"</span>) &#123; _this.parseKey(key) &#125; <span class="keyword">else</span> <span class="keyword">if</span> (JSEncryptRSAKey.hasPrivateKeyProperty(key) || JSEncryptRSAKey.hasPublicKeyProperty(key)) &#123; _this.parsePropertiesFrom(key) &#125; &#125; <span class="keyword">return</span> _this &#125; JSEncryptRSAKey.prototype.parseKey = <span class="function"><span class="keyword">function</span> (<span class="params">pem</span>) </span>&#123; <span class="keyword">try</span> &#123; <span class="keyword">var</span> modulus = <span class="number">0</span>; <span class="keyword">var</span> public_exponent = <span class="number">0</span>; <span class="keyword">var</span> reHex = <span class="regexp">/^\s*(?:[0-9A-Fa-f][0-9A-Fa-f]\s*)+$/</span>; <span class="keyword">var</span> der = reHex.test(pem) ? Hex.decode(pem) : Base64.unarmor(pem); <span class="keyword">var</span> asn1 = ASN1.decode(der); <span class="keyword">if</span> (asn1.sub.length === <span class="number">3</span>) &#123; asn1 = asn1.sub[<span class="number">2</span>].sub[<span class="number">0</span>] &#125; <span class="keyword">if</span> (asn1.sub.length === <span class="number">9</span>) &#123; modulus = asn1.sub[<span class="number">1</span>].getHexStringValue(); <span class="keyword">this</span>.n = parseBigInt(modulus, <span class="number">16</span>); public_exponent = asn1.sub[<span class="number">2</span>].getHexStringValue(); <span class="keyword">this</span>.e = <span class="built_in">parseInt</span>(public_exponent, <span class="number">16</span>); <span class="keyword">var</span> private_exponent = asn1.sub[<span class="number">3</span>].getHexStringValue(); <span class="keyword">this</span>.d = parseBigInt(private_exponent, <span class="number">16</span>); <span class="keyword">var</span> prime1 = asn1.sub[<span class="number">4</span>].getHexStringValue(); <span class="keyword">this</span>.p = parseBigInt(prime1, <span class="number">16</span>); <span class="keyword">var</span> prime2 = asn1.sub[<span class="number">5</span>].getHexStringValue(); <span class="keyword">this</span>.q = parseBigInt(prime2, <span class="number">16</span>); <span class="keyword">var</span> exponent1 = asn1.sub[<span class="number">6</span>].getHexStringValue(); <span class="keyword">this</span>.dmp1 = parseBigInt(exponent1, <span class="number">16</span>); <span class="keyword">var</span> exponent2 = asn1.sub[<span class="number">7</span>].getHexStringValue(); <span class="keyword">this</span>.dmq1 = parseBigInt(exponent2, <span class="number">16</span>); <span class="keyword">var</span> coefficient = asn1.sub[<span class="number">8</span>].getHexStringValue(); <span class="keyword">this</span>.coeff = parseBigInt(coefficient, <span class="number">16</span>) &#125; <span class="keyword">else</span> <span class="keyword">if</span> (asn1.sub.length === <span class="number">2</span>) &#123; <span class="keyword">var</span> bit_string = asn1.sub[<span class="number">1</span>]; <span class="keyword">var</span> sequence = bit_string.sub[<span class="number">0</span>]; modulus = sequence.sub[<span class="number">0</span>].getHexStringValue(); <span class="keyword">this</span>.n = parseBigInt(modulus, <span class="number">16</span>); public_exponent = sequence.sub[<span class="number">1</span>].getHexStringValue(); <span class="keyword">this</span>.e = <span class="built_in">parseInt</span>(public_exponent, <span class="number">16</span>) &#125; <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">false</span> &#125; <span class="keyword">return</span> <span class="literal">true</span> &#125; <span class="keyword">catch</span> (ex) &#123; <span class="keyword">return</span> <span class="literal">false</span> &#125; &#125;; JSEncryptRSAKey.prototype.getPrivateBaseKey = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">var</span> options = &#123; <span class="attr">array</span>: [<span class="keyword">new</span> KJUR.asn1.DERInteger(&#123; <span class="attr">int</span>: <span class="number">0</span> &#125;), <span class="keyword">new</span> KJUR.asn1.DERInteger(&#123; <span class="attr">bigint</span>: <span class="keyword">this</span>.n &#125;), <span class="keyword">new</span> KJUR.asn1.DERInteger(&#123; <span class="attr">int</span>: <span class="keyword">this</span>.e &#125;), <span class="keyword">new</span> KJUR.asn1.DERInteger(&#123; <span class="attr">bigint</span>: <span class="keyword">this</span>.d &#125;), <span class="keyword">new</span> KJUR.asn1.DERInteger(&#123; <span class="attr">bigint</span>: <span class="keyword">this</span>.p &#125;), <span class="keyword">new</span> KJUR.asn1.DERInteger(&#123; <span class="attr">bigint</span>: <span class="keyword">this</span>.q &#125;), <span class="keyword">new</span> KJUR.asn1.DERInteger(&#123; <span class="attr">bigint</span>: <span class="keyword">this</span>.dmp1 &#125;), <span class="keyword">new</span> KJUR.asn1.DERInteger(&#123; <span class="attr">bigint</span>: <span class="keyword">this</span>.dmq1 &#125;), <span class="keyword">new</span> KJUR.asn1.DERInteger(&#123; <span class="attr">bigint</span>: <span class="keyword">this</span>.coeff &#125;)] &#125;; <span class="keyword">var</span> seq = <span class="keyword">new</span> KJUR.asn1.DERSequence(options); <span class="keyword">return</span> seq.getEncodedHex() &#125;; JSEncryptRSAKey.prototype.getPrivateBaseKeyB64 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> hex2b64(<span class="keyword">this</span>.getPrivateBaseKey()) &#125;; JSEncryptRSAKey.prototype.getPublicBaseKey = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">var</span> first_sequence = <span class="keyword">new</span> KJUR.asn1.DERSequence(&#123; <span class="attr">array</span>: [<span class="keyword">new</span> KJUR.asn1.DERObjectIdentifier(&#123; <span class="attr">oid</span>: <span class="string">"1.2.840.113549.1.1.1"</span> &#125;), <span class="keyword">new</span> KJUR.asn1.DERNull()] &#125;); <span class="keyword">var</span> second_sequence = <span class="keyword">new</span> KJUR.asn1.DERSequence(&#123; <span class="attr">array</span>: [<span class="keyword">new</span> KJUR.asn1.DERInteger(&#123; <span class="attr">bigint</span>: <span class="keyword">this</span>.n &#125;), <span class="keyword">new</span> KJUR.asn1.DERInteger(&#123; <span class="attr">int</span>: <span class="keyword">this</span>.e &#125;)] &#125;); <span class="keyword">var</span> bit_string = <span class="keyword">new</span> KJUR.asn1.DERBitString(&#123; <span class="attr">hex</span>: <span class="string">"00"</span> + second_sequence.getEncodedHex() &#125;); <span class="keyword">var</span> seq = <span class="keyword">new</span> KJUR.asn1.DERSequence(&#123; <span class="attr">array</span>: [first_sequence, bit_string] &#125;); <span class="keyword">return</span> seq.getEncodedHex() &#125;; JSEncryptRSAKey.prototype.getPublicBaseKeyB64 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> hex2b64(<span class="keyword">this</span>.getPublicBaseKey()) &#125;; JSEncryptRSAKey.wordwrap = <span class="function"><span class="keyword">function</span> (<span class="params">str, width</span>) </span>&#123; width = width || <span class="number">64</span>; <span class="keyword">if</span> (!str) &#123; <span class="keyword">return</span> str &#125; <span class="keyword">var</span> regex = <span class="string">"(.&#123;1,"</span> + width + <span class="string">"&#125;)( +|$\n?)|(.&#123;1,"</span> + width + <span class="string">"&#125;)"</span>; <span class="keyword">return</span> str.match(<span class="built_in">RegExp</span>(regex, <span class="string">"g"</span>)).join(<span class="string">"\n"</span>) &#125;; JSEncryptRSAKey.prototype.getPrivateKey = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">var</span> key = <span class="string">"-----BEGIN RSA PRIVATE KEY-----\n"</span>; key += JSEncryptRSAKey.wordwrap(<span class="keyword">this</span>.getPrivateBaseKeyB64()) + <span class="string">"\n"</span>; key += <span class="string">"-----END RSA PRIVATE KEY-----"</span>; <span class="keyword">return</span> key &#125;; JSEncryptRSAKey.prototype.getPublicKey = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">var</span> key = <span class="string">"-----BEGIN PUBLIC KEY-----\n"</span>; key += JSEncryptRSAKey.wordwrap(<span class="keyword">this</span>.getPublicBaseKeyB64()) + <span class="string">"\n"</span>; key += <span class="string">"-----END PUBLIC KEY-----"</span>; <span class="keyword">return</span> key &#125;; JSEncryptRSAKey.hasPublicKeyProperty = <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123; obj = obj || &#123;&#125;; <span class="keyword">return</span> (obj.hasOwnProperty(<span class="string">"n"</span>) &amp;&amp; obj.hasOwnProperty(<span class="string">"e"</span>)) &#125;; JSEncryptRSAKey.hasPrivateKeyProperty = <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123; obj = obj || &#123;&#125;; <span class="keyword">return</span> (obj.hasOwnProperty(<span class="string">"n"</span>) &amp;&amp; obj.hasOwnProperty(<span class="string">"e"</span>) &amp;&amp; obj.hasOwnProperty(<span class="string">"d"</span>) &amp;&amp; obj.hasOwnProperty(<span class="string">"p"</span>) &amp;&amp; obj.hasOwnProperty(<span class="string">"q"</span>) &amp;&amp; obj.hasOwnProperty(<span class="string">"dmp1"</span>) &amp;&amp; obj.hasOwnProperty(<span class="string">"dmq1"</span>) &amp;&amp; obj.hasOwnProperty(<span class="string">"coeff"</span>)) &#125;; JSEncryptRSAKey.prototype.parsePropertiesFrom = <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123; <span class="keyword">this</span>.n = obj.n; <span class="keyword">this</span>.e = obj.e; <span class="keyword">if</span> (obj.hasOwnProperty(<span class="string">"d"</span>)) &#123; <span class="keyword">this</span>.d = obj.d; <span class="keyword">this</span>.p = obj.p; <span class="keyword">this</span>.q = obj.q; <span class="keyword">this</span>.dmp1 = obj.dmp1; <span class="keyword">this</span>.dmq1 = obj.dmq1; <span class="keyword">this</span>.coeff = obj.coeff &#125; &#125;; <span class="keyword">return</span> JSEncryptRSAKey &#125;(RSAKey)); <span class="keyword">var</span> JSEncrypt = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="function"><span class="keyword">function</span> <span class="title">JSEncrypt</span>(<span class="params">options</span>) </span>&#123; options = options || &#123;&#125;; <span class="keyword">this</span>.default_key_size = <span class="built_in">parseInt</span>(options.default_key_size, <span class="number">10</span>) || <span class="number">1024</span>; <span class="keyword">this</span>.default_public_exponent = options.default_public_exponent || <span class="string">"010001"</span>; <span class="keyword">this</span>.log = options.log || <span class="literal">false</span>; <span class="keyword">this</span>.key = <span class="literal">null</span> &#125; JSEncrypt.prototype.setKey = <span class="function"><span class="keyword">function</span> (<span class="params">key</span>) </span>&#123; <span class="keyword">if</span> (<span class="keyword">this</span>.log &amp;&amp; <span class="keyword">this</span>.key) &#123; <span class="built_in">console</span>.warn(<span class="string">"A key was already set, overriding existing."</span>) &#125; <span class="keyword">this</span>.key = <span class="keyword">new</span> JSEncryptRSAKey(key) &#125;; JSEncrypt.prototype.setPrivateKey = <span class="function"><span class="keyword">function</span> (<span class="params">privkey</span>) </span>&#123; <span class="keyword">this</span>.setKey(privkey) &#125;; JSEncrypt.prototype.setPublicKey = <span class="function"><span class="keyword">function</span> (<span class="params">pubkey</span>) </span>&#123; <span class="keyword">this</span>.setKey(pubkey) &#125;; JSEncrypt.prototype.decrypt = <span class="function"><span class="keyword">function</span> (<span class="params">str</span>) </span>&#123; <span class="keyword">try</span> &#123; <span class="keyword">return</span> <span class="keyword">this</span>.getKey().decrypt(b64tohex(str)) &#125; <span class="keyword">catch</span> (ex) &#123; <span class="keyword">return</span> <span class="literal">false</span> &#125; &#125;; JSEncrypt.prototype.encrypt = <span class="function"><span class="keyword">function</span> (<span class="params">str</span>) </span>&#123; <span class="keyword">try</span> &#123; <span class="keyword">return</span> hex2b64(<span class="keyword">this</span>.getKey().encrypt(str)) &#125; <span class="keyword">catch</span> (ex) &#123; <span class="keyword">return</span> <span class="literal">false</span> &#125; &#125;; JSEncrypt.prototype.sign = <span class="function"><span class="keyword">function</span> (<span class="params">str, digestMethod, digestName</span>) </span>&#123; <span class="keyword">try</span> &#123; <span class="keyword">return</span> hex2b64(<span class="keyword">this</span>.getKey().sign(str, digestMethod, digestName)) &#125; <span class="keyword">catch</span> (ex) &#123; <span class="keyword">return</span> <span class="literal">false</span> &#125; &#125;; JSEncrypt.prototype.verify = <span class="function"><span class="keyword">function</span> (<span class="params">str, signature, digestMethod</span>) </span>&#123; <span class="keyword">try</span> &#123; <span class="keyword">return</span> <span class="keyword">this</span>.getKey().verify(str, b64tohex(signature), digestMethod) &#125; <span class="keyword">catch</span> (ex) &#123; <span class="keyword">return</span> <span class="literal">false</span> &#125; &#125;; JSEncrypt.prototype.getKey = <span class="function"><span class="keyword">function</span> (<span class="params">cb</span>) </span>&#123; <span class="keyword">if</span> (!<span class="keyword">this</span>.key) &#123; <span class="keyword">this</span>.key = <span class="keyword">new</span> JSEncryptRSAKey(); <span class="keyword">if</span> (cb &amp;&amp; &#123;&#125;.toString.call(cb) === <span class="string">"[object Function]"</span>) &#123; <span class="keyword">this</span>.key.generateAsync(<span class="keyword">this</span>.default_key_size, <span class="keyword">this</span>.default_public_exponent, cb); <span class="keyword">return</span> &#125; <span class="keyword">this</span>.key.generate(<span class="keyword">this</span>.default_key_size, <span class="keyword">this</span>.default_public_exponent) &#125; <span class="keyword">return</span> <span class="keyword">this</span>.key &#125;; JSEncrypt.prototype.getPrivateKey = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.getKey().getPrivateKey() &#125;; JSEncrypt.prototype.getPrivateKeyB64 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.getKey().getPrivateBaseKeyB64() &#125;; JSEncrypt.prototype.getPublicKey = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.getKey().getPublicKey() &#125;; JSEncrypt.prototype.getPublicKeyB64 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.getKey().getPublicBaseKeyB64() &#125;; JSEncrypt.version = <span class="string">"3.0.0-rc.1"</span>; <span class="keyword">return</span> JSEncrypt &#125;()); window2.JSEncrypt = JSEncrypt; exports.JSEncrypt = JSEncrypt; exports.default = JSEncrypt; <span class="built_in">Object</span>.defineProperty(exports, <span class="string">'__esModule'</span>, &#123; <span class="attr">value</span>: <span class="literal">true</span> &#125;) &#125;)));</span><br></pre></td></tr></table></figure>



<p><strong>那么在js中如何使用呢？</strong></p>
<ul>
<li><p>由于微信小程序本身属于前端部分，不涉及后端，一般不会要求前端持有密钥（yuè），而是只持有公钥（yuè）就足够了。因此我们分为以下步骤：</p>
<ol>
<li>引进我们需要的<code>jsencrypt.js</code>文件</li>
</ol>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//为了防止ES5和ES6兼容性的问题，采用ES5的方式引进js文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//1、引进我们需要的`jsencrypt.js`文件</span></span><br><span class="line"><span class="keyword">var</span> jsencrypt = <span class="built_in">require</span>(<span class="string">'../../utils/jsencrypt.min.js'</span>);</span><br><span class="line"></span><br><span class="line">Page(&#123;</span><br><span class="line"></span><br><span class="line">    data: &#123;&#125;,</span><br><span class="line">    onLoad: <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;&#125;,</span><br><span class="line">    onReady: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">    onShow: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">    onHide: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">    onUnload: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">    onPullDownRefresh: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">    onReachBottom: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">    onShareAppMessage: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>





<ol start="2">
<li><p>从服务器端获取公钥（yuè）</p>
</li>
<li><p>利用从服务器获得的公钥（yuè），对本地进行RSA加密，得到密文</p>
</li>
<li><p>将密文发给服务器（这样就能保证数据在网路传输过程中的绝密性了）</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">wx.request(&#123;</span><br><span class="line">    <span class="comment">//2、指定服务器的url,获取公钥（yuè）</span></span><br><span class="line">    url: <span class="string">'http://localhost:8080/weixin/publickey'</span>,</span><br><span class="line">    method: <span class="string">'POST'</span>,</span><br><span class="line">    success: <span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">        <span class="comment">//获取公钥（yuè）</span></span><br><span class="line">        <span class="keyword">var</span> publicKey = res.data</span><br><span class="line">        <span class="comment">//如果服务器返回的公钥为空字符串，说明服务器发生错误，无法正常生成公钥</span></span><br><span class="line">        <span class="keyword">if</span>(publicKey==<span class="string">""</span>) <span class="keyword">return</span>;</span><br><span class="line">		<span class="comment">//通过引进的`jsencrypt.js`文件，来创建具有RSA算法的对象</span></span><br><span class="line">        <span class="keyword">var</span> rsa = <span class="keyword">new</span> jsencrypt.JSEncrypt();</span><br><span class="line">        </span><br><span class="line">		<span class="comment">//3、利用从服务器获得的公钥（yuè），对本地进行RSA加密，得到密文`ciphertext`</span></span><br><span class="line">        rsa.setPublicKey(publicKey)</span><br><span class="line">        <span class="keyword">var</span> ciphertext =  rsa.encrypt(<span class="built_in">JSON</span>.stringify(metaVo))</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4、将密文发给服务器</span></span><br><span class="line">        <span class="comment">//（前后端采用统一的cipherObj对象的格式来说明该密文由哪个公钥加密的，方便后端知晓后采用对应的密钥进行解密）</span></span><br><span class="line">        <span class="keyword">var</span> cipherObj = &#123;&#125;</span><br><span class="line">        cipherObj.publicKey = publicKey;</span><br><span class="line">        cipherObj.ciphertext = ciphertext;</span><br><span class="line"></span><br><span class="line">        wx.request(&#123;</span><br><span class="line">            url: <span class="string">'http://localhost:8080/weixin/uploader'</span>,</span><br><span class="line">            data: cipherObj,</span><br><span class="line">            dataType: <span class="string">'json'</span>,</span><br><span class="line">            method: <span class="string">'POST'</span>,</span><br><span class="line">            success: <span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(res.data)</span><br><span class="line">            &#125;,</span><br><span class="line">            fail: <span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">"失败"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    fail: <span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"失败"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<p><strong>既然前端是这么写的，那么后端长什么样子的呢？</strong></p>
<h1 id="4、Java后端使用RSA"><a href="#4、Java后端使用RSA" class="headerlink" title="4、Java后端使用RSA"></a>4、Java后端使用RSA</h1><ol>
<li><p>首先我们需要像上面的JavaScript一样，有一个类似于<code>jsencrypt.js</code>文件的工具类。</p>
<p><code>这里我直接写好了这个工具类,直接附上：</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.bingcu.utils.sign;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.codec.binary.Base64;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> java.security.KeyFactory;</span><br><span class="line"><span class="keyword">import</span> java.security.KeyPair;</span><br><span class="line"><span class="keyword">import</span> java.security.KeyPairGenerator;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"><span class="keyword">import</span> java.security.SecureRandom;</span><br><span class="line"><span class="keyword">import</span> java.security.interfaces.RSAPrivateKey;</span><br><span class="line"><span class="keyword">import</span> java.security.interfaces.RSAPublicKey;</span><br><span class="line"><span class="keyword">import</span> java.security.spec.PKCS8EncodedKeySpec;</span><br><span class="line"><span class="keyword">import</span> java.security.spec.X509EncodedKeySpec;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RSAEncrypt</span> </span>&#123;</span><br><span class="line">    <span class="comment">//封装随机产生的公钥与密钥</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, String&gt; keyMap = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//测试能否正确生成公钥和密钥，同时测试是否能正确加密解密</span></span><br><span class="line"><span class="comment">//    public static void main(String[] args) throws Exception &#123;</span></span><br><span class="line"><span class="comment">//        String publicKey = generateKeyPair();</span></span><br><span class="line"><span class="comment">//        System.out.println("Public Key：");</span></span><br><span class="line"><span class="comment">//        System.out.println(publicKey);</span></span><br><span class="line"><span class="comment">//        System.out.println("Private Key：");</span></span><br><span class="line"><span class="comment">//        System.out.println(keyMap.get(publicKey));</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        System.out.println();</span></span><br><span class="line"><span class="comment">//        System.out.println("加密后的文本：");</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        String text = encrypt("123", publicKey);</span></span><br><span class="line"><span class="comment">//        System.out.println(text);</span></span><br><span class="line"><span class="comment">//        System.out.println("解密后的文本：");</span></span><br><span class="line"><span class="comment">//        System.out.println(decrypt(text, keyMap.get(publicKey)));</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 随机生成密钥对</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NoSuchAlgorithmException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">generateKeyPair</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchAlgorithmException </span>&#123;</span><br><span class="line">        <span class="comment">// KeyPairGenerator类用于生成公钥和密钥对，基于RSA算法生成对象</span></span><br><span class="line">        KeyPairGenerator keyPairGen = KeyPairGenerator.getInstance(<span class="string">"RSA"</span>);</span><br><span class="line">        <span class="comment">// 初始化密钥对生成器，密钥大小为96-1024位</span></span><br><span class="line">        keyPairGen.initialize(<span class="number">1024</span>,<span class="keyword">new</span> SecureRandom());</span><br><span class="line">        <span class="comment">// 生成一个密钥对，保存在keyPair中</span></span><br><span class="line">        KeyPair keyPair = keyPairGen.generateKeyPair();</span><br><span class="line">        RSAPrivateKey privateKey = (RSAPrivateKey) keyPair.getPrivate();   <span class="comment">// 获得密钥</span></span><br><span class="line">        RSAPublicKey publicKey = (RSAPublicKey) keyPair.getPublic();  <span class="comment">// 获得公钥</span></span><br><span class="line">        String publicKeyString = <span class="keyword">new</span> String(Base64.encodeBase64(publicKey.getEncoded()));</span><br><span class="line">        <span class="comment">// 获得密钥字符串</span></span><br><span class="line">        String privateKeyString = <span class="keyword">new</span> String(Base64.encodeBase64((privateKey.getEncoded())));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">synchronized</span> (keyMap)&#123;</span><br><span class="line">            <span class="comment">// 将公钥和私钥保存到Map</span></span><br><span class="line">            <span class="comment">//key:公钥，  value:私钥</span></span><br><span class="line">            keyMap.put(publicKeyString, privateKeyString);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//返回当前生成的公钥</span></span><br><span class="line">        <span class="keyword">return</span> publicKeyString;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * RSA公钥加密</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> text 需加密的文本</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> publicKey 公钥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 密文</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception 加密过程中的异常信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">encrypt</span><span class="params">( String text, String publicKey )</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="comment">//base64编码的公钥</span></span><br><span class="line">        <span class="keyword">byte</span>[] decoded = Base64.decodeBase64(publicKey);</span><br><span class="line">        RSAPublicKey pubKey = (RSAPublicKey) KeyFactory.getInstance(<span class="string">"RSA"</span>).generatePublic(<span class="keyword">new</span> X509EncodedKeySpec(decoded));</span><br><span class="line">        <span class="comment">//RSA加密</span></span><br><span class="line">        Cipher cipher = Cipher.getInstance(<span class="string">"RSA"</span>);</span><br><span class="line">        cipher.init(Cipher.ENCRYPT_MODE, pubKey);</span><br><span class="line">        String outStr = Base64.encodeBase64String(cipher.doFinal(text.getBytes(<span class="string">"UTF-8"</span>)));</span><br><span class="line">        <span class="keyword">return</span> outStr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * RSA密钥解密</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> text 需解密的文本</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> privateKey 密钥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 铭文</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception 解密过程中的异常信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">decrypt</span><span class="params">(String text, String privateKey)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="comment">//64位解码加密后的字符串</span></span><br><span class="line">        <span class="keyword">byte</span>[] inputByte = Base64.decodeBase64(text.getBytes(<span class="string">"UTF-8"</span>));</span><br><span class="line">        <span class="comment">//base64编码的密钥</span></span><br><span class="line">        <span class="keyword">byte</span>[] decoded = Base64.decodeBase64(privateKey);</span><br><span class="line">        RSAPrivateKey priKey = (RSAPrivateKey) KeyFactory.getInstance(<span class="string">"RSA"</span>).generatePrivate(<span class="keyword">new</span> PKCS8EncodedKeySpec(decoded));</span><br><span class="line">        <span class="comment">//RSA解密</span></span><br><span class="line">        Cipher cipher = Cipher.getInstance(<span class="string">"RSA"</span>);</span><br><span class="line">        cipher.init(Cipher.DECRYPT_MODE, priKey);</span><br><span class="line">        String outStr = <span class="keyword">new</span> String(cipher.doFinal(inputByte));</span><br><span class="line">        <span class="keyword">return</span> outStr;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取公钥对应的密钥</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> publicKey 公钥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 密钥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">obtainPrivateKey</span><span class="params">(String publicKey)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> keyMap.get(publicKey);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除键值对</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> publicKey 公钥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 被删除的密钥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">static</span> String <span class="title">dropKeyPair</span><span class="params">(String publicKey)</span></span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (keyMap)&#123;</span><br><span class="line">            <span class="keyword">return</span> keyMap.remove(publicKey);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>虽然工具是就此写好了，那现在就到了使用它的时候了。我们现在就需要编写与微信相关的<code>Controller</code>了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.bingcu.web.controller.weixin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> top.bingcu.utils.sign.RSAEncrypt;</span><br><span class="line"><span class="keyword">import</span> top.bingcu.web.domain.to.CipherObj;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 微信数据上传</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/weixin"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">uploaderController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 客户端向本服务器申请一个公钥</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 随机公钥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/publickey"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">obtainPublicKey</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String publicKey = RSAEncrypt.generateKeyPair();</span><br><span class="line">            System.out.println(<span class="string">"[申请]   对方申请公钥成功"</span>);</span><br><span class="line">            <span class="comment">//正常生成公钥的话，就正常将该公钥返回给客户端</span></span><br><span class="line">            <span class="keyword">return</span> publicKey;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//服务器这边生成公钥抛异常了，所以返回空字符串</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/uploader"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">upload</span><span class="params">(@RequestBody CipherObj cipherObj)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获得密钥后就把对应的 密钥对 从密钥管理者中删除</span></span><br><span class="line">        <span class="comment">//因为生成的密钥的一次性的，所以不管执行成不成功，之后该 密钥对 都没用了</span></span><br><span class="line">        String privateKey = RSAEncrypt.obtainPrivateKey(cipherObj.getPublicKey());</span><br><span class="line">        RSAEncrypt.dropKeyPair(cipherObj.getPublicKey());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String clearText = RSAEncrypt.decrypt(cipherObj.getCiphertext(), privateKey);</span><br><span class="line">            System.out.println(<span class="string">"解密后的明文："</span>);</span><br><span class="line">            System.out.println(clearText);</span><br><span class="line"></span><br><span class="line">             <span class="comment">//处理</span></span><br><span class="line">            <span class="comment">//......</span></span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"false"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"true"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.bingcu.web.domain.to;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 前后端统一的密文收发格式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CipherObj</span> </span>&#123;</span><br><span class="line">    String publicKey;</span><br><span class="line">    String ciphertext;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPublicKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> publicKey;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPublicKey</span><span class="params">(String publicKey)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.publicKey = publicKey;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCiphertext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ciphertext;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCiphertext</span><span class="params">(String ciphertext)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.ciphertext = ciphertext;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"CipherObj&#123;"</span> +</span><br><span class="line">                <span class="string">"publicKey='"</span> + publicKey + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", ciphertext='"</span> + ciphertext + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">BinGCU</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://bingcu.com/2020/07/23/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%B9%8BRSA%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86/">http://bingcu.com/2020/07/23/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%B9%8BRSA%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/">微信小程序</a><a class="post-meta__tags" href="/tags/%E5%8A%A0%E5%AF%86%E4%B8%8E%E8%A7%A3%E5%AF%86/">加密与解密</a><a class="post-meta__tags" href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/">网络安全</a></div><div class="post_share"><div class="social-share" data-image="/img/article_covers/25.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> Donate<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="/./img/wechat.png" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="post-qr-code__img" src="/./img/alipay.png" alt="支付寶"/><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/07/24/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%B9%8BRSA%E9%95%BF%E6%96%87%E6%9C%AC%E5%88%86%E6%AE%B5%E5%8A%A0%E8%A7%A3%E5%AF%86/"><img class="prev_cover" src="/img/article_covers/6.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">微信小程序 之 RSA长文本分段加解密</div></div></a></div><div class="next-post pull_right"><a href="/2020/07/19/%E5%AE%8C%E7%BE%8E%E8%A7%A3%E5%86%B3Hexo+Typora%E5%9B%BE%E7%89%87%E6%97%A0%E6%B3%95%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98/"><img class="next_cover" src="/img/article_covers/21.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">完美解决Hexo+Typora图片无法显示问题</div></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> Comment</span></div><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '73cb422933f7cdd16601',
  clientSecret: '17643d7b7dcfb537cf98bc1354eba774c1a252e1',
  repo: 'BingCUMaO.github.io',
  owner: 'BingCUMaO',
  admin: ['BingCUMaO'],
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN',
  perPage: 10,
  distractionFreeMode: true,
  pagerDirection: 'last',
  createIssueManually: false,
  updateCountCallback: commentCount
})
gitalk.render('gitalk-container')

function commentCount(n){
  try {
    document.getElementsByClassName('gitalk-comment-count')[0].innerHTML= n
  } catch (e) {
    return false
  }
}</script></div></article></main><footer id="footer" style="background-image: url(/img/article_covers/1.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By BinGCU</div><div class="framework-info"><span>Driven </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text">Hi, Welcome to come my blog.</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="Read Mode"></i><i class="fa fa-plus" id="font_plus" title="Increase font size"></i><i class="fa fa-minus" id="font_minus" title="Decrease font size"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="Traditional Chinese and Simplified Chinese Conversion" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="Dark Mode"></i></div><div id="rightside-config-show"><div id="rightside_config" title="Setting"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="Scroll to comment"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="Table of Contents" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="Back to top" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script id="ribbon_piao" mobile="true" src="/js/third-party/piao.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@3/instantpage.min.js" type="module"></script></body></html>